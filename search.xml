<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Docker搭建Gitlab仓库</title>
    <url>/151510421.html</url>
    <content><![CDATA[<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
  </entry>
  <entry>
    <title>C语言实现一个迷你Shell</title>
    <url>/1118750159.html</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>俄勒冈州立大学（Oregon State University) CS 344作业,使用C语言实现一个Shell.<br><a id="more"></a></p>
<h1 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h1><ul>
<li>内置 <code>cd</code>,<code>status</code>和<code>exit</code> 命令</li>
<li>支持输入和输出的重定向</li>
<li>支持后台运行(&amp;)</li>
<li>Ctrl-Z 与 Ctrl-C</li>
<li>调用系统其他命令</li>
<li>替换命令中的<code>$$</code>为Shell的<code>PID</code></li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><h2 id="作业pdf"><a href="#作业pdf" class="headerlink" title="作业pdf"></a>作业pdf</h2><div class="pdf" target="./1118750159/Program3.pdf" height></div>
<h2 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h2><figure class="highlight bash"><figcaption><span>p3testscript</span><a href="/downloads/code/p3testscript">view raw</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"PRE-SCRIPT INFO"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"  Grading Script PID: $$"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'  Note: your smallsh will report a different PID when evaluating $$'</span></span><br><span class="line"></span><br><span class="line">./smallsh &lt;&lt;<span class="string">'___EOF___'</span></span><br><span class="line"><span class="built_in">echo</span> BEGINNING TEST SCRIPT</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> Using comment (5 points <span class="keyword">if</span> only next prompt is displayed next)</span><br><span class="line"><span class="comment">#THIS COMMENT SHOULD DO NOTHING</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> ls (10 points <span class="keyword">for</span> returning dir contents)</span><br><span class="line">ls</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> ls out junk</span><br><span class="line">ls &gt; junk</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> cat junk (15 points <span class="keyword">for</span> correctly returning contents of junk)</span><br><span class="line">cat junk</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> wc <span class="keyword">in</span> junk (15 points <span class="keyword">for</span> returning correct numbers from wc)</span><br><span class="line">wc &lt; junk</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> wc <span class="keyword">in</span> junk out junk2; cat junk2 (10 points <span class="keyword">for</span> returning correct numbers from wc)</span><br><span class="line">wc &lt; junk &gt; junk2</span><br><span class="line">cat junk2</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">test</span> -f badfile (10 points <span class="keyword">for</span> returning error value of 1, note extraneous &amp;)</span><br><span class="line"><span class="built_in">test</span> -f badfile</span><br><span class="line">status &amp;</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> wc <span class="keyword">in</span> badfile (10 points <span class="keyword">for</span> returning text error)</span><br><span class="line">wc &lt; badfile</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> badfile (10 points <span class="keyword">for</span> returning text error)</span><br><span class="line">badfile</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> sleep 100 background (10 points <span class="keyword">for</span> returning process ID of sleeper)</span><br><span class="line">sleep 100 &amp;</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> pkill -signal SIGTERM sleep (10 points <span class="keyword">for</span> pid of killed process, 10 points <span class="keyword">for</span> signal)</span><br><span class="line"><span class="built_in">echo</span> (Ignore message about Operation Not Permitted)</span><br><span class="line">pkill sleep</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> sleep 1 background (10 pts <span class="keyword">for</span> pid of <span class="built_in">bg</span> ps when <span class="keyword">done</span>, 10 <span class="keyword">for</span> <span class="built_in">exit</span> value)</span><br><span class="line">sleep 1 &amp;</span><br><span class="line">sleep 1</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">cd</span></span><br><span class="line"><span class="built_in">cd</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">pwd</span> (10 points <span class="keyword">for</span> being <span class="keyword">in</span> the HOME dir)</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> mkdir testdir$$</span><br><span class="line">mkdir testdir$$</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">cd</span> testdir$$</span><br><span class="line"><span class="built_in">cd</span> testdir$$</span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> <span class="built_in">pwd</span> (5 points <span class="keyword">for</span> being <span class="keyword">in</span> the newly created dir)</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">echo</span> --------------------</span><br><span class="line"><span class="built_in">echo</span> Testing foreground-only mode (20 points <span class="keyword">for</span> entry &amp; <span class="built_in">exit</span> text AND ~5 seconds between <span class="built_in">times</span>)</span><br><span class="line"><span class="built_in">kill</span> -SIGTSTP $$</span><br><span class="line">date</span><br><span class="line">sleep 5 &amp;</span><br><span class="line">date</span><br><span class="line"><span class="built_in">kill</span> -SIGTSTP $$</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">___EOF___</span><br></pre></td></tr></table></figure>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><figure class="highlight c"><figcaption><span>smallsh.c</span><a href="/downloads/code/smallsh.c">view raw</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_INPUT_LENGTH 2048</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_ARG_NUMBER 512</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SPLIT_CHAR <span class="meta-string">" \t\r\n"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> allowBg = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">readLine</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">size_t</span> maxLength = MAX_INPUT_LENGTH;</span><br><span class="line">    <span class="keyword">char</span> *<span class="built_in">line</span> = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * maxLength);</span><br><span class="line">    fgets(<span class="built_in">line</span>, maxLength, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; maxLength; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">line</span>[i] == <span class="string">'\n'</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">line</span>[i] = <span class="string">'\0'</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">line</span>;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">char</span> **<span class="title">parse</span><span class="params">(<span class="keyword">char</span> *<span class="built_in">line</span>, <span class="keyword">int</span> *num, <span class="keyword">int</span> *back)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">size_t</span> maxNumber = MAX_ARG_NUMBER;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">char</span> **arr = (<span class="keyword">char</span> **)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span> *) * maxNumber);</span><br><span class="line">    <span class="keyword">char</span> *token;</span><br><span class="line">    token = strtok(<span class="built_in">line</span>, SPLIT_CHAR);</span><br><span class="line">    <span class="keyword">while</span> (token != <span class="literal">NULL</span>)</span><br><span class="line">    {</span><br><span class="line">        arr[i] = token;</span><br><span class="line">        <span class="comment">// replace $$</span></span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(arr[i])<span class="number">-1</span>; j++)</span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">if</span> (arr[i][j] == <span class="string">'$'</span> &amp;&amp; arr[i][j + <span class="number">1</span>] == <span class="string">'$'</span>)</span><br><span class="line">            {</span><br><span class="line">                arr[i][j] = <span class="string">'\0'</span>;</span><br><span class="line">                arr[i][j+<span class="number">1</span>] = <span class="string">'\0'</span>;</span><br><span class="line">                <span class="keyword">char</span> t[<span class="number">10</span>];</span><br><span class="line">                <span class="keyword">char</span> newArg[<span class="number">50</span>];</span><br><span class="line">                <span class="built_in">memset</span>(t, <span class="string">'\0'</span>, <span class="number">10</span>);</span><br><span class="line">                <span class="built_in">memset</span>(newArg, <span class="string">'\0'</span>, <span class="number">50</span>);</span><br><span class="line">                <span class="built_in">strncpy</span>(newArg, arr[i], j);</span><br><span class="line">                <span class="built_in">sprintf</span>(t, <span class="string">"%d"</span>, getpid());</span><br><span class="line">                <span class="built_in">strcat</span>(newArg, t);</span><br><span class="line">                <span class="comment">// sprintf(arr[i], newArg);</span></span><br><span class="line">                arr[i] = newArg;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        i++;</span><br><span class="line">        token = strtok(<span class="literal">NULL</span>, SPLIT_CHAR);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">2</span> &amp;&amp; <span class="built_in">strcmp</span>(arr[i - <span class="number">1</span>], <span class="string">"&amp;"</span>) == <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        arr[i - <span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line">            i--;</span><br><span class="line">        <span class="keyword">if</span>(allowBg == <span class="number">1</span>){</span><br><span class="line">            *back = <span class="number">1</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    *num = i;</span><br><span class="line">    arr[i] = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printStatus</span><span class="params">(<span class="keyword">int</span> status)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (status == <span class="number">0</span> || status == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"exit value %d\n"</span>, status);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"terminated by signal %d\n"</span>, status);</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">catchSIGTSTP</span><span class="params">(<span class="keyword">int</span> sig)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (allowBg == <span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">char</span> *message = <span class="string">"Entering foreground-only mode(&amp; is now ignored)\n"</span>;</span><br><span class="line">        <span class="built_in">write</span>(STDOUT_FILENO, message, <span class="number">49</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        allowBg = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">char</span> *message = <span class="string">"Exiting foreground-only mode\n"</span>;</span><br><span class="line">        <span class="built_in">write</span>(STDOUT_FILENO, message, <span class="number">30</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        allowBg = <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">catchSIGINT</span><span class="params">(<span class="keyword">int</span> signo)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">char</span> message[] = <span class="string">"terminated by signal "</span>;</span><br><span class="line">    <span class="keyword">char</span> t[<span class="number">10</span>];</span><br><span class="line">    <span class="built_in">memset</span>(t, <span class="string">'\0'</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">sprintf</span>(t, <span class="string">"%d"</span>, signo);</span><br><span class="line">    <span class="built_in">strcat</span>(message, t);</span><br><span class="line">    <span class="built_in">strcat</span>(message, <span class="string">"\n"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, message);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    fflush(<span class="built_in">stdin</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">newProcess</span><span class="params">(<span class="keyword">char</span> **arr, <span class="keyword">int</span> num, <span class="keyword">int</span> back)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">pid_t</span> pid = fork();</span><br><span class="line">    <span class="keyword">int</span> status, fd;</span><br><span class="line">    <span class="keyword">int</span> input_flag = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> output_flag = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arr[i], <span class="string">"&lt;"</span>) == <span class="number">0</span>)</span><br><span class="line">            input_flag = i;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arr[i], <span class="string">"&gt;"</span>) == <span class="number">0</span>)</span><br><span class="line">            output_flag = i;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">if</span> (pid == <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">sigint</span> = {</span><span class="number">0</span>};</span><br><span class="line">        sigint.sa_handler = catchSIGINT;</span><br><span class="line">        sigemptyset(&amp;sigint.sa_mask);</span><br><span class="line">        sigint.sa_flags = <span class="number">0</span>;</span><br><span class="line">        sigaction(SIGINT, &amp;sigint, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// input redirect</span></span><br><span class="line">        <span class="keyword">if</span> (input_flag &gt; <span class="number">-1</span>)</span><br><span class="line">        {</span><br><span class="line">            fd = <span class="built_in">open</span>(arr[input_flag + <span class="number">1</span>], O_RDONLY, <span class="number">0644</span>);</span><br><span class="line">            <span class="keyword">if</span> (fd == <span class="number">-1</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"cannot open %s for input\n"</span>, arr[input_flag + <span class="number">1</span>]);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (dup2(fd, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">": Could not redirect stdin for input file %s\n"</span>, arr[input_flag + <span class="number">1</span>]);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">                arr[input_flag] = <span class="literal">NULL</span>;</span><br><span class="line">                <span class="built_in">close</span>(fd);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//output redirect</span></span><br><span class="line">        <span class="keyword">if</span> (output_flag &gt; <span class="number">-1</span>)</span><br><span class="line">        {</span><br><span class="line">            fd = <span class="built_in">open</span>(arr[output_flag + <span class="number">1</span>], O_WRONLY | O_CREAT | O_TRUNC, <span class="number">0644</span>);</span><br><span class="line">            <span class="keyword">if</span> (fd == <span class="number">-1</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"cannot not open %s for output\n"</span>, arr[output_flag + <span class="number">1</span>]);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (dup2(fd, <span class="number">1</span>) == <span class="number">-1</span>)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"Could not redirect stdout for output file %s\n"</span>, arr[output_flag + <span class="number">1</span>]);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">                arr[output_flag] = <span class="literal">NULL</span>;</span><br><span class="line">                <span class="built_in">close</span>(fd);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (back == <span class="number">1</span> &amp;&amp; input_flag &lt; <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            fd = <span class="built_in">open</span>(<span class="string">"/dev/null"</span>, O_RDONLY, <span class="number">0644</span>);</span><br><span class="line">            <span class="keyword">if</span> (fd == <span class="number">-1</span>)</span><br><span class="line">            {</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"Could not open \"/dev/null\"\n"</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (dup2(fd, <span class="number">0</span>) == <span class="number">-1</span>)</span><br><span class="line">                {</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">"Could not redirect stdin to \"/dev/null\"\n"</span>);</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">                }</span><br><span class="line">                <span class="built_in">close</span>(fd);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// printf("%c\n", arr[0][0]);</span></span><br><span class="line">        <span class="keyword">if</span> (execvp(arr[<span class="number">0</span>], arr) == <span class="number">-1</span> &amp;&amp; arr[<span class="number">0</span>][<span class="number">0</span>] &gt;= <span class="string">'a'</span> &amp;&amp; arr[<span class="number">0</span>][<span class="number">0</span>] &lt;= <span class="string">'z'</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%s: no such file or directory\n"</span>, arr[<span class="number">0</span>]);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (pid &lt; <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"Smallsh !\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    { <span class="comment">// parent</span></span><br><span class="line">        <span class="keyword">if</span> (back == <span class="number">1</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"Background pid is %d.\n"</span>, pid);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        {</span><br><span class="line">            waitpid(pid, &amp;status, WUNTRACED);</span><br><span class="line">            <span class="keyword">if</span> (WIFEXITED(status))</span><br><span class="line">                <span class="keyword">return</span> (WEXITSTATUS(status));</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (WIFSIGNALED(status))</span><br><span class="line">                <span class="keyword">return</span> (WTERMSIG(status));</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">}</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">executeCommand</span><span class="params">(<span class="keyword">char</span> **arr, <span class="keyword">int</span> status, <span class="keyword">int</span> num, <span class="keyword">int</span> back)</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="literal">NULL</span> || <span class="built_in">strcmp</span>(<span class="string">"#"</span>, arr[<span class="number">0</span>]) == <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arr[<span class="number">0</span>], <span class="string">"exit"</span>) == <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arr[<span class="number">0</span>], <span class="string">"status"</span>) == <span class="number">0</span>)</span><br><span class="line">        printStatus(status);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(arr[<span class="number">0</span>], <span class="string">"cd"</span>) == <span class="number">0</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">char</span> *directory;</span><br><span class="line">        <span class="keyword">if</span> (arr[<span class="number">1</span>] == <span class="literal">NULL</span>)</span><br><span class="line">            directory = getenv(<span class="string">"HOME"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            directory = arr[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (chdir(directory) == <span class="number">-1</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"cd: No such file or directory\n"</span>);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">int</span> t = newProcess(arr, num, back);</span><br><span class="line">        <span class="comment">// printf("------------%d---\n",t);</span></span><br><span class="line">        <span class="comment">// fflush(stdout);</span></span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>{</span><br><span class="line">    <span class="keyword">char</span> *input;</span><br><span class="line">    <span class="keyword">char</span> **arr;</span><br><span class="line">    <span class="keyword">int</span> status = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">sigint</span> = {</span><span class="number">0</span>};</span><br><span class="line">    sigint.sa_handler = SIG_IGN;</span><br><span class="line">    sigemptyset(&amp;sigint.sa_mask);</span><br><span class="line">    sigint.sa_flags = <span class="number">0</span>;</span><br><span class="line">    sigaction(SIGINT, &amp;sigint, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">sigtstp</span> = {</span><span class="number">0</span>};</span><br><span class="line">    sigtstp.sa_handler = catchSIGTSTP;</span><br><span class="line">    sigfillset(&amp;sigtstp.sa_mask);</span><br><span class="line">    sigtstp.sa_flags = <span class="number">0</span>;</span><br><span class="line">    sigaction(SIGTSTP, &amp;sigtstp, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> back = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">": "</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        input = readLine();</span><br><span class="line">        arr = parse(input, &amp;num, &amp;back);</span><br><span class="line">        status = executeCommand(arr, status, num, back);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//background</span></span><br><span class="line">        <span class="keyword">pid_t</span> childPid = waitpid(<span class="number">-1</span>, &amp;status, WNOHANG);</span><br><span class="line">        <span class="keyword">if</span> (childPid &gt; <span class="number">0</span>)</span><br><span class="line">        {</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"background pid %d is done: "</span>, childPid);</span><br><span class="line">            <span class="keyword">if</span> (WIFEXITED(status))</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"exit value %d\n"</span>, WEXITSTATUS(status));</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"terminated by signal %d\n"</span>, status);</span><br><span class="line">            fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        }</span><br><span class="line">        fflush(<span class="built_in">stdin</span>);</span><br><span class="line">        <span class="built_in">free</span>(input);</span><br><span class="line">        <span class="built_in">free</span>(arr);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="wait-函数"><a href="#wait-函数" class="headerlink" title="wait()函数"></a>wait()函数</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">wait</span><span class="params">(<span class="keyword">int</span>* status)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">pid_t</span> <span class="title">waitpid</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span>* status, <span class="keyword">int</span> options)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>WNOHANG 如果该子进程没有结束，则以非阻塞方式等待子进程，并且返回0;如果该子进程已经结束，返回其pid.如果没有子进程退出，则立刻返回-1</li>
<li>WUNTRACED  若子进程进入暂停状态，则马上返回</li>
</ul>
<h2 id="WIFEXTED与WEXITSTATUS"><a href="#WIFEXTED与WEXITSTATUS" class="headerlink" title="WIFEXTED与WEXITSTATUS"></a>WIFEXTED与WEXITSTATUS</h2><ul>
<li>WIFEXTED(status) 这个宏用来获取是否正常退出，正常退出获得true</li>
<li>WEXITSTATUS(status) 只可在WIFEXITED为true时使用，获取正常退出的状态码</li>
</ul>
<h2 id="WIFSIGNALED与WTERMSIG"><a href="#WIFSIGNALED与WTERMSIG" class="headerlink" title="WIFSIGNALED与WTERMSIG"></a>WIFSIGNALED与WTERMSIG</h2><ul>
<li>WIFSIGNALED(status) 这个宏用来获取是否异常退出，异常退出获得true</li>
<li>WTERMSIG(status) 只可在WIFSIGNALED为true时使用，获取异常退出的状态码<figure class="highlight c"><figcaption><span>smallsh.c</span><a href="/downloads/code/smallsh.c">view raw</a></figcaption><table><tr><td class="code"><pre><span class="line">waitpid(pid, &amp;status, WUNTRACED);</span><br><span class="line">            <span class="keyword">if</span> (WIFEXITED(status))</span><br><span class="line">                <span class="keyword">return</span> (WEXITSTATUS(status));</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (WIFSIGNALED(status))</span><br><span class="line">                <span class="keyword">return</span> (WTERMSIG(status));</span><br></pre></td></tr></table></figure></li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <tags>
        <tag>Shell</tag>
        <tag>C语言</tag>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>在Django中间件处对API进行统一处理</title>
    <url>/2620614917.html</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>公司实习时遇到一个问题:项目中所使用不是Restful API,每个视图函数都要先生成字典，于是项目中便充斥着如下的代码:<br><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">result=&#123;</span><br><span class="line">	<span class="string">"msg"</span>:<span class="string">'xx",</span></span><br><span class="line"><span class="string">	"status":200,</span></span><br><span class="line"><span class="string">	"result":data</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">return HttpResponse(json.loads(result))</span></span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>维护起来比较麻烦，对前端也很不友好，为了解决该问题，自定义了一个Django中间件对API格式和异常进行统一处理，以此达到如下效果:</p>
<ul>
<li>在view中只需返回<code>data</code>，<code>raise</code>自定义的异常</li>
<li>实现自定义异常状态码(<code>status</code>)和自定义异常信息(<code>message</code>)</li>
<li>view中返回的<code>Object</code>若为<code>Model</code>,则会返回调用其<code>__str__</code>方法的结果</li>
<li>对于<code>view</code>中出现的其他异常，<code>Response</code>会返回<code>Unknown exception</code></li>
<li>异常信息(<code>message</code>)实现了<code>i18n</code></li>
</ul>
<h1 id="Django中对异常的处理"><a href="#Django中对异常的处理" class="headerlink" title="Django中对异常的处理"></a>Django中对异常的处理</h1><h2 id="Django中对request的处理"><a href="#Django中对request的处理" class="headerlink" title="Django中对request的处理"></a>Django中对request的处理</h2><ul>
<li>首先执行<code>process_request</code>函数，然后在执行视图函数之前执行<code>process_view</code>函数，再执行视图函数，最后执行<code>process_response</code>函数</li>
<li><code>process_request</code>只返回<code>None</code>，所有中间件的<code>process_request</code>执行完之后，就匹配路由，找到对应的视图函数，在执行视图函数之前先执行中间件的 <code>process_view</code>函数</li>
<li>如果<code>process_view</code>返回 None，就继续执行后续的中间件的<code>process_view</code>方法，执行完所有的<code>process_view</code>函数之后执行视图函数</li>
<li>如果其中有个 process_view 返回了 HttpResponse，就不执行后续的 process_view 函数，会跳到第一个 process_response 函数，并继续往下执行</li>
</ul>
<p><img data-src="../images/pasted-0.png" alt="Diango中中间件处理过程"></p>
<h2 id="中间件-类-中5种方法"><a href="#中间件-类-中5种方法" class="headerlink" title="中间件(类)中5种方法"></a>中间件(类)中5种方法</h2><p>中间件中可以定义5个方法:</p>
<ul>
<li>process_request(request)</li>
<li>process_view(request, view_func, view_args, view_kwargs)</li>
<li>process_exception(request, exception)</li>
<li>process_template_response(request, response)</li>
<li>process_response(request, response)</li>
</ul>
<h3 id="process-request"><a href="#process-request" class="headerlink" title="process_request"></a>process_request</h3><ol>
<li>中间件在收到<code>request</code>请求之后执行</li>
<li>按照<code>settings.py</code>中<code>MIDDLEWARE_CLASSES</code>的顺序，顺序执行</li>
<li>如果该函数返回<code>None</code>，继续执行后面的中间件的<code>process_request</code>方法</li>
<li>如果该函数返回<code>HttpResponse</code>，则不再继续执行后面的中间件的<code>process_request</code>方法</li>
</ol>
<h3 id="process-view"><a href="#process-view" class="headerlink" title="process_view"></a>process_view</h3><ol>
<li>执行完所有中间件的<code>process_request</code>方法</li>
<li>在<code>urls.py</code>中找到对应视图函数</li>
<li>拿到视图函数的名称、参数，在执行视图函数之前执行</li>
<li>如果返回<code>None</code>，则继续执行后面的中间件的<code>process_view</code>函数，然后执行下昂应的视图函数</li>
<li>如果返回<code>HttpResponse</code>，则不执行后续的<code>process_view</code>函数，也不执行视图函数，然后执行所有的<code>response</code>中间件</li>
</ol>
<h3 id="process-exception"><a href="#process-exception" class="headerlink" title="process_exception"></a>process_exception</h3><ol>
<li>执行视图函数的过程中如果引发异常，则按照<code>settings.py</code>中<code>MIDDLEWARE_CLASSES</code>的顺序，倒序执行<code>process_exception</code>方法</li>
<li>如果返回<code>None</code>，继续执行下一个中间件的<code>process_exception</code>方法 </li>
<li>如果返回<code>HttpReponse</code>对象，则该中间件上方其他中间件的<code>process_exception</code>方法不会被调用</li>
<li>一旦其中某个中间件有返回值，则调用<code>template_response</code>和<code>response</code>中间件<br>,否则启动<a href="https://docs.djangoproject.com/zh-hans/2.1/ref/views/#error-views" target="_blank" rel="noopener">默认的异常处理</a></li>
</ol>
<div class="note info">
            <p>最后半句个人理解:如果如果所有中间件的<code>process_exception</code>方法都执完后还没有返回值，则启动默认的异常处理</p>
          </div>
<h3 id="process-template-response"><a href="#process-template-response" class="headerlink" title="process_template_response"></a>process_template_response</h3><ol>
<li>在视图函数执行结束之后执行</li>
<li><code>response</code>是Django视图或者某一中间件的返回值(<code>TemplateResponse</code>对象或等价)</li>
<li>只有<code>response</code>实现了<code>render</code>方法才会执行</li>
<li>一旦所有的中间件的<code>template_response</code>被执行完，则调用<code>render</code>方法</li>
<li>按照中间件的顺序，倒序执行</li>
</ol>
<h3 id="process-response"><a href="#process-response" class="headerlink" title="process_response"></a>process_response</h3><ol>
<li>在视图函数执行结束之后执行</li>
<li>必须有返回值，且返回类型必须是<code>HttpResponse</code>对象</li>
<li>按照中间件的顺序，倒序执行</li>
</ol>
<h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="文件"><a href="#文件" class="headerlink" title="文件"></a>文件</h2><ul>
<li>middleware.py<div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.deprecation <span class="keyword">import</span> MiddlewareMixin</span><br><span class="line"><span class="keyword">from</span> django.models <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.core.serializers.json <span class="keyword">import</span> DjangoJSONEncoder</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMiddleware</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(exception, BaseException):</span><br><span class="line">            <span class="keyword">if</span> settings.DEBUG:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">‘result’</span>: <span class="string">‘’</span>, <span class="string">‘msg’</span>: str(exception), <span class="string">‘status’</span>: <span class="number">1000</span>&#125;)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(UnknownException().as_dict())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(exception.as_dict())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, request, response)</span>:</span></span><br><span class="line">        procese_type = (list, tuple, dict, str, int)</span><br><span class="line">        <span class="keyword">if</span> isinstance(response, models.Model):</span><br><span class="line">            response = str(response)</span><br><span class="line">        <span class="keyword">if</span> isinstance(response, procese_type):</span><br><span class="line">            ret = &#123;<span class="string">‘result’</span>: response, <span class="string">‘msg’</span>: <span class="string">‘success’</span>, <span class="string">‘status’</span>: <span class="number">200</span>&#125;</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(ret, encoder=DjangoJSONEncoder)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
    </div>
</div></li>
<li>exceptions.py<div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta</span><br><span class="line"><span class="keyword">from</span> .message <span class="keyword">import</span> ErrorMsg</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterFaceAsDictInterFace</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">as_dict</span><span class="params">(self)</span>:</span></span><br><span class="line">        ret = &#123;<span class="string">‘result’</span>: <span class="string">‘’</span>, <span class="string">‘msg’</span>: getattr(self, <span class="string">‘<strong>msg</strong>‘</span>, <span class="string">‘’</span>), <span class="string">‘status’</span>: getattr(self, <span class="string">‘<strong>status</strong>‘</span>, <span class="string">‘’</span>)&#125;</span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseException</span><span class="params">(Exception, InterFaceAsDictInterFace)</span>:</span></span><br><span class="line">    <strong>metaclass</strong> = ABCMeta</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title"><strong>init</strong></span><span class="params">(self, msg=None)</span>:</span></span><br><span class="line">        super(BaseException, self).<strong>init</strong>()</span><br><span class="line">        <span class="keyword">if</span> msg <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.<strong>msg</strong> = msg</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnknownException</span><span class="params">(InterFaceAsDictInterFace)</span>:</span></span><br><span class="line">    <strong>status</strong> = <span class="number">1000</span></span><br><span class="line">    <strong>msg</strong> = ErrorMsg.UNKNOWN_EXCEPTION</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyException</span><span class="params">(BaseException)</span>:</span></span><br><span class="line">    <strong>status</strong>=<span class="number">1001</span></span><br><span class="line">    <strong>msg</strong>=ErrorMsg.MY_EXCEPTION</span><br><span class="line"></span><br></pre></td></tr></table></figure>
    </div>
</div></li>
<li>message.py<div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> gettext <span class="keyword">as</span> _</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorMsg</span>:</span></span><br><span class="line">    UNKNOWN_EXCEPTION= _(<span class="string">‘Unknown exception.’</span>)</span><br><span class="line">    MY_EXCEPTION = _(<span class="string">‘Test exception.’</span>)</span><br></pre></td></tr></table></figure>
    </div>
</div>
</li>
</ul>
<h2 id="修改settings文件"><a href="#修改settings文件" class="headerlink" title="修改settings文件"></a>修改settings文件</h2><p>修改<code>setting</code>中的<code>MIDDLEWARE_CLASSES</code>变量<br><div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">‘django.middleware.security.SecurityMiddleware’</span>,</span><br><span class="line">    <span class="string">‘django.contrib.sessions.middleware.SessionMiddleware’</span>,</span><br><span class="line">    <span class="string">‘django.middleware.common.CommonMiddleware’</span>,</span><br><span class="line">    <span class="string">‘django.middleware.csrf.CsrfViewMiddleware’</span>,</span><br><span class="line">    <span class="string">‘django.contrib.auth.middleware.AuthenticationMiddleware’</span>,</span><br><span class="line">    <span class="string">‘django.contrib.messages.middleware.MessageMiddleware’</span>,</span><br><span class="line">    <span class="string">‘django.middleware.clickjacking.XFrameOptionsMiddleware’</span>,</span><br><span class="line">    <span class="string">‘middleware.MyMiddleware’</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
    </div>
</div></p>
<h1 id="Todo"><a href="#Todo" class="headerlink" title="Todo"></a>Todo</h1><h2 id="对前端Post请求进行参数校验"><a href="#对前端Post请求进行参数校验" class="headerlink" title="对前端Post请求进行参数校验"></a>对前端Post请求进行参数校验</h2><p>目前想出来了两种策略(假设<code>post_json</code>为序列化后的字典):</p>
<ol>
<li>视图函数中使用<code>get</code>从字典中获取参数，判断<code>required</code>的参数是否为空，<code>raise</code>自定义的异常，如:<div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># exception.py</span></span><br><span class="line">…</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValidationError</span><span class="params">(BaseException)</span>:</span></span><br><span class="line">    <strong>msg</strong> = ErrorMsg.INVALID_ARGUMENT</span><br><span class="line">    <strong>status</strong> = <span class="number">1001</span></span><br><span class="line">…</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># message.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorMsg</span>:</span></span><br><span class="line">    UNKNOWN_EXCEPTION= _(<span class="string">‘Unknown exception.’</span>)</span><br><span class="line">    INVALID_ARGUMENT = _(<span class="string">‘Invalid arguments.’</span>)</span><br><span class="line">    REQUIRED_ARGUMENT = _(<span class="string">‘A &#123;0&#125; argument is required.’</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># view.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    …</span><br><span class="line">    user_name = post_json.get(<span class="string">‘username’</span>,<span class="string">‘’</span>)<span class="comment"># required</span></span><br><span class="line">    pass_word = post_json.get(<span class="string">‘password’</span>,<span class="string">‘’</span>)<span class="comment"># required</span></span><br><span class="line">    user_type = post_json.get(<span class="string">‘user_type’</span>,<span class="string">‘’</span>)<span class="comment"># not required</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> username <span class="keyword">or</span> <span class="keyword">not</span> password:</span><br><span class="line">        <span class="keyword">raise</span> ValidationError(ErrorMsg.REQUIRED_ARGUMENT.format(<span class="string">‘username/passswordd’</span>))</span><br><span class="line">    …</span><br></pre></td></tr></table></figure>
    </div>
</div></li>
<li>视图函数中对参数不做校验，只需在中间件添加一句，即可对视图函数中<code>raise</code>的<code>KeyError</code>进行统一处理<div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># exception.py</span></span><br><span class="line">…</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValidationError</span><span class="params">(BaseException)</span>:</span></span><br><span class="line">    <strong>msg</strong> = ErrorMsg.INVALID_ARGUMENT</span><br><span class="line">    <strong>status</strong> = <span class="number">1001</span></span><br><span class="line">…</span><br><span class="line"></span><br><span class="line"><span class="comment"># middleware.py</span></span><br><span class="line">…</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self, request, exception)</span>:</span></span><br><span class="line"> <span class="keyword">if</span> isinstance(exception, KeyError):</span><br><span class="line">    exception = ValidationError(ErrorMsg.REQUIRED_ARGUMENT.format(exception))</span><br><span class="line">    …</span><br><span class="line"></span><br><span class="line"><span class="comment"># message.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ErrorMsg</span>:</span></span><br><span class="line">    UNKNOWN_EXCEPTION= _(<span class="string">‘Unknown exception.’</span>)</span><br><span class="line">    INVALID_ARGUMENT = _(<span class="string">‘Invalid arguments.’</span>)</span><br><span class="line">    REQUIRED_ARGUMENT = _(<span class="string">‘A &#123;0&#125; argument is required.’</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># view.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(request)</span>:</span></span><br><span class="line">    …</span><br><span class="line">    user_name = post_json[<span class="string">‘user_name’</span>] <span class="comment"># required</span></span><br><span class="line">    user_type = post_json.get(<span class="string">‘user_type’</span>,<span class="string">‘’</span>)<span class="comment"># not required</span></span><br><span class="line">    …</span><br><span class="line"></span><br></pre></td></tr></table></figure>
    </div>
</div>
</li>
</ol>
<h2 id="视图函数返回"><a href="#视图函数返回" class="headerlink" title="视图函数返回"></a>视图函数返回</h2><p>目前视图函数必须有返回值，不能为<code>None</code>，还不知道怎么解决</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><a href="https://docs.djangoproject.com/zh-hans/2.1/topics/http/middleware/" target="_blank" rel="noopener">Django 中间件官方文档</a></li>
<li><a href="https://docs.djangoproject.com/zh-hans/2.2/topics/i18n/translation/" target="_blank" rel="noopener">Django 国际化官方文档</a></li>
<li><a href="https://github.com/shaowenchen/django-exceptionbox" target="_blank" rel="noopener">Github项目(django-exceptionbox)</a></li>
<li><a href="https://www.chenshaowen.com/blog/error-code-design-and-unified-processing-in-django.html#32-ExceptionBox" target="_blank" rel="noopener">错误码设计以及 Django 的异常统一处理</a></li>
<li><a href="https://www.cnblogs.com/huchong/p/7819296.html" target="_blank" rel="noopener">Django—-中间件详解</a></li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Django</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>API</tag>
        <tag>Django</tag>
      </tags>
  </entry>
  <entry>
    <title>人生苦短，我用Python</title>
    <url>/2604890615.html</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>前几日代写留学生作业时遇到了两道很有意思的Python编程题，在此做一记录，主要涉及到一些Python的高级特性:生成器、lambda表达式。<br><a id="more"></a></p>
<h1 id="Question-1"><a href="#Question-1" class="headerlink" title="Question 1"></a>Question 1</h1><h2 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h2><p><strong>原文:</strong><br>Consider the following function<br><div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># listOfNumbers is a list of only numbers</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processList</span><span class="params">(listOfNumbers)</span>:</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> listOfNumbers:</span><br><span class="line">        <span class="keyword">if</span> i&lt;<span class="number">0</span> == <span class="number">0</span>:</span><br><span class="line">            result.append(i<em>i)</em></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append((ii)+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
    </div>
</div></p>
<p>First, study and test processList(listOfNumbers) to determine what it does Then rewrite its body so that it accomplishes the same task with a one-line list comprehension. Thus, the resulting function will have exactly two lines, the def line and a return line containing a list comprehension expression.<br><strong>翻译:</strong><br>将给出的一个函数变成两行</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>函数的功能是:遍历listofNumbers中的每一个元素，如果大于等于0，将其变成自己乘以自己，否则变为自己乘自己后再加一。<br>因此，我们可以用到Python中的三元表达式，下面这两种方式是等价的。<br><code>value = true if condition else false</code><br>与<br><div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> condition:</span><br><span class="line">    value = true</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    value = false</span><br></pre></td></tr></table></figure>
    </div>
</div></p>
<h2 id="参考答案"><a href="#参考答案" class="headerlink" title="参考答案"></a>参考答案</h2><div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processList</span><span class="params">(listOfNumbers)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [i <em> i <span class="keyword">if</span> i &gt;= <span class="number">0</span> <span class="keyword">else</span> i </em> i + <span class="number">1</span> <span class="keyword">for</span> i <span class="keyword">in</span> listOfNumbers]</span><br></pre></td></tr></table></figure>
    </div>
</div>
<h1 id="Question-2"><a href="#Question-2" class="headerlink" title="Question 2"></a>Question 2</h1><h2 id="题意-1"><a href="#题意-1" class="headerlink" title="题意"></a>题意</h2><p><strong>原文:</strong><br>Implement function processList2(inputList, specialItem, ignoreItems) that returns a new list that contains all the items of inputList (and in the original order) except 1) any that appear in the list ignoreItems, and 2) occurrences of specialItem (if specialItem is not in ignoreItems) should become the string “special” in the new list. Use a one-line list cluoomprehension to construct the new list. Thus, again, the function will have exactly two lines, the def line and a return line containing a list comprehension expression. For example,<br><div class="note default no-icon">
            <p>processList2([1,2,3,4], 4, [3])<br>[1, 2, ‘special’]<br>processList2([1,2,3,4,True,’dog’], 4, [3,5,4])<br>[1, 2, True, ‘dog’]<br>processList2([1,1,2,2], 1, [2])<br>[‘special’, ‘special’]</p>
          </div><br><strong>翻译:</strong><br>实现函数processList2(inputList, specialItem, ignoreItems)，对inputList中的元素进行处理，返回一个新列表，但需满足以下两个要求:</p>
<ol>
<li>不能是出现在ignoreItems中的元素</li>
<li>对于与specialItem相同的元素(不能在ignoreItems中出现)，将其变成”special”。</li>
</ol>
<h2 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h2><ol>
<li>首先将不在ignoreItems中的那些元素筛出来<code>[x for x in inputList if x not in ignoreItems]</code>或<code>list(filter(lambda x:False if x in ignoreItems else True,inputList))</code>。</li>
<li>然后遍历上述列表中的元素，将specialItem变成”special”,<code>[&quot;special&quot; if x == specialItem else x for x in xxx]</code></li>
</ol>
<h2 id="参考答案-1"><a href="#参考答案-1" class="headerlink" title="参考答案"></a>参考答案</h2><div class="spoiler collapsed">
    <div class="spoiler-title">
        Code
    </div>
    <div class="spoiler-content">
        <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processList2</span><span class="params">(inputList, specialItem, ignoreItems)</span>:</span></span><br><span class="line">    <span class="comment">## two method</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="string">“special”</span> <span class="keyword">if</span> x == specialItem <span class="keyword">else</span> x <span class="keyword">for</span> x <span class="keyword">in</span> list(filter(<span class="keyword">lambda</span> x:<span class="literal">False</span> <span class="keyword">if</span> x <span class="keyword">in</span> ignoreItems <span class="keyword">else</span> <span class="literal">True</span>,inputList))]</span><br><span class="line">    <span class="keyword">return</span>[<span class="string">“special”</span> <span class="keyword">if</span> x == specialItem <span class="keyword">else</span> x <span class="keyword">for</span> x <span class="keyword">in</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> inputList <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> ignoreItems]]</span><br></pre></td></tr></table></figure>
    </div>
</div>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="http://www.runoob.com/python3/python3-func-filter.html" target="_blank" rel="noopener">filter() 函数</a></li>
<li><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431779637539089fd627094a43a8a7c77e6102e3a811000" target="_blank" rel="noopener">列表生成式</a></li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>lambda</tag>
      </tags>
  </entry>
  <entry>
    <title>ThinkServer RD650安装Ubuntu Server 16.04</title>
    <url>/560540611.html</url>
    <content><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol>
<li>在Ubuntu官网上下载Ubuntu Server 16.04的ISO镜像(<a href="http://releases.ubuntu.com/16.04/" target="_blank" rel="noopener">下载链接</a>)；</li>
<li>使用刻录软件(如:软碟通)将iso镜像文件写入U盘中，制成启动盘；</li>
<li>将ISO镜像文件拷贝至U盘的根目录，为了方便后续操作，这里可将镜像文件重命名为<code>Ubuntu.iso</code>；<a id="more"></a>
</li>
</ol>
<h2 id="设置引导"><a href="#设置引导" class="headerlink" title="设置引导"></a>设置引导</h2><ol>
<li>按电源键开机，启动服务器(服务器启动可能会比较缓慢)；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724134039.jpg" alt></li>
<li>出现此界面时，按”F10”进入TDM(ThinkServer Deployment Manager)；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724134100.jpg" alt></li>
<li>进入TDM后，选择”BIOS Setup(BIOS 设置)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724134421.jpg" alt></li>
<li>选择”Boot Manager(引导管理)”,将”Boot Mode(引导模式)”改为”UEFI Only(仅UEFI模式)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724134519.jpg" alt></li>
<li>点击”Save &amp; Reset(保存 &amp; 重启)”,在弹出的对话框中选择”Yes(是)”重启电脑。如果出现如下对话框，选择”No(否)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724134545.jpg" alt></li>
</ol>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><ol>
<li>将U盘插入服务器后的USB插槽中，重启服务器，进入下图所示界面。选择”Install Ubuntu Server(安装Ubuntu服务器版)”；<br>注:若无法进入下图所示界面，请进入BIOS修改U盘为第一启动项。<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165615.jpg" alt></li>
<li>选择安装过程和系统的默认语言为”English(英语)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165649.jpg" alt></li>
<li>“Select your location(选择你的区域)”，这里选择”Other(其他)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724153430.jpg" alt></li>
<li>“Continent or region(大陆或地区)”选择”Asia(亚洲)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724153439.jpg" alt></li>
<li>“Country(国家)”选择”China(中国)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724153448.jpg" alt></li>
<li>是否通过一系列的按键检测键盘布局，选择”NO(否)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165712.jpg" alt></li>
<li>字符集编码选择”United States -en_US.UTF-8”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724153454.jpg" alt></li>
<li>“Country or Region for the keyboard(键盘布局所属国家或地区)”,选择”English(US)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165717.jpg" alt></li>
<li>“Keyboard layout(键盘布局)”，选择”English(US)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165725.jpg" alt></li>
<li>稍等片刻，将会显示出现错误,原因为:安装程序未检测到CD-ROM。是否重试，选择”No(否)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165744.jpg" alt></li>
<li>进入如下界面，选择”Execute a shell(运行shell)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165801.jpg" alt></li>
<li>在shell中依次输入如下命令:<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ls /dev/sd*</span><br><span class="line">umount /dev/sdb4/</span><br><span class="line">mkdir udev</span><br><span class="line">mount /dev/sdb4 /udev</span><br><span class="line">mount /udev/ubuntu.iso /cdrom</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>一般会出现两个<code>/dev/sdb*</code>项，我们选择带数字的那一项去替换上面代码中的<code>/dev/sdb4</code>;<br><code>ubuntu.iso</code>为U盘中Ubuntu Server的ISO镜像的文件名”。<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165911.jpg" alt></p>
<ol start="13">
<li>进入如下界面后，选择”Detect and mount CD-ROM(探测并挂载光盘)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165919.jpg" alt></li>
<li>进入如下界面，选择”Network interface(网络接口)”，这里选择第一个网络接口，等待安装程序自动完成配置；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723165949.jpg" alt></li>
<li>设置”Hostname(主机名)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170037.jpg" alt></li>
<li>设置”Full name for the new user(新用户的全名)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170121.jpg" alt></li>
<li>设置”Username for your account(你账号的用户名)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170137.jpg" alt></li>
<li>设置”password for the new user(新用户的密码)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170145.jpg" alt></li>
<li>如果所设置的密码较为简单，可能会弹出如下对话框，询问你是否使用一个”weak password(弱口令)”，选择”Yes(是)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170157.jpg" alt></li>
<li>出现如下界面，询问你是否”Encrypt your home directory(加密你的主目录)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170208.jpg" alt></li>
<li>然后可能会出现时区设置错误，选择 “Continue(继续)”,进入如下界面，选择”Install the system(安装系统)”,然后直接回车，选择”Partion disks(磁盘分区)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170228.jpg" alt><br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170234.jpg" alt></li>
<li>出现下图界面，询问你是否”Umount partitions that are in use(卸载正在使用的分区)”，选择”Yes(是)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170255.jpg" alt></li>
<li>选择”Partitioning method(分区方法)”，这里我们选择”Guided - use entire disk and set up LVM(使用整个磁盘并配置LVM)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170318.jpg" alt></li>
<li>“Select disk to partition(选择要分区的磁盘)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170325.jpg" alt></li>
<li>选择”Partitioning Scheme(分区方案) “，这里推荐选择”All files in one partition(所有文件放在同一分区)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170331.jpg" alt></li>
<li>出现如下界面，询问你是否”Write the changes to disks and configure LVM(将修改写入磁盘并配置LVM)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170342.jpg" alt></li>
<li>设置”Name of the volume group for the new system(新系统的卷组名)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170359.jpg" alt></li>
<li>设置”Amount of volume group to use for guided partitioning(用于分区引导的卷组数)”，默认大小即可，无需修改；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170421.jpg" alt></li>
<li>出现下图界面，询问你是否”Umount partitions that are in use(卸载正在使用的分区)”，选择”Yes(是)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170434.jpg" alt></li>
<li>出现如下界面，询问你是否”Force UEFI installation(强制UEFI安装)”，选择”Yes(是)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170442.jpg" alt></li>
<li>出现如下界面，询问是否”Write the changes to disks(将改动写入磁盘)”，选择”Yes(是)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170452.jpg" alt></li>
<li>“Kernel to install(要安装的内核)”,选择默认的”Linux-generic”即可；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170544.jpg" alt></li>
<li>回车后出现如下界面，这里要选择包含在initrd中的驱动程序，选择默认的”generic:include all available drivers(通用:包含所有可用的驱动程序)”即可；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170555.jpg" alt></li>
<li>“HTTP proxy information(HTTP代理信息)”不写，直接回车即可；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170657.jpg" alt></li>
<li>询问你管理系统更新的方式，选择”No automatic updates(不自动更新)”；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170737.jpg" alt></li>
<li>“Choose software to install(选择要安装的软件)”，建议勾选上”OpenSSh server”，然后回车;<br>选择方法为:通过键盘上下键移动光标至选要择项，在要选择的项上按空格即可；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180724154325.jpg" alt></li>
<li>回车后，显示安装完成，继续回车，重启系统，此时就可以拔掉U盘；<br><img data-src="/images/Ubuntu Server 16.04/IMG20180723170940.jpg" alt></li>
<li>重启后，再次进入TDM，将”Boot Mode(引导模式)”改为”Legacy　Only(仅Legacy模式)”，否则有可能出现不能进入Linux系统的情况；</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>Ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>用C#爬虫爬取校园最新通知</title>
    <url>/976598171.html</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前几个月用Python写了一个爬虫，用于爬取校园最新通知。最近的C#课程设计中想实现同样的功能，于是按照之前Python代码的思路重构了一下。<br><a href="https://zhaoqi99.github.io/45013.html" target="_blank" rel="noopener">用Python实现校园通知更新提醒</a><br><a id="more"></a></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>使用C#中的HttpWebRequest库去获取目标url(各个网站的’更多通知’页)的源代码，然后使用<code>System.Text.RegularExpressions;</code>进行正则匹配。<br>正则表达式应包含三个分组:日期、标题、链接；</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul>
<li>命名空间导入<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><p>Spider基类:<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Spider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> url = <span class="keyword">string</span>.Empty;<span class="comment">//要爬取的网页的url</span></span><br><span class="line">    <span class="keyword">public</span> HttpWebRequest request;</span><br><span class="line">    <span class="keyword">public</span> HttpWebResponse response;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> encode = <span class="string">"UTF-8"</span>;<span class="comment">//目标url的网页编码格式</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Method = <span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Url</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> url; &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            url = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Encode</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> &#123; <span class="keyword">return</span> encode; &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> == <span class="string">"UTF-8"</span> || <span class="keyword">value</span> == <span class="string">"GBK"</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                encode = <span class="keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//Todo:handle exception</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Spider</span>(<span class="params"><span class="keyword">string</span> url,<span class="keyword">string</span> method</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.Method = method;</span><br><span class="line">        Create();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Spider</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Create</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class="line">        request.Method = Method;</span><br><span class="line">        request.Credentials = CredentialCache.DefaultCredentials;</span><br><span class="line">        request.UserAgent = <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取目标url的Html代码</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">getHtml</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">string</span> reader = <span class="keyword">string</span>.Empty;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            Create();</span><br><span class="line">            response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">            <span class="keyword">if</span> (response.StatusCode == HttpStatusCode.OK)</span><br><span class="line">            &#123;</span><br><span class="line">                StreamReader sr = <span class="keyword">new</span> StreamReader(response.GetResponseStream(), Encoding.GetEncoding(encode));</span><br><span class="line">                reader = sr.ReadToEnd();</span><br><span class="line">                sr.Close();</span><br><span class="line">                response.Close();<span class="comment">//关闭response响应流</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            Log.Write( e.Message, <span class="string">"Exception"</span>);</span><br><span class="line">            MessageBox.Show(e.Message, <span class="string">"错误"</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reader;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>SpiderNotice类:<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SpiderNotice</span> : <span class="title">Spider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> url_main;<span class="comment">//各个通知链接的公共部分</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> department;<span class="comment">//所属部门</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> type;<span class="comment">//通知类型</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> pattern;<span class="comment">//用于匹配的正则表达式规则</span></span><br><span class="line">    <span class="keyword">private</span> ArrayList all_notice = <span class="keyword">new</span> ArrayList();<span class="comment">//所有的通知</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> parse = <span class="keyword">string</span>.Empty;<span class="comment">//日期的解析规则</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SpiderNotice</span>(<span class="params"><span class="keyword">string</span> url, <span class="keyword">string</span> pattern, <span class="keyword">string</span> url_main, <span class="keyword">string</span> department, <span class="keyword">string</span> type</span>) : <span class="title">base</span>(<span class="params">url, <span class="string">"GET"</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.department = department;</span><br><span class="line">        <span class="keyword">this</span>.pattern = pattern;</span><br><span class="line">        <span class="keyword">this</span>.url_main = url_main;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.parse = <span class="string">"yyyy-MM-dd"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Get</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        all_notice.Clear();</span><br><span class="line">        Regex r = <span class="keyword">new</span> Regex(pattern, RegexOptions.ExplicitCapture);</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> s = getHtml();</span><br><span class="line">            <span class="keyword">if</span> (s == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">"html"</span>);</span><br><span class="line">            MatchCollection mc = r.Matches(s);</span><br><span class="line">            <span class="keyword">foreach</span> (Match m <span class="keyword">in</span> mc)</span><br><span class="line">            &#123;</span><br><span class="line">                GroupCollection <span class="keyword">group</span> = m.Groups;</span><br><span class="line">                DateTime date = DateTime.ParseExact(<span class="keyword">group</span>[<span class="string">"date"</span>].Value, parse, System.Globalization.CultureInfo.InstalledUICulture);</span><br><span class="line">                <span class="keyword">string</span> link = url_main + <span class="keyword">group</span>[<span class="string">"link"</span>].Value;</span><br><span class="line">                Notice n = <span class="keyword">new</span> Notice();</span><br><span class="line">                n.Title = <span class="keyword">group</span>[<span class="string">"title"</span>].Value;</span><br><span class="line">                n.Link = link;</span><br><span class="line">                n.Date = date;</span><br><span class="line">                n.Department = department;</span><br><span class="line">                n.Type = type;</span><br><span class="line">                all_notice.Add(n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            BLL.Log.Write(e.Message, <span class="string">"Exception"</span>);</span><br><span class="line">            MessageBox.Show(e.Message, <span class="string">"错误"</span>, MessageBoxButtons.OK, MessageBoxIcon.Error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Notice <span class="title">index</span>(<span class="params"><span class="keyword">int</span> index</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= all_notice.Count)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IndexOutOfRangeException();</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> all_notice[index] <span class="keyword">as</span> Notice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Notice[] <span class="title">GetAll</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Notice[] All = <span class="keyword">new</span> Notice[all_notice.Count];</span><br><span class="line">        <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">object</span> t <span class="keyword">in</span> all_notice)</span><br><span class="line">        &#123;</span><br><span class="line">            All[flag++] = t <span class="keyword">as</span> Notice;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> All;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Count</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> all_notice.Count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>数据模型Notice类:<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Notice</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">region</span> 数据模型</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> title=<span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> link=<span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">private</span> DateTime date=DateTime.Now;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> type=<span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">string</span> department=<span class="keyword">string</span>.Empty;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Title</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> title;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            title = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime Date</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> date;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            date = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Link</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            link = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> link;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Type</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> type;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            type = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Department</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> department;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span></span><br><span class="line">        &#123;</span><br><span class="line">            department = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">    <span class="function"><span class="keyword">override</span> <span class="keyword">public</span> <span class="keyword">string</span> <span class="title">ToString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">string</span>.Format(<span class="string">"标题:&#123;0&#125;\n时间:&#123;1&#125;\n链接:&#123;2&#125;\n"</span>, title, date.ToString(<span class="string">"yyyy-MM-dd"</span>), link);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><ul>
<li><p>从不同网站上爬取到的日期格式可能不同，为统一格式，可以使用｀DateTime.ParseExact(datastr, parse, System.Globalization.CultureInfo.InstalledUICulture);｀去解析用于表示日期的字符串，然后再转为统一日期格式的字符串。其中，datastr为表示日期的字符串，parse为解析规则。例:</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> parse=<span class="string">"yyyy-M-D"</span>;</span><br><span class="line">DateTime t=DateTime.ParseExact(<span class="string">"2016-9-5"</span>, parse, System.Globalization.CultureInfo.InstalledUICulture);</span><br><span class="line"><span class="keyword">string</span> str=t.toString(<span class="string">"yyyy-MM-dd"</span>);<span class="comment">//2016-09-05</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>不用网页的网页编码格式可能不同，有的为GBK,有的问UTF-8;</p>
</li>
<li>用字符串去表达正则表达式的规则时，有两种方法:<ol>
<li>string s=@”\d+”””;字符串前加@表示字符串按常量解析(注意:双引号用两个双引号来表示)</li>
<li>string s=”\d+\””;使用转义符</li>
</ol>
</li>
</ul>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>C#中自己生成验证码</title>
    <url>/1000607951.html</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近写C#课程设计时，登录验证处需用到验证码，于是参照网上博客，自己封装了一个验证码类，和网上其他博客相比，有以下优点:</p>
<ul>
<li>去除了0,o,O与1,l等容易混淆的字符</li>
<li>使用方便，仅需三行代码</li>
<li>内置有返回MD5加密后的字符串的方法，便于前端调用<a id="more"></a>
</li>
</ul>
<h2 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h2><h3 id="公有方法"><a href="#公有方法" class="headerlink" title="公有方法"></a>公有方法</h3><ul>
<li>SecurityCode(int length);//构造函数</li>
<li>SecurityCode(int length, int width, int height);//构造函数</li>
<li>void UpdateVerifyCode();//刷新验证码</li>
<li>Bitmap getImage();//返回验证码图片</li>
<li>string MD5Encrypt();//返回经MD5加密过的验证码字符串</li>
<li>bool Check(string text);//返回校验结果(不区分大小写)</li>
</ul>
<h3 id="私有方法"><a href="#私有方法" class="headerlink" title="私有方法"></a>私有方法</h3><ul>
<li>void CreateVerificationText(int length);//随机生成验证码字符串</li>
<li>void CreateImage();//生成验证码图片</li>
<li>Color RandColor();//生成随机颜色</li>
<li>Point RandPoint();//生成随机点</li>
</ul>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">SecurityCode Code=<span class="keyword">new</span> SecurityCode(<span class="number">4</span>);</span><br><span class="line">code.UpdateVerifyCode();</span><br><span class="line">picturebox.Image=code.getImage();</span><br></pre></td></tr></table></figure>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img data-src="/images/securitycode.jpg" alt="验证码"></p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">SecurityCode</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random();<span class="comment">//生成随机数</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">string</span> VerificationText = <span class="keyword">string</span>.Empty;<span class="comment">//验证码字符串</span></span><br><span class="line">        <span class="keyword">private</span> Bitmap map;<span class="comment">//验证码的位图</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> length;<span class="comment">//验证码的字符个数</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> width;<span class="comment">//验证码图片的宽度</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> height;<span class="comment">//验证码图片的高度</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SecurityCode</span>(<span class="params"><span class="keyword">int</span> length, <span class="keyword">int</span> width, <span class="keyword">int</span> height</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.length = length;</span><br><span class="line">            <span class="keyword">this</span>.width = width;</span><br><span class="line">            <span class="keyword">this</span>.height = height;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SecurityCode</span>(<span class="params"><span class="keyword">int</span> length</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">this</span>.length = length;</span><br><span class="line">            <span class="keyword">this</span>.width = (length + <span class="number">1</span>) * <span class="number">25</span>;</span><br><span class="line">            <span class="keyword">this</span>.height = <span class="number">40</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//随机生成验证码字符串</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateVerificationText</span>(<span class="params"><span class="keyword">int</span> length</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            VerificationText = <span class="keyword">string</span>.Empty;</span><br><span class="line">            <span class="keyword">string</span> dictionary = <span class="string">"ABCDEFGHIJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz23456789"</span>;<span class="comment">//去除O,o,0 ,l,1</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> index = rand.Next(<span class="number">0</span>, dictionary.Length);</span><br><span class="line">                VerificationText += dictionary[index].ToString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//刷新验证码</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UpdateVerifyCode</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CreateVerificationText(length);</span><br><span class="line">            CreateImage();</span><br><span class="line">            <span class="comment">//Console.WriteLine(MD5Encrypt(VerificationText));//Only for test</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//生成验证码图片</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CreateImage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            map = <span class="keyword">new</span> Bitmap(width, height);</span><br><span class="line">            Graphics g = Graphics.FromImage(map);</span><br><span class="line">            Pen pen = <span class="keyword">new</span> Pen(Color.Black);</span><br><span class="line">            <span class="keyword">string</span>[] font = &#123; <span class="string">"Verdana"</span>, <span class="string">"Microsoft Sans Serif"</span>, <span class="string">"Consolas"</span>, <span class="string">"Arial"</span>, <span class="string">"宋体"</span> &#125;;</span><br><span class="line">            Font f = <span class="keyword">new</span> Font(<span class="string">"Arial"</span>, <span class="number">20</span>, FontStyle.Bold);</span><br><span class="line">            g.Clear(Color.White);</span><br><span class="line">            SolidBrush brush = <span class="keyword">new</span> SolidBrush(Color.White);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//绘制干扰线条</span></span><br><span class="line">            pen.Width = <span class="number">0.1F</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">15</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                pen.Color = RandColor();</span><br><span class="line">                g.DrawLine(pen, RandPoint(), RandPoint());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//绘制干扰点</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">80</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Point p = RandPoint();</span><br><span class="line">                map.SetPixel(p.X, p.Y, RandColor());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//绘制字符串</span></span><br><span class="line">            SizeF  StringSizeF = g.MeasureString(VerificationText, f);</span><br><span class="line">            PointF StartPoint = <span class="keyword">new</span> Point(<span class="number">0</span>, (height - (<span class="keyword">int</span>)StringSizeF.Height) / <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                brush.Color = RandColor();</span><br><span class="line">                <span class="keyword">int</span> index = rand.Next(<span class="number">5</span>);</span><br><span class="line">                f = <span class="keyword">new</span> Font(font[index], <span class="number">20</span>, FontStyle.Bold);</span><br><span class="line">                StartPoint.X += <span class="number">5</span>;</span><br><span class="line">                g.DrawString(VerificationText[i].ToString(), f, brush, StartPoint);</span><br><span class="line">                SizeF CharSizeF = g.MeasureString(VerificationText[i].ToString(), f);</span><br><span class="line">                StartPoint.X += CharSizeF.Width;</span><br><span class="line">            &#125;</span><br><span class="line">            g.Dispose();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//生成随机颜色</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Color <span class="title">RandColor</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Color c = Color.FromArgb(rand.Next(<span class="number">1</span>, <span class="number">256</span>), rand.Next(<span class="number">1</span>, <span class="number">255</span>), rand.Next(<span class="number">1</span>, <span class="number">255</span>));</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//生成随机点</span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> Point <span class="title">RandPoint</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">int</span> x = rand.Next(<span class="number">0</span>, map.Width);</span><br><span class="line">            <span class="keyword">int</span> y = rand.Next(<span class="number">0</span>, map.Height);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Point(x, y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回验证码图片</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getImage</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> map;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回经MD5加密过的验证码字符串</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">MD5Encrypt</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> Tool.MD5Encrypt(VerificationText);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回校验结果</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">Check</span>(<span class="params"><span class="keyword">string</span> text</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> text.ToUpper().Equals(VerificationText.ToUpper());<span class="comment">//不区分大小写</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
        <tag>.NET</tag>
      </tags>
  </entry>
  <entry>
    <title>使用c#中的HttpWebRequest实现12306余票查询</title>
    <url>/1797370495.html</url>
    <content><![CDATA[<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ol>
<li>下载用于解析JSON的类库(Newtonsoft.Json.dll)(下载地址:<a href="https://archive.codeplex.com/?p=json" target="_blank" rel="noopener">Newtonsoft.Json.dll</a>)；</li>
<li>在C#项目中添加对其的引用。</li>
<li>在程序中导入命名空间:<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br><span class="line"><span class="keyword">using</span> System.Xml;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<a id="more"></a>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><h3 id="API地址"><a href="#API地址" class="headerlink" title="API地址"></a>API地址</h3><p>在浏览器中打开12306主页，点击<strong>余票查询</strong>，并使用浏览器中的开发者工具，进行抓包。这里，我们查询的是2018.06.25的上海至长沙的车票信息。<br><img data-src="/images/trainticket1.jpg" alt="开发者工具抓包"><br>此时浏览器发送请求的地址为：<br><code>https://kyfw.12306.cn/otn/leftTicket/query?leftTicketDTO.train_date=2018-06-25&amp;leftTicketDTO.from_station=SHH&amp;leftTicketDTO.to_station=CSQ&amp;purpose_codes=ADULT</code><br>由此,我们不难分析出API地址为：<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> url=<span class="string">"https://kyfw.12306.cn/otn/leftTicket/query?leftTicketDTO.train_date=&#123;0&#125;&amp;leftTicketDTO.from_station=&#123;1&#125;&amp;leftTicketDTO.to_station=&#123;2&#125;&amp;purpose_codes=&#123;3&#125;"</span>;</span><br><span class="line">url=<span class="keyword">string</span>.Format(url,date,<span class="keyword">from</span>,to,id);</span><br></pre></td></tr></table></figure></p>
<p>其中，date代表出发日(格式为yyyy-MM-dd),from代表出发站的代码，to代表到达站的代码，id代表车票类型(成人为<code>ADULT</code>,学生为<code>OX00</code>);</p>
<h3 id="车站代码"><a href="#车站代码" class="headerlink" title="车站代码"></a>车站代码</h3><p>车站对应的代码可在此下载:<a href="https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9055" target="_blank" rel="noopener">https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9055</a><br>我们可以使用正则表达式从中提取出关键信息，并保存在一个XML文档中，便于以后的使用。<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StationNameXml</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>     &#123;</span><br><span class="line">         <span class="keyword">string</span> nowpath = Environment.CurrentDirectory;</span><br><span class="line">         <span class="keyword">if</span> (Directory.Exists(nowpath+<span class="string">"/Data"</span>)==<span class="literal">false</span>)</span><br><span class="line">             Directory.CreateDirectory(nowpath + <span class="string">"/Data"</span>);<span class="comment">//创建新路径</span></span><br><span class="line">         <span class="keyword">if</span> (File.Exists(nowpath + <span class="string">"/Data/StationName.xml"</span>) == <span class="literal">true</span>)</span><br><span class="line">             <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">HttpWebRequest request;</span><br><span class="line">  		HttpWebResponse response;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">string</span> url=<span class="string">@"https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9055"</span>;</span><br><span class="line"></span><br><span class="line">         request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class="line">         request.Method = <span class="string">"GET"</span>;</span><br><span class="line">         request.Credentials = CredentialCache.DefaultCredentials;</span><br><span class="line">         request.UserAgent = <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"</span>;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">string</span> str = <span class="keyword">string</span>.Empty;</span><br><span class="line">         <span class="keyword">try</span></span><br><span class="line">         &#123;</span><br><span class="line">             response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">             <span class="keyword">if</span> (response.StatusCode == HttpStatusCode.OK)</span><br><span class="line">             &#123;</span><br><span class="line">                 StreamReader sr = <span class="keyword">new</span> StreamReader(response.GetResponseStream(), Encoding.GetEncoding(<span class="string">"UTF-8"</span>));</span><br><span class="line">                 str = sr.ReadToEnd();</span><br><span class="line">                 sr.Close();</span><br><span class="line">                 response.Close();<span class="comment">//关闭response响应流</span></span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                 <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">catch</span>(Exception e)</span><br><span class="line">         &#123;</span><br><span class="line">	Console.WriteLine(e.Message);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">string</span> pattern = <span class="string">@"@\S&#123;2,5&#125;?[|](?&lt;Name&gt;\S&#123;1,8&#125;?)[|](?&lt;Code&gt;\S&#123;3,5&#125;?)[|]"</span>;</span><br><span class="line">         Regex r = <span class="keyword">new</span> Regex(pattern, RegexOptions.ExplicitCapture);</span><br><span class="line"></span><br><span class="line">         XmlDocument xmldoc = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">         XmlDeclaration xmldecl;</span><br><span class="line"></span><br><span class="line">         xmldecl = xmldoc.CreateXmlDeclaration(<span class="string">"1.0"</span>, <span class="string">"UTF-8"</span>, <span class="literal">null</span>);<span class="comment">//加入XML的声明段落</span></span><br><span class="line">         xmldoc.AppendChild(xmldecl);</span><br><span class="line"></span><br><span class="line">         XmlElement root = xmldoc.CreateElement(<span class="string">""</span>, <span class="string">"Dict"</span>, <span class="string">""</span>);<span class="comment">//加入一个根元素</span></span><br><span class="line">         xmldoc.AppendChild(root);</span><br><span class="line"></span><br><span class="line">         MatchCollection mc = r.Matches(str);</span><br><span class="line">         <span class="keyword">foreach</span> (Match m <span class="keyword">in</span> mc)</span><br><span class="line">         &#123;</span><br><span class="line">             GroupCollection <span class="keyword">group</span> = m.Groups;</span><br><span class="line">             XmlNode node = xmldoc.CreateNode(XmlNodeType.Element, <span class="string">"Pair"</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">             XmlNode temp = xmldoc.CreateNode(XmlNodeType.Element, <span class="string">"Station"</span>, <span class="literal">null</span>);</span><br><span class="line">             temp.InnerText = <span class="keyword">group</span>[<span class="string">"Name"</span>].Value; </span><br><span class="line">             node.AppendChild(temp);</span><br><span class="line"></span><br><span class="line">             XmlNode temp2 = xmldoc.CreateNode(XmlNodeType.Element, <span class="string">"Code"</span>, <span class="literal">null</span>);</span><br><span class="line">             temp2.InnerText = <span class="keyword">group</span>[<span class="string">"Code"</span>].Value;</span><br><span class="line">             node.AppendChild(temp2);</span><br><span class="line"></span><br><span class="line">             root.AppendChild(node);</span><br><span class="line">         &#125;</span><br><span class="line">         xmldoc.Save(nowpath+<span class="string">"/Data/"</span>+<span class="string">"StationName.xml"</span>);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure></p>
<p><img data-src="/images/trainticket2.jpg" alt="车站代码"><br>依据中文车站名获取对应车站代码的方法为:<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">StationCode</span>(<span class="params"><span class="keyword">string</span> StationName</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    XmlDocument doc = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">    doc.Load(Environment.CurrentDirectory + <span class="string">"/Data/StationName.xml"</span>);</span><br><span class="line">    XmlNodeList data = doc.DocumentElement.ChildNodes;</span><br><span class="line">    <span class="keyword">foreach</span> (XmlNode node <span class="keyword">in</span> data)</span><br><span class="line">    &#123;</span><br><span class="line">        XmlElement xe = (XmlElement)node;</span><br><span class="line">        XmlNodeList xnl0 = xe.ChildNodes;</span><br><span class="line">        <span class="keyword">string</span> s = xnl0.Item(<span class="number">0</span>).InnerText;</span><br><span class="line">        <span class="keyword">if</span>(s==StationName)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> xnl0.Item(<span class="number">1</span>).InnerText;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>.Empty;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h3><p>为了存储查询结果，我们需要构建一个车票的数据模型，具体如下；<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Ticket</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="meta">#<span class="meta-keyword">region</span> 数据模型</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> trainid=<span class="keyword">string</span>.Empty;<span class="comment">//车次</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> fromstation = <span class="string">"--"</span>;<span class="comment">//出发站</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> totation = <span class="string">"--"</span>;<span class="comment">//到达站</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> ticketdate = <span class="keyword">string</span>.Empty;<span class="comment">//车票日期</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> starttime = <span class="string">"--"</span>;<span class="comment">//发车时间</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> arrivetime = <span class="string">"--"</span>;<span class="comment">//到达时间</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> lastedtime = <span class="string">"--"</span>;<span class="comment">//历时</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> tzNum = <span class="string">"--"</span>;<span class="comment">//特等座</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> ydNum = <span class="string">"--"</span>;<span class="comment">//一等座</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> edNum = <span class="string">"--"</span>;<span class="comment">//二等座</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> grwNum = <span class="string">"--"</span>;<span class="comment">//高级软卧</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> rwNum = <span class="string">"--"</span>;<span class="comment">//软卧</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> dwNum = <span class="string">"--"</span>;<span class="comment">//动卧</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> ywNum = <span class="string">"--"</span>;<span class="comment">//硬卧</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> rzNum = <span class="string">"--"</span>;<span class="comment">//软座</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> yzNum = <span class="string">"--"</span>;<span class="comment">//硬座</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> wzNum = <span class="string">"--"</span>;<span class="comment">//无座</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> qtNum = <span class="string">"--"</span>;<span class="comment">//其他</span></span><br><span class="line">       <span class="keyword">private</span> <span class="keyword">string</span> identity = <span class="keyword">string</span>.Empty;<span class="comment">//车票类型(学生/成人)</span></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> TrainId &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> trainid; &#125; <span class="keyword">set</span> &#123; trainid = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> FromStation &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> fromstation; &#125; <span class="keyword">set</span> &#123; fromstation = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> ToStation &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> totation; &#125; <span class="keyword">set</span> &#123; totation = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> TicketDate &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> ticketdate; &#125; <span class="keyword">set</span> &#123; ticketdate = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> StartTime &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> starttime; &#125; <span class="keyword">set</span> &#123; starttime = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> ArriveTime &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> arrivetime; &#125;<span class="keyword">set</span> &#123; arrivetime = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> LastedTime &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> lastedtime; &#125; <span class="keyword">set</span> &#123; lastedtime = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> TzNum &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> tzNum; &#125; <span class="keyword">set</span> &#123; tzNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> YdNum &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> ydNum; &#125; <span class="keyword">set</span> &#123; ydNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> EdNum &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> edNum; &#125; <span class="keyword">set</span> &#123; edNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> GrwNum &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> grwNum; &#125; <span class="keyword">set</span> &#123; grwNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> RwNum &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> rwNum; &#125; <span class="keyword">set</span> &#123; rwNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> DwNum &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> dwNum; &#125; <span class="keyword">set</span> &#123; dwNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> YwNum &#123;<span class="keyword">get</span>&#123; <span class="keyword">return</span> ywNum; &#125;<span class="keyword">set</span>&#123; ywNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> RzNum &#123;<span class="keyword">get</span>&#123; <span class="keyword">return</span> rzNum; &#125;<span class="keyword">set</span>&#123; rzNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> YzNum &#123;<span class="keyword">get</span>&#123; <span class="keyword">return</span> yzNum; &#125;<span class="keyword">set</span>&#123; yzNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> WzNum &#123;<span class="keyword">get</span>&#123; <span class="keyword">return</span> wzNum; &#125;<span class="keyword">set</span>&#123; wzNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> QtNum &#123;<span class="keyword">get</span>&#123; <span class="keyword">return</span> qtNum; &#125;<span class="keyword">set</span>&#123; qtNum = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">string</span> Identity &#123; <span class="keyword">get</span> &#123; <span class="keyword">return</span> identity; &#125;<span class="keyword">set</span> &#123; identity = <span class="keyword">value</span>; &#125; &#125;</span><br><span class="line">       <span class="meta">#<span class="meta-keyword">endregion</span></span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">Ticket</span>(<span class="params"></span>)</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; <span class="title">getMap</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>       &#123;</span><br><span class="line">           Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; result = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;();</span><br><span class="line">           result.Add(<span class="string">"车次"</span>, trainid);</span><br><span class="line">           result.Add(<span class="string">"出发站"</span>, FromStation);</span><br><span class="line">           result.Add(<span class="string">"到达站"</span>, ToStation);</span><br><span class="line">           result.Add(<span class="string">"发车时间"</span>, StartTime);</span><br><span class="line">           result.Add(<span class="string">"到达时间"</span>, ArriveTime);</span><br><span class="line">           result.Add(<span class="string">"历时"</span>, LastedTime);</span><br><span class="line">           result.Add(<span class="string">"特等座"</span>, TzNum);</span><br><span class="line">           result.Add(<span class="string">"一等座"</span>, YdNum);</span><br><span class="line">           result.Add(<span class="string">"二等座"</span>, EdNum);</span><br><span class="line">           result.Add(<span class="string">"高级软卧"</span>, GrwNum);</span><br><span class="line">           result.Add(<span class="string">"软卧"</span>, RwNum);</span><br><span class="line">           result.Add(<span class="string">"动卧"</span>, DwNum);</span><br><span class="line">           result.Add(<span class="string">"硬卧"</span>, YwNum);</span><br><span class="line">           result.Add(<span class="string">"软座"</span>, RzNum);</span><br><span class="line">           result.Add(<span class="string">"硬座"</span>, YzNum);</span><br><span class="line">           result.Add(<span class="string">"无座"</span>, WzNum);</span><br><span class="line">           result.Add(<span class="string">"其他"</span>, QtNum);</span><br><span class="line">           <span class="keyword">return</span> result;</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="解析JSON"><a href="#解析JSON" class="headerlink" title="解析JSON"></a>解析JSON</h3><p><img data-src="/images/trainticket3.jpg" alt="JSON格式的字符串"><br>返回的报文为一个JSON格式的字符串，里面包含有各类车票信息、发车时间以及历时，为了对其进行解析，我们需要下载一个用于解析JSON的类库(下载地址:<a href="https://archive.codeplex.com/?p=json" target="_blank" rel="noopener">Newtonsoft.Json.dll</a>)<br><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Ticket[] <span class="title">SpiderTicket</span>(<span class="params"><span class="keyword">string</span> date, <span class="keyword">string</span> <span class="keyword">from</span>, <span class="keyword">string</span> to, <span class="keyword">string</span> id</span>)</span></span><br><span class="line"><span class="function"></span> &#123;</span><br><span class="line">     HttpWebRequest request;</span><br><span class="line">     HttpWebResponse response;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">string</span> url = <span class="string">"https://kyfw.12306.cn/otn/leftTicket/query?leftTicketDTO.train_date=&#123;0&#125;&amp;leftTicketDTO.from_station=&#123;1&#125;&amp;leftTicketDTO.to_station=&#123;2&#125;&amp;purpose_codes=&#123;3&#125;"</span>;</span><br><span class="line">     url = <span class="keyword">string</span>.Format(url, date, <span class="keyword">from</span>, to, id);</span><br><span class="line"></span><br><span class="line">     request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class="line">     request.Method = <span class="string">"GET"</span>;</span><br><span class="line">     request.Credentials = CredentialCache.DefaultCredentials;</span><br><span class="line">     request.UserAgent = <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">string</span> str = <span class="keyword">string</span>.Empty;</span><br><span class="line">     <span class="keyword">try</span></span><br><span class="line">     &#123;</span><br><span class="line">         response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">         <span class="keyword">if</span> (response.StatusCode == HttpStatusCode.OK)</span><br><span class="line">         &#123;</span><br><span class="line">             StreamReader sr = <span class="keyword">new</span> StreamReader(response.GetResponseStream(), Encoding.GetEncoding(<span class="string">"UTF-8"</span>));</span><br><span class="line">             str = sr.ReadToEnd();</span><br><span class="line">             sr.Close();</span><br><span class="line">             response.Close();<span class="comment">//关闭response响应流</span></span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">catch</span> (Exception e)</span><br><span class="line">     &#123;</span><br><span class="line">         Console.WriteLine(e.Message);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; map=<span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;();<span class="comment">//保存返回的JSON串中的车站代码与车站名之间的映</span></span><br><span class="line">     ArrayList AllTicket = <span class="keyword">new</span> ArrayList();<span class="comment">//所有的车票信息</span></span><br><span class="line"></span><br><span class="line">     JObject jo = (JObject)JsonConvert.DeserializeObject(str);</span><br><span class="line">     JToken record = jo[<span class="string">"data"</span>][<span class="string">"map"</span>];</span><br><span class="line">     <span class="keyword">foreach</span> (JProperty item <span class="keyword">in</span> record)</span><br><span class="line">     &#123;</span><br><span class="line">         map.Add(item.Name.ToString(), item.Value.ToString());</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     record = jo[<span class="string">"data"</span>][<span class="string">"result"</span>];</span><br><span class="line">     <span class="keyword">foreach</span> (<span class="keyword">string</span> s <span class="keyword">in</span> record)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">string</span>[] result = s.Split(<span class="string">'|'</span>);</span><br><span class="line">         Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">         t.TrainId = result[<span class="number">3</span>];</span><br><span class="line">         t.FromStation = map[result[<span class="number">6</span>]];</span><br><span class="line">         t.ToStation = map[result[<span class="number">7</span>]];</span><br><span class="line">         t.StartTime = result[<span class="number">8</span>];</span><br><span class="line">         t.ArriveTime = result[<span class="number">9</span>];</span><br><span class="line">         t.LastedTime = result[<span class="number">10</span>];</span><br><span class="line">         t.TicketDate = result[<span class="number">13</span>];</span><br><span class="line">         t.DwNum = result[<span class="number">33</span>] != <span class="string">""</span> ? result[<span class="number">33</span>] : t.DwNum;</span><br><span class="line">         t.TzNum = result[<span class="number">32</span>] != <span class="string">""</span> ? result[<span class="number">32</span>] : t.TzNum;</span><br><span class="line">         t.YdNum = result[<span class="number">31</span>] != <span class="string">""</span> ? result[<span class="number">31</span>] : t.YdNum;</span><br><span class="line">         t.EdNum = result[<span class="number">30</span>] != <span class="string">""</span> ? result[<span class="number">30</span>] : t.EdNum;</span><br><span class="line">         t.YzNum = result[<span class="number">29</span>] != <span class="string">""</span> ? result[<span class="number">29</span>] : t.YzNum;</span><br><span class="line">         t.YwNum = result[<span class="number">28</span>] != <span class="string">""</span> ? result[<span class="number">28</span>] : t.YwNum;</span><br><span class="line">         t.WzNum = result[<span class="number">26</span>] != <span class="string">""</span> ? result[<span class="number">26</span>] : t.WzNum;</span><br><span class="line">         t.RzNum = result[<span class="number">24</span>] != <span class="string">""</span> ? result[<span class="number">24</span>] : t.RzNum;</span><br><span class="line">         t.RwNum = result[<span class="number">23</span>] != <span class="string">""</span> ? result[<span class="number">23</span>] : t.RwNum;</span><br><span class="line">         t.GrwNum = result[<span class="number">21</span>] != <span class="string">""</span> ? result[<span class="number">21</span>] : t.GrwNum;</span><br><span class="line">         AllTicket.Add(t);</span><br><span class="line">     &#125;</span><br><span class="line">     Ticket[] All = <span class="keyword">new</span> Ticket[AllTicket.Count];</span><br><span class="line">     <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">foreach</span> (<span class="keyword">object</span> t <span class="keyword">in</span> AllTicket)</span><br><span class="line">     &#123;</span><br><span class="line">         All[flag++] = t <span class="keyword">as</span> Ticket;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> All;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img data-src="/images/spiderticket.jpg" alt><br><img data-src="/images/spiderticket2.jpg" alt><br>项目地址:<a href="https://github.com/ZhaoQi99/EasyLife/tree/Course_Design/" target="_blank" rel="noopener">EasyLife</a></p>
<h2 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h2><p><a href="https://blog.csdn.net/xiahn1a/article/details/42584507" target="_blank" rel="noopener">C#调用12306API做余票查询</a>(该参考博客中的方法已不可用)</p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json.Linq;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br><span class="line"><span class="keyword">using</span> System.Xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Ticket</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StationNameXml</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">string</span> nowpath = Environment.CurrentDirectory;</span><br><span class="line">            <span class="keyword">if</span> (Directory.Exists(nowpath + <span class="string">"/Data"</span>) == <span class="literal">false</span>)</span><br><span class="line">                Directory.CreateDirectory(nowpath + <span class="string">"/Data"</span>);<span class="comment">//创建新路径</span></span><br><span class="line">            <span class="keyword">if</span> (File.Exists(nowpath + <span class="string">"/Data/StationName.xml"</span>) == <span class="literal">true</span>)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">            HttpWebRequest request;</span><br><span class="line">            HttpWebResponse response;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> url = <span class="string">@"https://kyfw.12306.cn/otn/resources/js/framework/station_name.js?station_version=1.9055"</span>;</span><br><span class="line"></span><br><span class="line">            request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class="line">            request.Method = <span class="string">"GET"</span>;</span><br><span class="line">            request.Credentials = CredentialCache.DefaultCredentials;</span><br><span class="line">            request.UserAgent = <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> str = <span class="keyword">string</span>.Empty;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">                <span class="keyword">if</span> (response.StatusCode == HttpStatusCode.OK)</span><br><span class="line">                &#123;</span><br><span class="line">                    StreamReader sr = <span class="keyword">new</span> StreamReader(response.GetResponseStream(), Encoding.GetEncoding(<span class="string">"UTF-8"</span>));</span><br><span class="line">                    str = sr.ReadToEnd();</span><br><span class="line">                    sr.Close();</span><br><span class="line">                    response.Close();<span class="comment">//关闭response响应流</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(e.Message);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> pattern = <span class="string">@"@\S&#123;2,5&#125;?[|](?&lt;Name&gt;\S&#123;1,8&#125;?)[|](?&lt;Code&gt;\S&#123;3,5&#125;?)[|]"</span>;</span><br><span class="line">            Regex r = <span class="keyword">new</span> Regex(pattern, RegexOptions.ExplicitCapture);</span><br><span class="line"></span><br><span class="line">            XmlDocument xmldoc = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">            XmlDeclaration xmldecl;</span><br><span class="line"></span><br><span class="line">            xmldecl = xmldoc.CreateXmlDeclaration(<span class="string">"1.0"</span>, <span class="string">"UTF-8"</span>, <span class="literal">null</span>);<span class="comment">//加入XML的声明段落</span></span><br><span class="line">            xmldoc.AppendChild(xmldecl);</span><br><span class="line"></span><br><span class="line">            XmlElement root = xmldoc.CreateElement(<span class="string">""</span>, <span class="string">"Dict"</span>, <span class="string">""</span>);<span class="comment">//加入一个根元素</span></span><br><span class="line">            xmldoc.AppendChild(root);</span><br><span class="line"></span><br><span class="line">            MatchCollection mc = r.Matches(str);</span><br><span class="line">            <span class="keyword">foreach</span> (Match m <span class="keyword">in</span> mc)</span><br><span class="line">            &#123;</span><br><span class="line">                GroupCollection <span class="keyword">group</span> = m.Groups;</span><br><span class="line">                XmlNode node = xmldoc.CreateNode(XmlNodeType.Element, <span class="string">"Pair"</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">                XmlNode temp = xmldoc.CreateNode(XmlNodeType.Element, <span class="string">"Station"</span>, <span class="literal">null</span>);</span><br><span class="line">                temp.InnerText = <span class="keyword">group</span>[<span class="string">"Name"</span>].Value;</span><br><span class="line">                node.AppendChild(temp);</span><br><span class="line"></span><br><span class="line">                XmlNode temp2 = xmldoc.CreateNode(XmlNodeType.Element, <span class="string">"Code"</span>, <span class="literal">null</span>);</span><br><span class="line">                temp2.InnerText = <span class="keyword">group</span>[<span class="string">"Code"</span>].Value;</span><br><span class="line">                node.AppendChild(temp2);</span><br><span class="line"></span><br><span class="line">                root.AppendChild(node);</span><br><span class="line">            &#125;</span><br><span class="line">            xmldoc.Save(nowpath + <span class="string">"/Data/"</span> + <span class="string">"StationName.xml"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">string</span> <span class="title">StationCode</span>(<span class="params"><span class="keyword">string</span> StationName</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            XmlDocument doc = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">            doc.Load(Environment.CurrentDirectory + <span class="string">"/Data/StationName.xml"</span>);</span><br><span class="line">            XmlNodeList data = doc.DocumentElement.ChildNodes;</span><br><span class="line">            <span class="keyword">foreach</span> (XmlNode node <span class="keyword">in</span> data)</span><br><span class="line">            &#123;</span><br><span class="line">                XmlElement xe = (XmlElement)node;</span><br><span class="line">                XmlNodeList xnl0 = xe.ChildNodes;</span><br><span class="line">                <span class="keyword">string</span> s = xnl0.Item(<span class="number">0</span>).InnerText;</span><br><span class="line">                <span class="keyword">if</span> (s == StationName)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> xnl0.Item(<span class="number">1</span>).InnerText;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">string</span>.Empty;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Ticket[] <span class="title">SpiderTicket</span>(<span class="params"><span class="keyword">string</span> date, <span class="keyword">string</span> <span class="keyword">from</span>, <span class="keyword">string</span> to, <span class="keyword">string</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            HttpWebRequest request;</span><br><span class="line">            HttpWebResponse response;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> url = <span class="string">"https://kyfw.12306.cn/otn/leftTicket/query?leftTicketDTO.train_date=&#123;0&#125;&amp;leftTicketDTO.from_station=&#123;1&#125;&amp;leftTicketDTO.to_station=&#123;2&#125;&amp;purpose_codes=&#123;3&#125;"</span>;</span><br><span class="line">            url = <span class="keyword">string</span>.Format(url, date, <span class="keyword">from</span>, to, id);</span><br><span class="line"></span><br><span class="line">            request = (HttpWebRequest)WebRequest.Create(url);</span><br><span class="line">            request.Method = <span class="string">"GET"</span>;</span><br><span class="line">            request.Credentials = CredentialCache.DefaultCredentials;</span><br><span class="line">            request.UserAgent = <span class="string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.186 Safari/537.36"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">string</span> str = <span class="keyword">string</span>.Empty;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                response = (HttpWebResponse)request.GetResponse();</span><br><span class="line">                <span class="keyword">if</span> (response.StatusCode == HttpStatusCode.OK)</span><br><span class="line">                &#123;</span><br><span class="line">                    StreamReader sr = <span class="keyword">new</span> StreamReader(response.GetResponseStream(), Encoding.GetEncoding(<span class="string">"UTF-8"</span>));</span><br><span class="line">                    str = sr.ReadToEnd();</span><br><span class="line">                    sr.Close();</span><br><span class="line">                    response.Close();<span class="comment">//关闭response响应流</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(e.Message);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; map=<span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;();<span class="comment">//保存返回的JSON串中的车站代码与车站名之间的映</span></span><br><span class="line">            ArrayList AllTicket = <span class="keyword">new</span> ArrayList();<span class="comment">//所有的车票信息</span></span><br><span class="line"></span><br><span class="line">            JObject jo = (JObject)JsonConvert.DeserializeObject(str);</span><br><span class="line">            JToken record = jo[<span class="string">"data"</span>][<span class="string">"map"</span>];</span><br><span class="line">            <span class="keyword">foreach</span> (JProperty item <span class="keyword">in</span> record)</span><br><span class="line">            &#123;</span><br><span class="line">                map.Add(item.Name.ToString(), item.Value.ToString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            record = jo[<span class="string">"data"</span>][<span class="string">"result"</span>];</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">string</span> s <span class="keyword">in</span> record)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">string</span>[] result = s.Split(<span class="string">'|'</span>);</span><br><span class="line">                Ticket t = <span class="keyword">new</span> Ticket();</span><br><span class="line">                t.TrainId = result[<span class="number">3</span>];</span><br><span class="line">                t.FromStation = map[result[<span class="number">6</span>]];</span><br><span class="line">                t.ToStation = map[result[<span class="number">7</span>]];</span><br><span class="line">                t.StartTime = result[<span class="number">8</span>];</span><br><span class="line">                t.ArriveTime = result[<span class="number">9</span>];</span><br><span class="line">                t.LastedTime = result[<span class="number">10</span>];</span><br><span class="line">                t.TicketDate = result[<span class="number">13</span>];</span><br><span class="line">                t.DwNum = result[<span class="number">33</span>] != <span class="string">""</span> ? result[<span class="number">33</span>] : t.DwNum;</span><br><span class="line">                t.TzNum = result[<span class="number">32</span>] != <span class="string">""</span> ? result[<span class="number">32</span>] : t.TzNum;</span><br><span class="line">                t.YdNum = result[<span class="number">31</span>] != <span class="string">""</span> ? result[<span class="number">31</span>] : t.YdNum;</span><br><span class="line">                t.EdNum = result[<span class="number">30</span>] != <span class="string">""</span> ? result[<span class="number">30</span>] : t.EdNum;</span><br><span class="line">                t.YzNum = result[<span class="number">29</span>] != <span class="string">""</span> ? result[<span class="number">29</span>] : t.YzNum;</span><br><span class="line">                t.YwNum = result[<span class="number">28</span>] != <span class="string">""</span> ? result[<span class="number">28</span>] : t.YwNum;</span><br><span class="line">                t.WzNum = result[<span class="number">26</span>] != <span class="string">""</span> ? result[<span class="number">26</span>] : t.WzNum;</span><br><span class="line">                t.RzNum = result[<span class="number">24</span>] != <span class="string">""</span> ? result[<span class="number">24</span>] : t.RzNum;</span><br><span class="line">                t.RwNum = result[<span class="number">23</span>] != <span class="string">""</span> ? result[<span class="number">23</span>] : t.RwNum;</span><br><span class="line">                t.GrwNum = result[<span class="number">21</span>] != <span class="string">""</span> ? result[<span class="number">21</span>] : t.GrwNum;</span><br><span class="line">                AllTicket.Add(t);</span><br><span class="line">            &#125;</span><br><span class="line">            Ticket[] All = <span class="keyword">new</span> Ticket[AllTicket.Count];</span><br><span class="line">            <span class="keyword">int</span> flag = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">object</span> t <span class="keyword">in</span> AllTicket)</span><br><span class="line">            &#123;</span><br><span class="line">                All[flag++] = t <span class="keyword">as</span> Ticket;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> All;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            StationNameXml();</span><br><span class="line">            <span class="keyword">string</span> <span class="keyword">from</span> = <span class="string">"上海"</span>;</span><br><span class="line">            <span class="keyword">string</span> to = <span class="string">"北京"</span>;</span><br><span class="line">            Ticket[] All=<span class="keyword">new</span> Ticket[<span class="number">50</span>];</span><br><span class="line">            All=SpiderTicket(DateTime.Now.ToString(<span class="string">"yyyy-MM-dd"</span>), StationCode(<span class="keyword">from</span>), StationCode(to), <span class="string">"ADULT"</span>);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;All.Length;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt; map = <span class="keyword">new</span> Dictionary&lt;<span class="keyword">string</span>, <span class="keyword">string</span>&gt;();</span><br><span class="line">                map = All[i].getMap();</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">object</span> j <span class="keyword">in</span> map.Keys)</span><br><span class="line">                    Console.Write(j.ToString()+<span class="string">":"</span>+map[j.ToString()].ToString()+<span class="string">" "</span>);</span><br><span class="line">                Console.WriteLine();</span><br><span class="line">            &#125;</span><br><span class="line">            Console.Read();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
        <tag>.NET</tag>
      </tags>
  </entry>
  <entry>
    <title>C#中使用SmtpClient发送邮件</title>
    <url>/3123403799.html</url>
    <content><![CDATA[<p>最近写C#课程设计时需要用C#来发送邮件，但是网上搜的代码经过测试均不能使用，调试了很久也没能成功。最后索性自己对着官方文档撸了一个，期间踩了很多坑，故在此做一总结。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul>
<li>命名空间导入:<code>using System.Net.Mail;</code></li>
<li>在邮箱设置中开通smtp服务，并获取授权码。<a id="more"></a>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">string</span> mailfrom, password, fromwho, host, mailto, subject, body;</span><br><span class="line">mailfrom = <span class="string">"xxx@qq.com"</span>;<span class="comment">//发件人</span></span><br><span class="line"><span class="keyword">int</span> port = <span class="number">25</span>;<span class="comment">//端口号一般为25</span></span><br><span class="line">password = <span class="string">"**********"</span>;<span class="comment">//邮箱密码</span></span><br><span class="line">host = <span class="string">"smtp.xxx.com"</span>;<span class="comment">//主机地址</span></span><br><span class="line">fromwho = <span class="string">"xxx"</span>;<span class="comment">//发件人的签名</span></span><br><span class="line">mailto = <span class="string">"xxx@qq.com"</span>;<span class="comment">//收件人(多个收件人之间以英文逗号间隔)</span></span><br><span class="line">subject = <span class="string">"test"</span>;<span class="comment">//邮件主题</span></span><br><span class="line">body = <span class="string">"xxxxx"</span>;<span class="comment">//邮件正文</span></span><br><span class="line"></span><br><span class="line">SmtpClient smtp;</span><br><span class="line">smtp = <span class="keyword">new</span> SmtpClient(host, port);</span><br><span class="line">smtp.UseDefaultCredentials = <span class="literal">false</span>;</span><br><span class="line">smtp.EnableSsl = <span class="literal">true</span>;<span class="comment">//是否使用SSL加密连接</span></span><br><span class="line">smtp.DeliveryMethod = SmtpDeliveryMethod.Network;<span class="comment">//指定邮件发送方式</span></span><br><span class="line">smtp.Credentials = <span class="keyword">new</span> System.Net.NetworkCredential(mailfrom, password); <span class="comment">//设置用于验证发件人身份的凭证</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">string</span>[] address = mailto.Split(<span class="string">','</span>);<span class="comment">//收件人地址列表</span></span><br><span class="line">MailMessage msg = <span class="keyword">new</span> MailMessage();<span class="comment">//邮件信息</span></span><br><span class="line">msg.From = <span class="keyword">new</span> MailAddress(mailfrom, fromwho, Encoding.UTF8);</span><br><span class="line">msg.Subject = subject;<span class="comment">//邮件标题</span></span><br><span class="line">msg.SubjectEncoding = Encoding.UTF8;</span><br><span class="line">msg.Body = body;<span class="comment">//邮件正文</span></span><br><span class="line">msg.BodyEncoding = Encoding.UTF8;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; address.Length; i++)</span><br><span class="line">    msg.To.Add(address[i]);</span><br><span class="line"></span><br><span class="line">msg.Priority = MailPriority.Normal;<span class="comment">//邮件优先级(High,Low,Normal)</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    smtp.Send(msg);</span><br><span class="line">	Console.WriteLine(<span class="string">"发送成功!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception e)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(e.Message);</span><br><span class="line">&#125;</span><br><span class="line">msg.Dispose();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ul>
<li>代码中所使用的密码不是邮箱密码，应在邮箱设置中获取smtp服务授权码。</li>
<li>使用163邮箱时只能使用25端口(465/994不可用),EnableSsl属性设置为false/true</li>
<li>使用QQ邮箱发送时只能使用25端口(465/587不可用),且EnableSsl属性必须设置为true</li>
<li>代码使用QQ邮箱、163邮箱实测有效，其他邮箱尚不清楚</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>无论是QQ邮箱还是163邮箱，使用SSL端口发送时均出现异常：操作超时，查了好久，发现是因为:System.Net.Mail只支持显式SSL(Explicit SSL)，但是不支持隐式SSL(Implicit SSL)，QQ邮箱使用的应该是Implicit SSL。此问题似乎可以用<code>System.Web.Mail</code>或<code>Cdosys.dll</code>解决，但是还没有试过。<br>关于QQ邮箱使用25端口发送时，必须使用设置SSL为true的原因:服务器从不受保护的25端口响应请求，然后将连接抛到受保护的465端口.<br><strong>显式SSL</strong>通过25端口连接 - &gt; StartTLS（开始加密）- &gt;验证 - &gt;发送数据<br><strong>隐式SSL</strong>StartSSL（开始加密） - &gt; 连接 - &gt; 验证 - &gt;发送数据</p>
<h2 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h2><p><a href="https://blog.csdn.net/andrewniu/article/details/52594318" target="_blank" rel="noopener">C#发送邮件三种方法，Localhost，SMTP，SSL-SMTP</a><br><a href="https://blogs.msdn.microsoft.com/webdav_101/2008/06/02/system-net-mail-with-ssl-to-authenticate-against-port-465/" target="_blank" rel="noopener">System.Net.Mail with SSL to authenticate against port 465</a><br><a href="https://support.microsoft.com/en-us/help/950260/you-cannot-use-system-net-mail-smtpclient-to-send-an-e-mail-message-wi" target="_blank" rel="noopener">You cannot use System.Net.Mail.SmtpClient to send an e-mail message with Implicit SSL</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>C#</tag>
        <tag>.NET</tag>
      </tags>
  </entry>
  <entry>
    <title>银行家算法(使用DFS找出所有安全序列)</title>
    <url>/647653334.html</url>
    <content><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><h3 id="银行家算法"><a href="#银行家算法" class="headerlink" title="银行家算法"></a>银行家算法</h3><p>银行家算法是一种最有代表性的避免死锁的算法。在避免死锁方法中允许进程动态地申请资源，但系统在进行资源分配之前，应先计算此次分配资源的安全性，若分配不会导致系统进入不安全状态，则分配，否则等待。为实现银行家算法，系统必须设置若干数据结构。<br><a id="more"></a></p>
<h3 id="安全状态"><a href="#安全状态" class="headerlink" title="安全状态"></a>安全状态</h3><ul>
<li>系统能按某种进程推进顺序{P<sub>1</sub>，…，P<sub>n</sub>}为每个进程P<sub>i</sub>分配其所需资源，直至满足每个进程对资源的最大需求，使每个进程都可顺利地完成。</li>
<li>此时称{P<sub>1</sub>，…，P<sub>n</sub>}为安全序列。如果系统无法找到这样一个安全序列，则称系统处于不安全状态。</li>
<li>并非所有不安全状态都必然会转为死锁状态，但当系统进入不安全状态后，就有可能进入死锁状态。反之，只要系统处于安全状态，系统便不会进入死锁状态。</li>
<li>因此，避免死锁的实质在于，系统在进行资源分配时，应用系统不进入不安全状态。<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2></li>
</ul>
<ol>
<li>可利用资源向量Available<br>是个含有m个元素的数组，其中的每一个元素代表一类可利用的资源数目。如果Available[j]=K，则表示系统中现有Rj类资源K个。</li>
<li>最大需求矩阵Max<br>这是一个n×m的矩阵，它定义了系统中n个进程中的每一个进程对m类资源的最大需求。如果Max[i,j]=K，则表示进程i需要R<sub>j</sub>类资源的最大数目为K。</li>
<li>分配矩阵Allocation<br>这也是一个n×m的矩阵，它定义了系统中每一类资源当前已分配给每一进程的资源数。如果Allocation[i,j]=K，则表示进程i当前已分得R<sub>j</sub>类资源的数目为K。</li>
<li>需求矩阵Need。<br>这也是一个n×m的矩阵，用以表示每一个进程尚需的各类资源数。如果Need[i,j]=K，则表示进程i还需要R<sub>j</sub>类资源K个，方能完成其任务。<br>Need[i,j]=Max[i,j]-Allocation[i,j]</li>
</ol>
<h2 id="银行家算法-1"><a href="#银行家算法-1" class="headerlink" title="银行家算法"></a>银行家算法</h2><p>设Request<sub>i</sub>是进程P<sub>i</sub>的请求向量，如果Request<sub>i</sub>[j]=K,表示进程P<sub>i</sub>需要K个R<sub>j</sub>类型。当P<sub>i</sub>发出资源请求后，系统按下输步骤进行检查:</p>
<ol>
<li>如果Request<sub>i</sub>[j] &lt;= Need[i][j],便转向步骤2；否则认为出错，因为它所需要的资源数已超过它所宣布的最大值</li>
<li>如果Request<sub>i</sub>[j] &lt;= Available[i][j]，便转向步骤3；否则表示尚无足够资源，P<sub>i</sub>需等待  </li>
<li>系统试探着把资源分配给进程P<sub>i</sub>,并修改下面数据结构中的数值:<ul>
<li>Available[j] -= Request<sub>i</sub>[j]</li>
<li>Allocation[i][j] += Request<sub>i</sub>[j]</li>
<li>Need[i][j] -= Request<sub>i</sub>[j]</li>
</ul>
</li>
<li>系统执行安全性算法，检查此次资源分配后系统是否处于安全状态.若安全，正式将资源分配给进程P<sub>i</sub>，以完成本次分配；否则，讲将本次的试探分配作废,恢复原来的资源分配状态，让进程P<sub>i</sub>等待</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_bank</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span> <span class="comment">//按照银行家算法检查资源请求</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Request[j] &gt; Need[i][j] || Request[j] &gt; Available[j])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    update(i, Request);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="尝试分配资源-恢复原来的资源分配状态"><a href="#尝试分配资源-恢复原来的资源分配状态" class="headerlink" title="尝试分配资源/恢复原来的资源分配状态"></a>尝试分配资源/恢复原来的资源分配状态</h2><h3 id="尝试分配资源"><a href="#尝试分配资源" class="headerlink" title="尝试分配资源"></a>尝试分配资源</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span> <span class="comment">//更新数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        Available[j] -= Request[j];</span><br><span class="line">        Allocation[i][j] += Request[j];</span><br><span class="line">        Need[i][j] -= Request[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="恢复原来的资源分配状态"><a href="#恢复原来的资源分配状态" class="headerlink" title="恢复原来的资源分配状态"></a>恢复原来的资源分配状态</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recovery</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span><span class="comment">//还原数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        Available[j] += Request[j];</span><br><span class="line">        Allocation[i][j] -= Request[j];</span><br><span class="line">        Need[i][j] += Request[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="安全性算法"><a href="#安全性算法" class="headerlink" title="安全性算法"></a>安全性算法</h2><ol>
<li>设置两个工作向量:<br>① 工作向量WORK，它表示系统可提供给进程继续运行所需的各类资源数目，它含有m个元素，在执行安全算法开始时，WORK:=Available<br>② Finish:它表示系统是否有足够的资源分配给进程，使之运行完成。初始Finish[i]: = false；当有足够资源分配给进程时，再令Finish[i]：=true。 </li>
<li>从进程集合中找出一个满足下列条件的进程：<br>① Finish[i] = false<br>② Need[i][j] &lt;= work[j]<br>若找到，执行3,否则，执行步骤4</li>
<li>当进程p<sub>i</sub>获得资源后，可顺利执行，直至完成，并释放出分配给它的资源，故应执行:</li>
</ol>
<ul>
<li>Finish[i] = true </li>
<li>WORK[j] += Allocation[i][j]</li>
<li>go to step 2</li>
</ul>
<ol start="4">
<li>如果所有进程的Finish[i] = true，则表示系统处于安全性状态，否则，系统处于不安全状态。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_safe</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span> <span class="comment">//检查系统安全性</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> Work[MaxNumber];</span><br><span class="line">    <span class="keyword">bool</span> Finished[MaxNumber];</span><br><span class="line">    <span class="built_in">memset</span>(Finished, <span class="literal">false</span>, <span class="keyword">sizeof</span>(Finished));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        Work[i] = Available[i];</span><br><span class="line">    sta = UnSafe;</span><br><span class="line">    Dfs(<span class="number">0</span>, Work, Finished);</span><br><span class="line">    <span class="keyword">if</span>(sta==UnSafe)</span><br><span class="line">        recovery(i, Request);<span class="comment">//还原数据</span></span><br><span class="line">    <span class="keyword">return</span> sta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>复杂度分析:安全性检查算法，有两种for循环，最内层for循环每次继续向下一层搜索，故时间复杂度为O((n * m)^ n)</p>
<h2 id="利用Dfs找出所有安全序列"><a href="#利用Dfs找出所有安全序列" class="headerlink" title="利用Dfs找出所有安全序列"></a>利用Dfs找出所有安全序列</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Work[], <span class="keyword">bool</span> Finished[])</span><span class="comment">//深度优先搜索,找到所有的安全序列</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i == n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Finished[j] == <span class="literal">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sta = Safe;</span><br><span class="line">        SafeOrder.push_back(temp);</span><br><span class="line">        <span class="comment">//temp.clear();</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Finished[j] == <span class="literal">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">bool</span> t = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Need[j][k] &gt; Work[k])</span><br><span class="line">                &#123;</span><br><span class="line">                    t = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(t == <span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m; k++)</span><br><span class="line">                    Work[k] += Allocation[j][k];</span><br><span class="line">                Finished[j] = <span class="literal">true</span>;</span><br><span class="line">                temp.push_back(j);</span><br><span class="line">                Dfs(i + <span class="number">1</span>, Work, Finished);</span><br><span class="line">                temp.pop_back();       <span class="comment">//回溯,将第i个进程所做的改变恢复</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m; k++)</span><br><span class="line">                &#123;</span><br><span class="line">                    Work[k] -= Allocation[j][k];</span><br><span class="line">                &#125;</span><br><span class="line">                Finished[j] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试数据"><a href="#测试数据" class="headerlink" title="测试数据"></a>测试数据</h2><div class="note default no-icon"><p>3<br>A 3<br>B 3<br>C 2<br>5<br>7 5 3<br>3 2 2<br>9 0 2<br>2 2 2<br>4 3 3<br>0 1 0<br>2 0 0<br>3 0 2<br>2 1 1<br>0 0 2<br>2<br>1<br>1<br>0<br>2<br></p></div>

<h2 id="实验截图"><a href="#实验截图" class="headerlink" title="实验截图"></a>实验截图</h2><p><img data-src="/images/Banker&#39;s Algorithm1.jpg" alt="合理且安全的资源请求"></p>
<center>合理且安全的资源请求</center><br><img data-src="/images/Banker&#39;s Algorithm2.jpg" alt="不合理的资源请求"><br><center>不合理的资源请求</center><br><img data-src="/images/Banker&#39;s Algorithm3.jpg" alt="会导致系统处于不安全状态的资源请求"><br><center>会导致系统处于不安全状态的资源请求</center>

<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Problem:银行家算法</span></span><br><span class="line"><span class="comment">Author:QiZhao</span></span><br><span class="line"><span class="comment">Data:2018-05-31</span></span><br><span class="line"><span class="comment">Description:预防进程死锁的银行家算法</span></span><br><span class="line"><span class="comment">Copyright  2018 QiZhao. All rights reserved.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;vector&gt;//提供vector</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;//提供memset函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;//提供fflush函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;//提供exit函数</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">enum</span> status &#123;Safe, UnSafe&#125;;<span class="comment">//安全性检查的结果</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> MaxNumber = <span class="number">100</span>;<span class="comment">//进程数量的最大值</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Available[MaxNumber];<span class="comment">//每种资源的可用数量</span></span><br><span class="line"><span class="keyword">int</span> Max[MaxNumber][MaxNumber];<span class="comment">//n*m的矩阵,表示每个进程所需的最大资源量</span></span><br><span class="line"><span class="built_in">string</span> name[MaxNumber];<span class="comment">//n个进程的进程名</span></span><br><span class="line"><span class="keyword">int</span> Allocation[MaxNumber][MaxNumber];<span class="comment">//n*m的矩阵,表示每个进程每种资源已经分配的量</span></span><br><span class="line"><span class="keyword">int</span> Need[MaxNumber][MaxNumber];<span class="comment">//n*m的矩阵,表示每个进程还需的每种资源量</span></span><br><span class="line"><span class="keyword">int</span> Request[MaxNumber];<span class="comment">//所请求的每种资源的资源量</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; SafeOrder;<span class="comment">//存储所有的安全序列</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; temp;<span class="comment">//存储一个临时安全序列</span></span><br><span class="line"><span class="keyword">int</span> n, m;<span class="comment">//进程数，资源种类数</span></span><br><span class="line"></span><br><span class="line">status sta = UnSafe;<span class="comment">//安全性检查的结果</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recovery</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_bank</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_safe</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">choose</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> Wordk[],<span class="keyword">bool</span> Finished[])</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">menu</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数实现</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span><span class="comment">//读入数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入系统资源的种类数:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请依次输入"</span> &lt;&lt; m &lt;&lt; <span class="string">"种系统资源的名称与数量:"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; name[i] &gt;&gt; Available[i];</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入进程的数量:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入各个进程的最大需求量&lt;"</span> &lt;&lt; n &lt;&lt; <span class="string">"*"</span> &lt;&lt; m &lt;&lt; <span class="string">"矩阵&gt;[MAX]"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; Max[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入各进程已申请的资量&lt;"</span> &lt;&lt; n &lt;&lt; <span class="string">"*"</span> &lt;&lt; m &lt;&lt; <span class="string">"矩阵&gt;[Allocation]"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; Allocation[i][j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span><span class="comment">//计算Need</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            Need[i][j] = Max[i][j] - Allocation[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">show</span><span class="params">()</span><span class="comment">//显示资源使用情况</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">" Max\tAllocation\tNeed\tAvaliable"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(j==<span class="number">3</span>)</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; name[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">            <span class="keyword">if</span>(j == <span class="number">1</span>)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"  "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; Max[i][j] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t"</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; Allocation[i][j] &lt;&lt; <span class="string">"   "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t"</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; Need[i][j] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t "</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; Available[j] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span> <span class="comment">//更新数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        Available[j] -= Request[j];</span><br><span class="line">        Allocation[i][j] += Request[j];</span><br><span class="line">        Need[i][j] -= Request[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">recovery</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span><span class="comment">//还原数据</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        Available[j] += Request[j];</span><br><span class="line">        Allocation[i][j] -= Request[j];</span><br><span class="line">        Need[i][j] += Request[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check_bank</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span> <span class="comment">//按照银行家算法检查资源请求</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Request[j] &gt; Need[i][j] || Request[j] &gt; Available[j])</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    update(i, Request);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Work[], <span class="keyword">bool</span> Finished[])</span><span class="comment">//深度优先搜索,找到所有的安全序列</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(i == n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(Finished[j] == <span class="literal">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> ;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sta = Safe;</span><br><span class="line">        SafeOrder.push_back(temp);</span><br><span class="line">        <span class="comment">//temp.clear();</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(Finished[j] == <span class="literal">false</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">bool</span> t = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Need[j][k] &gt; Work[k])</span><br><span class="line">                &#123;</span><br><span class="line">                    t = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(t == <span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m; k++)</span><br><span class="line">                    Work[k] += Allocation[j][k];</span><br><span class="line">                Finished[j] = <span class="literal">true</span>;</span><br><span class="line">                temp.push_back(j);</span><br><span class="line">                Dfs(i + <span class="number">1</span>, Work, Finished);</span><br><span class="line">                temp.pop_back();       <span class="comment">//回溯,将第i个进程所做的改变恢复</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; m; k++)</span><br><span class="line">                &#123;</span><br><span class="line">                    Work[k] -= Allocation[j][k];</span><br><span class="line">                &#125;</span><br><span class="line">                Finished[j] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_safe</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> Request[])</span> <span class="comment">//检查系统安全性</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> Work[MaxNumber];</span><br><span class="line">    <span class="keyword">bool</span> Finished[MaxNumber];</span><br><span class="line">    <span class="built_in">memset</span>(Finished, <span class="literal">false</span>, <span class="keyword">sizeof</span>(Finished));</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        Work[i] = Available[i];</span><br><span class="line">    sta = UnSafe;</span><br><span class="line">    Dfs(<span class="number">0</span>, Work, Finished);</span><br><span class="line">    <span class="keyword">if</span>(sta==UnSafe)</span><br><span class="line">        recovery(i, Request);<span class="comment">//还原数据</span></span><br><span class="line">    <span class="keyword">return</span> sta;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">request</span><span class="params">()</span><span class="comment">//某个进程申请资源</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="built_in">memset</span>(Request, <span class="number">0</span>, <span class="keyword">sizeof</span>(Request));</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入要请求分配资源的进程号&lt;0~"</span> &lt;&lt; n &lt;&lt; <span class="string">"&gt;:"</span>;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; i;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"请输入进程"</span> &lt;&lt; i &lt;&lt; <span class="string">"申请的资源数目"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; m; j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; name[j] &lt;&lt; <span class="string">":"</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; Request[j];</span><br><span class="line">    &#125;</span><br><span class="line">    SafeOrder.<span class="built_in">clear</span>();</span><br><span class="line">    <span class="keyword">if</span>(check_bank(i, Request) == <span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(check_safe(i, Request) == Safe)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"系统是安全的!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"安全序列有:"</span>&lt;&lt;SafeOrder.<span class="built_in">size</span>()&lt;&lt;<span class="string">"种"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; SafeOrder.<span class="built_in">size</span>(); j++)<span class="comment">//输出所有的安全序列</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; SafeOrder[j].<span class="built_in">size</span>(); k++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">cout</span> &lt;&lt; <span class="string">"P"</span> &lt;&lt; SafeOrder[j][k];</span><br><span class="line">                    <span class="keyword">if</span>(k != SafeOrder[j].<span class="built_in">size</span>() - <span class="number">1</span>)</span><br><span class="line">                        <span class="built_in">cout</span> &lt;&lt; <span class="string">"-&gt;"</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(SafeOrder[j].<span class="built_in">size</span>()!=<span class="number">0</span>)</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"系统不安全,恢复原来状态!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"资源请求不合理!"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">choose</span><span class="params">()</span><span class="comment">//选择菜单</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> i = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        fflush(<span class="built_in">stdin</span>);</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">"请选择你要进行的操作"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; i;</span><br><span class="line">        <span class="keyword">switch</span>(i)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'0'</span>:</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'2'</span>:</span><br><span class="line">            request();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'1'</span>:</span><br><span class="line">            show();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"输入有误,请重新输入"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        menu();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">menu</span><span class="params">()</span><span class="comment">//显示菜单</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"****************银行家算法演示***************"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t\t1:显示各个矩阵的内容"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t\t2:进程请求系统分配资源"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"\t\t0:退出程序"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"*********************************************"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//freopen("in.txt", "r", stdin);</span></span><br><span class="line">    <span class="comment">//freopen("out.txt", "w", stdout);</span></span><br><span class="line">    input();</span><br><span class="line">    init();</span><br><span class="line">    menu();</span><br><span class="line">    choose();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://blog.csdn.net/qq_27008079/article/details/53946253" target="_blank" rel="noopener">银行家算法实现——找出所有安全序列</a><br><a href="https://baike.baidu.com/item/%E9%93%B6%E8%A1%8C%E5%AE%B6%E7%AE%97%E6%B3%95/1679781?fr=aladdin" target="_blank" rel="noopener">百度百科_银行家算法</a><br><a href="https://baike.baidu.com/item/计算机操作系统（第四版）/19925494" target="_blank" rel="noopener">《计算机操作系统（第四版）》</a>，汤小丹，西安电子科技大学出版社，2014.5</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>操作系统</category>
      </categories>
      <tags>
        <tag>DFS</tag>
        <tag>操作系统</tag>
      </tags>
  </entry>
  <entry>
    <title>用Python实现校园通知更新提醒</title>
    <url>/45013.html</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这个项目实已经在一个月前已经完成了，一直都想写一篇博客来总结这个过程中遇到的一些问题。但最近一个月来都比较忙，所以一直拖到了现在。<br>首先说说起因吧，我没事的时候，总喜欢依次点开学校主页、教务处、图书馆以及学院的网站，看看有没有什么新通知，虽然大多与我无关。恰逢最近正在学Python，经常听到别人说用Python写爬虫很简单，但自己尚未接触过爬虫。于是抱着试一试的心态看了几篇关于Python爬虫的博客，发现实现起来的确很简单。于是，便一边看着官方的文档说明，一边看着别人的博客，终于完成了自己的第一次爬虫。<br><a id="more"></a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>使用<code>urllib.request</code>库获取到目标url(各个网站的’更多通知’页)的源代码，然后利用Python的<code>re</code>库进行正则匹配，提取到通知相关信息后，与文件中存取的上一次爬取到的信息进行对比。<br>若检测到有新的通知，则利用<code>twilio</code>库向指定手机号码发送SMS，利用<code>smtplib</code>库向指定邮箱发送提醒信息。<br>此外，还具有发送日志以及异常日志的功能。<br>目前仅支持本校的通知提醒，后续会逐步提高项目的通用性。</p>
<h2 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h2><p>Github地址:<a href="https://github.com/ZhaoQi99/School_Notice" target="_blank" rel="noopener">School_Notice</a></p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><ul>
<li>安装twilio库:<code>pip install twilio</code></li>
<li>注册twilio账号:<a href="https://www.twilio.com" target="_blank" rel="noopener">Twilio</a></li>
<li>验证手机号:用来接收短信提醒的号码必须在twilio上进行验证</li>
</ul>
<h2 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h2><h3 id="邮件发送"><a href="#邮件发送" class="headerlink" title="邮件发送"></a>邮件发送</h3><ul>
<li>若用名为msg的变量来保存邮件文本，则<code>msg[&#39;From&#39;]</code>以及<code>msg[&#39;To&#39;]</code>必须为实际的发件人地址，否则可能会出现异常:<code>SMTPDataError(code, resp)</code>.如必须写作:<code>msg[&#39;From&#39;] = &#39;xxxxx@qq.com&#39;</code>.我是使用的QQ邮箱来发邮件，至于其他邮箱需不需要这样写还不清楚。 </li>
<li>原本想用一个for循环来实现多人发送，后来发现smtplib库的sendmail方法支持多人发送，但参数应为一个list，故可用<code>str.split(&#39;,&#39;)</code>将字符串转为list。</li>
<li>我使用的是Windows下的Python，若计算机名为中文，则有可能会导致出现异常，可通过右击此电脑-&gt;属性，修改计算机名。</li>
<li>程序代码中使用的邮箱密码不是QQ密码，应在邮箱设置-&gt;账户-&gt;SMTP服务处，获取授权码。</li>
</ul>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><ul>
<li>有时候会接收不到Twilio发送的短信，给10086打电话也没问出个所以然，可能是因为短信中有敏感词(如:学校名)，修改短信内容后就可以了</li>
<li><p>对上述几个网站的源码使用<code>re.findall</code>后返回的列表中的每个元组中的元素的顺序均为时间、标题、链接，但对学生处网站的源码正则匹配后的元素顺序并不是按照上述顺序的。所以应单独进行调整，但直接修改一个元组中的元素，会出现异常:<code>error:tuple&#39; object does not support item assignment</code>。解决方法是:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(subject_EN == <span class="string">'snnu_xsc'</span>):</span><br><span class="line">	new_data = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> data:</span><br><span class="line">		temp = (item[<span class="number">1</span>], item[<span class="number">2</span>], item[<span class="number">0</span>])</span><br><span class="line">        new_data.append(temp)</span><br><span class="line">    data = new_data</span><br></pre></td></tr></table></figure>
</li>
<li><p>Python3中的print函数是自动换行的，若不需要自动换行，则可写作:<code>print(str,end=&#39;&#39;)</code></p>
</li>
<li>不同网站的编码格式可能不同，应按照各自的编码方式进行解码。若均采用<code>utf-8</code>的方式，则可能会出现各种编码问题，如:<br><div class="note danger"><p>UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0xc9 in position 167<br></p></div><br>解决方法是:<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> find1 == <span class="number">-1</span> &amp; find2 == <span class="number">-1</span>:</span><br><span class="line">	Coding = <span class="string">'utf-8'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="comment"># 教务处网页源码编码格式为为gbk</span></span><br><span class="line">	<span class="comment"># 学生处网页源码编码格式为gb2312</span></span><br><span class="line">	Coding = <span class="string">'gbk'</span></span><br><span class="line">data = response.read().decode(Coding)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Python程序打包为exe-Pyinstaller"><a href="#Python程序打包为exe-Pyinstaller" class="headerlink" title="Python程序打包为exe(Pyinstaller)"></a>Python程序打包为exe(Pyinstaller)</h2><h3 id="安装及使用"><a href="#安装及使用" class="headerlink" title="安装及使用"></a>安装及使用</h3><ol>
<li>使用<code>pip install pywin32</code>安装pywin32</li>
<li>使用<code>pip install PyInstaller</code>安装Pyinstaller</li>
<li>使用<code>pyinstaller -F main.py</code>即可将Python程序打包为exe程序</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>打包之前应将用到的第三方库(此项目仅用到Twilio)复制到与要打包的py文件同一目录下。</li>
<li>可使用<code>pyinstaller -F -i logo.ico main.py</code>,为生成的exe程序添加图标</li>
<li>使用的ico文件像素不能过小，否则有可能出现:打包后的程序图标只有在资源管理器中设置为以小图标查看的情况下才显示的是自己的图标，其他情况仍未默认图标</li>
</ul>
<h2 id="使用截图"><a href="#使用截图" class="headerlink" title="使用截图"></a>使用截图</h2><p><img data-src="/images/Screenshot_2018-03-13-09-32-23-47.jpg" alt><br><img data-src="/images/send_email.jpg" alt><br><img data-src="/images/20180426015859.jpg" alt></p>
<h2 id="参考博客"><a href="#参考博客" class="headerlink" title="参考博客"></a>参考博客</h2><ol>
<li><a href="https://blog.csdn.net/hanyou11/article/details/50756800" target="_blank" rel="noopener">应用python对校园通知的更新进行推送</a></li>
<li><a href="https://blog.csdn.net/zyc121561/article/details/78169168" target="_blank" rel="noopener">使用python发短信给自己的手机</a></li>
<li><a href="https://www.cnblogs.com/gopythoner/p/6337543.html" target="_blank" rel="noopener">Python打包方法——Pyinstaller</a></li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
        <tag>爬虫</tag>
        <tag>Twilio</tag>
        <tag>正则表达式</tag>
      </tags>
  </entry>
  <entry>
    <title>Github pages个人域名添加SSL</title>
    <url>/18543.html</url>
    <content><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>寒假的时候用Hexo+Github pages搭建了属于自己的博客，前不久才绑定了个人域名。作为一名有强迫症的程序猿，肯定还要给自己加一个绿色的小锁头。<br>在网上看别人的博客，大部分是用的<a href="https://www.cloudflare.com/" target="_blank" rel="noopener">CloudFlare</a>提供的免费https服务，也有采用的阿里云提供的一年免费证书，我选择的是后者。<br><a id="more"></a></p>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul>
<li>个人域名:<a href="https://zhaoqi99.github.io/" target="_blank" rel="noopener">https://赵旗.top/</a></li>
<li>Github pages</li>
<li>阿里云购买的SSL证书<h2 id="添加SSL证书"><a href="#添加SSL证书" class="headerlink" title="添加SSL证书"></a>添加SSL证书</h2></li>
</ul>
<ol>
<li>进入阿里云控制台，依次点击安全(云盾)-&gt;CA证书服务，然后点击右上角的购买证书。<br><img data-src="/images/20180410134416.jpg" alt></li>
<li>依次选择品牌为<code>Symantec</code>，保护类型为<code>一个域名</code>，证书类型此时会多出一个选项<code>免费型DV SSL</code>点击选择,然后点击立即购买，支付0.00元。<br><img data-src="/images/20180410134752.jpg" alt><br><img data-src="/images/20180410113516.jpg" alt><div class="note danger no-icon"><p>注意:免费的SSL证书有效期只有一年，过期之后就需要重新申请了。<br></p></div></li>
<li>支付成功后，点击进入证书控制台，然后点击<code>补全</code>，填写相关信息，提交申请。<br><img data-src="/images/20180410140626.jpg" alt><br><img data-src="/images/20180410113758.jpg" alt><div class="note warning"><p><br>域名验证类型选项记得勾选:证书绑定的域名在【阿里云的云解析】产品中，授权系统自动添加一条记录以完成域名授权验证。<br></p></div></li>
<li>等待20分钟左右，即可收到签发成功的通知了，也可以在证书控制台中实时看到审核进度。</li>
<li>在浏览器中输入https://域名/ ，可以看到地址栏前面有一个小绿锁，很惊喜有没有~<br><img data-src="/images/20180410140910.jpg" alt></li>
</ol>
<h2 id="http强制跳转https"><a href="#http强制跳转https" class="headerlink" title="http强制跳转https"></a>http强制跳转https</h2><p>按照上述步骤添加了SSL证书后，发现如果在地址栏中输入的是https://域名/ 就会有绿锁头，如果输入的是http://域名/ ，则还是http,并不会自动跳转至https。怎样让访客点击http://域名/ 时能强制跳转到https呢？<br>在Google上看了好多的博客都没能找到解决方案，突然发现Github上有一个<code>Enforce HTTPS</code>选项，抱着试一试的心态，最后竟然成功了。</p>
<ol>
<li>登录Github，进入自己的Github.io项目中，点击<code>Setting</code>，往下拉，可以看到有个选项叫<code>Enforce HTTPS</code>,点击勾选。<br><img data-src="/images/20180410115944.jpg" alt></li>
<li>打开浏览器，在地址中输入自己的http://域名/ ，已经可以自动跳转到https下了，大功告成。</li>
</ol>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>L2-3.名人堂与代金券</title>
    <url>/45393.html</url>
    <content><![CDATA[<h2 id="题目内容"><a href="#题目内容" class="headerlink" title="题目内容"></a>题目内容</h2><p>对于在中国大学MOOC(<a href="http://www.icourse163.org/" target="_blank" rel="noopener">http://www.icourse163.org/</a>) 学习“数据结构”课程的学生，想要获得一张合格证书，总评成绩必须达到 60 分及以上，并且有另加福利：总评分在 [G, 100] 区间内者，可以得到 50 元 PAT 代金券；在 [60, G) 区间内者，可以得到 20 元PAT代金券。全国考点通用，一年有效。同时任课老师还会把总评成绩前 K 名的学生列入课程“名人堂”。本题就请你编写程序，帮助老师列出名人堂的学生，并统计一共发出了面值多少元的 PAT 代金券。<br><a id="more"></a></p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入在第一行给出 3 个整数，分别是 N（不超过 10 000 的正整数，为学生总数）、G（在 (60,100) 区间内的整数，为题面中描述的代金券等级分界线）、K（不超过 100 且不超过 N 的正整数，为进入名人堂的最低名次）。接下来 N 行，每行给出一位学生的账号（长度不超过15位、不带空格的字符串）和总评成绩（区间 [0, 100] 内的整数），其间以空格分隔。题目保证没有重复的账号。 </p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>首先在一行中输出发出的 PAT 代金券的总面值。然后按总评成绩非升序输出进入名人堂的学生的名次、账号和成绩，其间以 1 个空格分隔。需要注意的是：成绩相同的学生享有并列的排名，排名并列时，按账号的字母序升序输出。</p>
<h2 id="输入样例"><a href="#输入样例" class="headerlink" title="输入样例"></a>输入样例</h2><div class="note default no-icon"><p><br>10 80 5<br><a href="mailto:cy@zju.edu.cn" target="_blank" rel="noopener">cy@zju.edu.cn</a> 78<br><a href="mailto:cy@pat-edu.com" target="_blank" rel="noopener">cy@pat-edu.com</a> 87<br><a href="mailto:1001@qq.com" target="_blank" rel="noopener">1001@qq.com</a> 65<br><a href="mailto:uh-oh@163.com" target="_blank" rel="noopener">uh-oh@163.com</a> 96<br><a href="mailto:test@126.com" target="_blank" rel="noopener">test@126.com</a> 39<br><a href="mailto:anyone@qq.com" target="_blank" rel="noopener">anyone@qq.com</a> 87<br><a href="mailto:zoe@mit.edu" target="_blank" rel="noopener">zoe@mit.edu</a> 80<br><a href="mailto:jack@ucla.edu" target="_blank" rel="noopener">jack@ucla.edu</a> 88<br><a href="mailto:bob@cmu.edu" target="_blank" rel="noopener">bob@cmu.edu</a> 80<br><a href="mailto:ken@163.com" target="_blank" rel="noopener">ken@163.com</a> 70<br></p></div>

<h2 id="输出样例"><a href="#输出样例" class="headerlink" title="输出样例"></a>输出样例</h2><div class="note default no-icon"><p><br>360<br>1 <a href="mailto:uh-oh@163.com" target="_blank" rel="noopener">uh-oh@163.com</a> 96<br>2 <a href="mailto:jack@ucla.edu" target="_blank" rel="noopener">jack@ucla.edu</a> 88<br>3 <a href="mailto:anyone@qq.com" target="_blank" rel="noopener">anyone@qq.com</a> 87<br>3 <a href="mailto:cy@pat-edu.com" target="_blank" rel="noopener">cy@pat-edu.com</a> 87<br>5 <a href="mailto:bob@cmu.edu" target="_blank" rel="noopener">bob@cmu.edu</a> 80<br>5 <a href="mailto:zoe@mit.edu" target="_blank" rel="noopener">zoe@mit.edu</a> 80<br></p></div>

<p><strong>时间限制：150ms内存限制：65536kb</strong></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h3><p>用一个结构体来存姓名和成绩，再用自定义的比较函数sort一下。<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stu</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">int</span> grade;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> stu&amp; s1, <span class="keyword">const</span> stu&amp; s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(s1.grade != s2.grade)</span><br><span class="line">        <span class="keyword">return</span> s1.grade &gt; s2.grade;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> s1.name &lt; s2.name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//freopen("in.txt", "r", stdin);</span></span><br><span class="line">    <span class="comment">//freopen("out.txt", "w", stdout);</span></span><br><span class="line">    <span class="built_in">cin</span>.sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">int</span> n, g, k;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; g &gt;&gt; k;</span><br><span class="line">    <span class="built_in">vector</span>&lt;stu&gt; v;</span><br><span class="line">    ll ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> temp1;</span><br><span class="line">        <span class="keyword">int</span> temp2;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; temp1 &gt;&gt; temp2;</span><br><span class="line">        stu temp;</span><br><span class="line">        temp.name = temp1;</span><br><span class="line">        temp.grade = temp2;</span><br><span class="line">        v.push_back(temp);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(temp2 &gt;= <span class="number">60</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(temp2 &lt; g)</span><br><span class="line">                ans += <span class="number">20</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                ans += <span class="number">50</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> number = <span class="number">1</span>;</span><br><span class="line">    sort(v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>(), cmp);</span><br><span class="line">    <span class="built_in">vector</span>&lt;stu&gt;::iterator t;</span><br><span class="line">    ll flag = v[<span class="number">0</span>].grade;</span><br><span class="line">    <span class="keyword">for</span>(t = v.<span class="built_in">begin</span>(); t != v.<span class="built_in">end</span>(); t++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(flag != (*t).grade)</span><br><span class="line">        &#123;</span><br><span class="line">            flag = (*t).grade;</span><br><span class="line">            index = number;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(index &gt; k)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; index &lt;&lt; <span class="string">" "</span> &lt;&lt; (*t).name &lt;&lt; <span class="string">" "</span> &lt;&lt; (*t).grade &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        number++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h3><p>用一个map&lt;string,name&gt;来存name和grade,将map转存到vcetor到中进行排序。<br>比赛的时候好蠢好蠢的做法，后面会说。<br><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span> <span class="params">(<span class="keyword">const</span> pair&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt;&amp; a,<span class="keyword">const</span> pair&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt;&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a.second!=b.second)</span><br><span class="line">        <span class="keyword">return</span> a.second&gt;b.second;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> a.first&lt;b.first;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//freopen("in.txt", "r", stdin);</span></span><br><span class="line">    <span class="comment">//freopen("out.txt", "w", stdout);</span></span><br><span class="line">    <span class="built_in">cin</span>.sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">int</span> n,g,k;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n&gt;&gt;g&gt;&gt;k;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt; m;</span><br><span class="line">    ll ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> temp1;</span><br><span class="line">        <span class="keyword">int</span> temp2;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;temp1&gt;&gt;temp2;</span><br><span class="line">        m.insert(pair&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt;(temp1,temp2));</span><br><span class="line">        <span class="keyword">if</span>(temp2&gt;=<span class="number">60</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(temp2&lt;g)</span><br><span class="line">                ans+=<span class="number">20</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                ans+=<span class="number">50</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    vector&lt;pair&lt;string,int&gt;&gt; mm(m.begin(),m.end());//map转存至vector</span><br><span class="line">    sort(mm.<span class="built_in">begin</span>(),mm.<span class="built_in">end</span>(),cmp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> index=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> number=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">vector</span>&lt;pair&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt;&gt;::iterator t=mm.<span class="built_in">begin</span>();</span><br><span class="line">    ll flag=(*t).second;</span><br><span class="line">    <span class="keyword">for</span>(t=mm.<span class="built_in">begin</span>();t!=mm.<span class="built_in">end</span>();t++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(flag!=(*t).second)</span><br><span class="line">        &#123;</span><br><span class="line">            flag=(*t).second;</span><br><span class="line">            index=number;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(index&gt;k)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;index&lt;&lt;<span class="string">" "</span>&lt;&lt;(*t).first&lt;&lt;<span class="string">" "</span>&lt;&lt;(*t).second&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        number++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>比赛的时候没看清题意，上来就直接一个map，快写完了的时候才发现不对，然后就突发奇想的对map进行sort，但是编译的时候比较函数那一行一直报错。我到现在都不清楚为什么比赛的时候要一直死磕对map按照value进行sort，就是懒得改成结构体加vector，结果直到比赛结束前几分钟才开始改，虽然改完了可惜没时间交了。<br>回到宿舍终于在网上找到了对map进行sort的方法：将map转存至vector中，然后sort。<code>vector&lt;pair&lt;string,int&gt;&gt; mm(m.begin(),m.end());</code>但是还是用结构体加vector方便啊。<br>还是自己菜啊…….</p>
<div class="note warning"><p><br>注意：STL库中的sort函数只能对线性存储的对象进行排序,如:vector、array、list、deque,不能对集合容器进行排序,如:set、map;<br></p></div>

<p>参考博客:<a href="https://blog.csdn.net/iicy266/article/details/11906189" target="_blank" rel="noopener">C++ STL中Map的按Key排序和按Value排序</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>CCCC天梯赛</category>
      </categories>
      <tags>
        <tag>CCCC天梯赛</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo+Github pages博客绑定中文域名</title>
    <url>/24787.html</url>
    <content><![CDATA[<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>近期又开始了hexo的折腾，在阿里云上买了一个属于自己的域名，因此想着把自己用hexo+Github搭建的博客通过域名访问，于是按照百度上的教程一步一步来绑定域名，结果出现了很多问题 。整个过程可谓一波三折，终于实现了通过域名来访问博客，下面简要介绍一下我绑定域名过程中遇到的问题以及解决方案。<br><a id="more"></a></p>
<h2 id="购买域名"><a href="#购买域名" class="headerlink" title="购买域名"></a>购买域名</h2><p>这里以在<a href="https://www.aliyun.com/" target="_blank" rel="noopener">阿里云</a>上购买域名为例,大家也可以去其他平台购买域名。<br>登录阿里云，点击<strong>产品</strong>，选择<strong>域名注册</strong>。<br>注册域名前需查询域名是否已被注册，选择自己喜欢的域名，支付即可。<br><img data-src="/images/20180213014855.jpg" alt><br>一般来说，.top与.xyz结尾的域名都比较便宜。为了节约成本，我买的.top结尾的域名，一年只需两块钱，很便宜。</p>
<h2 id="域名解析"><a href="#域名解析" class="headerlink" title="域名解析"></a>域名解析</h2><p>购买域名后，我们依次点击个人昵称-&gt;域名与网站(万网)-&gt;域名，进入管理控制台，在这里我们可以看到自己购买的域名,点击<strong>解析</strong>，进入解析设置。<br><img data-src="/images/20180212235815.jpg" alt><br>点击添加解析，依次输入：<strong>CNAME、@、Github博客地址</strong>，点击<strong>确定</strong>，完成个人域名向个人博客的映射。<br><img data-src="/images/20180212230359.jpg" alt></p>
<div class="note warning"><p>注意：这里填入博客地址的时候无需填写https:// ，只需按照example.github.io格式填写就行了。<br></p></div>

<h2 id="创建CNAME文件"><a href="#创建CNAME文件" class="headerlink" title="创建CNAME文件"></a>创建CNAME文件</h2><p>在本地的根目录下的source文件夹中新建一个名为<strong>CNAME</strong>的文本文件，文件内容为<strong>个人域名</strong>（没有http:// ,也没有www.）,然后重命名删除该文件的后缀名:<strong>.txt</strong>。<br>使用<code>hexo d -g</code>命令部署博客，这时在浏览器中输入新注册的域名，已经可以正常的访问博客了。</p>
<h3 id="英文域名"><a href="#英文域名" class="headerlink" title="英文域名"></a>英文域名</h3><p>英文域名就直接写:<code>example.con</code></p>
<h3 id="中文域名"><a href="#中文域名" class="headerlink" title="中文域名"></a>中文域名</h3><p>中文域名的话,则需先将中文域名转换为<strong>Punycode标准编码的字符串</strong>:<a href="http://www.dh.vg/tools/zm.php" target="_blank" rel="noopener">中文域名转换Punycode标准编码工具</a><br>For example:<br><code>例子.中文</code>经过转换为<code>xn--fsqu00a.xn--fiq228c</code><br>将<code>xn--****.xn--***</code>填入<strong>CNAME</strong>文件即可。</p>
<p><div class="note danger"><p>如果直接在CNAME文件中填写中文域名,则Github会通过邮件提醒你:<br>The CNAME xxx.com is not properly formatted. See <a href="https://help.github.com/articles/troubleshooting-custom-domains/#github-repository-setup-errors" target="_blank" rel="noopener">https://help.github.com/articles/troubleshooting-custom-domains/#github-repository-setup-errors</a> for more information.<br></p></div></p>
<h2 id="LeanCloud数据丢失"><a href="#LeanCloud数据丢失" class="headerlink" title="LeanCloud数据丢失"></a>LeanCloud数据丢失</h2><p>通过域名访问博客，发现文章的阅读次数不显示，于是各种折腾：检查元素、谷歌，最后发现是由于没有将新注册的域名加入到LeanCloud设置中的<strong>Web 安全域名</strong>,导致无法调用服务器资源。<br>解决方案：访问：<a href="https://leancloud.cn" target="_blank" rel="noopener">LeanCloud官网</a>,进入<strong>控制台</strong>，在设置中点击<strong>安全中心</strong>，将新注册的域名加入到<strong>Web安全域名</strong>中，点击<strong>保存</strong>即可。<br><img data-src="/images/20180213013700.jpg" alt></p>
<h2 id="busuanzi数据丢失"><a href="#busuanzi数据丢失" class="headerlink" title="busuanzi数据丢失"></a>busuanzi数据丢失</h2><p>无论是通过域名还是github地址访问博客，博客底部的统计浏览量与浏览人次均不是以前的数据，而是从头开始计算….<br>busuanzi还不具备统初始值的功能，只能从头开始计算了。。。</p>
<h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><h3 id="中文域名-1"><a href="#中文域名-1" class="headerlink" title="中文域名"></a>中文域名</h3><p>１、一类是域名后缀为英文字母的国际中文域名和别国中文域名，比如：中文.com，中文.net，中文.biz，中文.cc，中文.hk，中文.tm，中文.tv，中文.tw；<br>２、一类是域名后缀为中文的纯中文国内中文域名，比如：中文域名.中国，中文域名.公司，中文域名.网络；<br>中文域名在解析的时候，需要先转换为 xn–fiq228c.com或xn–fiq228c.cn形式的ASCII码，这种编码称为PunyCode。纯中文域名不被标准的解析服务器支持，要实现对这种纯中文域名的正确访问，ISP需要做相应的修改，以便能够正确解析中文域名。同时CNNIC也提供了专用服务器，用户只要将浏览器的DNS设置指向这台服务器，它同样可以完成对纯中文域名的正确解析。另外，考虑到现在有些ISP还没有做修改，而有些用户又不方便将DNS设置指向CNNIC提供的服务器，纯中文域名会被加上.cn后缀，即对每一个纯中文域名同时有两种形式：纯中文域名和纯中文域名.CN， 如：”中文域名.网络”和”中文域名.网络.CN”。这样即使ISP还没有做相应的修改，用户也可以正确使用中文域名。</p>
<h3 id="PunyCode"><a href="#PunyCode" class="headerlink" title="PunyCode"></a>PunyCode</h3><p>英文域名在IIS或Apache中的虚拟主机设置，可以直接使用英文域名，如webmasterhome.cn。<br>中文域名在IIS或Apache中应如何设置主机头呢？如”中国站长之家.com”。<br>1、在进行设置之前要先把中文域名转化成为PunyCode编码，然后在主机头设置里面填上中文域名所对应的PunyCode编码(｀xn–fiqsC146Ah4ex80Cro7A.com｀)便可。<br>新的国际化域名的标准在网域名称编码上，为了保留向下兼容性及不影响现有的应用程序协议，因此将多国语言域名转成ASCII编码，而这种编码称为『punycode』。<br>因为经过Nameprep处理过的国际化域名是以 Unicode 序列的形式表示的。但现有的 DNS系统只支持用 ASCII字符表示的域名，所以要对Unicode序列进行 ACE(ASCII-compatible encoding)编码，把 Unicode序列表示的域名转换成 ASCII 字符串表示的ACE域名。<br>2、PunyCode是一种专为国际化域名而设计的高效ACE编码方式。它可以在Unicode序列和ASCII 字符串之间进行唯一的和可逆的转换。转换的过程中，Unicode 序列中的ASCII字符保持不变，国际化字符则用字母和数字来表示。它的实质是一种用数量有限的基本字符(字母和数字)来唯一地表示大字符集(Unicode)中的字符的通用算法。域名中的字符，包括 ASCII 码和 Unicode 码，都是作为整数进行处理。<br>PunyCode则是将一个经过Nameprep处理过的IDN，从一个8位的编码的形式转换为7位编码的形式。目前Internet DNS一向是7位ASCII编码的环境，经过这个PunyCode转码程序，便将IDN从一个8位的IDN转换为与现有DNS环境兼容的编码。<br>3、在DNS服务器方面，需要将IDN以PunyCode的编码形式来设定。因为PunyCode本身就是一种7位的编码，与ASCII编码完全兼容，所以可适用设定于目前所有可用的DNS版本,也就是说可以不需要为了设定PunyCode而重新安装BIND新版本。但是若是需要使用DNAME指令来设定资源记录(Resource Record)，则需先提升为BIND9的版本。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>Github</tag>
      </tags>
  </entry>
  <entry>
    <title>期末考试_细胞自动机</title>
    <url>/6200.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>这是细胞自动机的非图形版本。细胞自动机是指在一个二维网格内，每一个网格是一个细胞。每个细胞有活和死两种状态。<br>初始时刻，有些细胞是活的，有些细胞是死的。自动机的每一步，根据每个细胞周围8个格子内的其他细胞的生存情况决定这个细胞下一步是否存活。具体的规则如下：</p>
<ul>
<li>如果该细胞现在是活的，并且周围8个格子中有2或3个活着的细胞，则继续存活；如果周围8个格子中的活着的细胞数量少于2个或多于3个，则死亡；</li>
<li>如果该细胞现在是死的，并且周围8个格子中正好有3个活着的细胞，则细胞复活。</li>
<li>位于整个网格边缘和顶角的细胞，它的周围细胞可能少于8个。即越过网格的边界不再有细胞。</li>
<li>每个细胞的生死变化，都不会影响当前这一步周围的细胞，只会在下一步表现出来。</li>
</ul>
<p>提示：课程中的代码与上一句描述不同。<br><a id="more"></a></p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>首先输入两个正整数，范围为[3,102]，依次表示网格的宽度和高度。<br>然后输入多组正整数，依次表示一个活着的细胞的网格位置，每组数字中，第一个表示行号，第二个表示列号，均从0开始编号。<br>最后，以“-1 -1”表示不再有活着的细胞。-1 -1不是有效的位置。<br>然后，以一个正整数，范围为[1,10000]，表示要求细胞自动机执行的步数。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>输出一个正整数，表示执行完毕后，剩下的活着的细胞的数量。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><div class="note default no-icon"><p>3 3<br>1 1 1 2 0 1 2 1<br>-1 -1<br>1<br></p></div><br>## 输出样例：<br><div class="note default no-icon"><p>7<br></p></div>

<p><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 面向对象程序设计_Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">The_final_exam</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> times;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> width;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line">	<span class="keyword">int</span> old_field[][];</span><br><span class="line">	<span class="keyword">int</span> new_field[][];</span><br><span class="line"></span><br><span class="line">	Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		width = in.nextInt();</span><br><span class="line">		height = in.nextInt();</span><br><span class="line">		old_field = <span class="keyword">new</span> <span class="keyword">int</span>[height+<span class="number">2</span>][width+<span class="number">2</span>];</span><br><span class="line">		new_field = <span class="keyword">new</span> <span class="keyword">int</span>[height+<span class="number">2</span>][width+<span class="number">2</span>];</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 初始化为0</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; height+<span class="number">2</span>; i++)</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; width+<span class="number">2</span>; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				old_field[i][j] = <span class="number">0</span>;</span><br><span class="line">				old_field[i][j] = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//读入活的细胞的位置</span></span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">int</span> i=in.nextInt();</span><br><span class="line">			<span class="keyword">int</span> j=in.nextInt();</span><br><span class="line">			<span class="keyword">if</span>(i==-<span class="number">1</span>&amp;&amp;j==-<span class="number">1</span>)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			old_field[i+<span class="number">1</span>][j+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">			new_field[i+<span class="number">1</span>][j+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//读入执行步数</span></span><br><span class="line">		times = in.nextInt();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;times;k++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;height+<span class="number">1</span>;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">1</span>;j&lt;width+<span class="number">1</span>;j++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">int</span> count=getNeighbor(i, j);</span><br><span class="line">					<span class="keyword">if</span>(old_field[i][j]==<span class="number">0</span>)</span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span>(count==<span class="number">3</span>)<span class="comment">//细胞复活</span></span><br><span class="line">							new_field[i][j]=<span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">					&#123;</span><br><span class="line">						<span class="keyword">if</span>(!(count==<span class="number">2</span>||count==<span class="number">3</span>))<span class="comment">//细胞死亡</span></span><br><span class="line">							new_field[i][j]=<span class="number">0</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//copy</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; height+<span class="number">1</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; width+<span class="number">1</span>; j++)</span><br><span class="line">				&#123;</span><br><span class="line">					old_field[i][j] = new_field[i][j];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">getNeighbor</span><span class="params">(<span class="keyword">int</span> i,<span class="keyword">int</span> j)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//计算位置为i，j的细胞周围活的细胞的数量</span></span><br><span class="line">		<span class="keyword">int</span> temp=<span class="number">0</span>;</span><br><span class="line">		temp+=old_field[i-<span class="number">1</span>][j]+old_field[i+<span class="number">1</span>][j]+old_field[i][j-<span class="number">1</span>]+old_field[i][j+<span class="number">1</span>];</span><br><span class="line">		temp+=old_field[i-<span class="number">1</span>][j-<span class="number">1</span>]+old_field[i-<span class="number">1</span>][j+<span class="number">1</span>]+old_field[i+<span class="number">1</span>][j-<span class="number">1</span>]+old_field[i+<span class="number">1</span>][j+<span class="number">1</span>];</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">Count</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">//计算活着的细胞的数量</span></span><br><span class="line">		<span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; height+<span class="number">1</span>; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; width+<span class="number">1</span>; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(old_field[i][j]==<span class="number">1</span>)</span><br><span class="line">					count++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> count;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Init();</span><br><span class="line">		run();</span><br><span class="line">		System.out.println(Count());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="keyword">new</span> The_final_exam().Test();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>简单模拟题….<br>用两个二维数组来存细胞，细胞自动机每执行一次，遍历数组1一次，对数组1中每个细胞的状态进行判断，计算周围活着的细胞的数量，然后对数组2进行相应的操作，所有操作完成后将数组2拷贝至数组1。<br>这里判断细胞周围活着的细胞数量时有一个小技巧，不需要对每种边界情况进行处理,可以将数组开大点，下标从1开始使用，相当于在所使用的有效数组空间外面绕了一圈，避免数组越界。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>面向对象程序设计_Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>用Python绘制七段数码管</title>
    <url>/48183.html</url>
    <content><![CDATA[<h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>数码管是一种价格便宜、使用简单的发光电子器件，广泛应用在价格较低的电子类产品中，其中，七段数码管最为常用。七段数码管<br>（seven-segment indicator）由7 段数码管拼接而成，每段有亮或不亮两种情况，改进型的七段数码管还包括一个小数点位置，如图1 所示。<br><a id="more"></a><br><img data-src="/images/20171205201558358.jpg" alt></p>
<p>　　　　　　　　　　　　　　　　　　　　　　　　　　图 1：七段数码管的结构图<br>七段数码管能形成27=128 种不同状态，其中部分状态能够显示易于人们理解的数字或字母含义，因此被广泛使用。图2 给出了十六进制中16 个字符的七段数码管表示。<br><img data-src="/images/20171205201607868.jpg" alt><br>　　　　　　　　　　　　　　　　　　　　　　　　　　图 2：十六进制中16 个字符的七段数码管表示<br>请采用turtle 库并使用函数封装绘制七段数码管，显示当前系统日期和时间。该问题的IPO 描述如下：输入：当前日期的数字形式处理：根据每个数字绘制七段数码管表示输出：绘制当前日期的七段数码管表示程序的预期运行效果如图3 和图4 所示，与两个效果中任何一个相似均可。<br><img data-src="/images/20171205201613806.jpg" alt><br><img data-src="/images/20171205201625796.jpg" alt></p>
<h2 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on Dec 5, 2017</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: QiZhao</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> turtle,datetime  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawGap</span><span class="params">()</span>:</span><span class="comment">#画数码管间隔</span></span><br><span class="line">    turtle.penup()</span><br><span class="line">    turtle.fd(<span class="number">5</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawline</span><span class="params">(flag)</span>:</span><span class="comment">#画单条数码管</span></span><br><span class="line">    drawGap()</span><br><span class="line">    turtle.pendown()</span><br><span class="line">    <span class="keyword">if</span>(flag==<span class="literal">False</span>):</span><br><span class="line">        turtle.penup()</span><br><span class="line">    turtle.fd(<span class="number">40</span>)</span><br><span class="line">    drawGap()</span><br><span class="line">    turtle.right(<span class="number">90</span>)</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawdight</span><span class="params">(dight)</span>:</span><span class="comment">#根据数字绘制对应数字的数码管</span></span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    turtle.left(<span class="number">90</span>)</span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">if</span> dight <span class="keyword">in</span> [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]:</span><br><span class="line">        drawline(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        drawline(<span class="literal">False</span>)</span><br><span class="line">    turtle.setheading(<span class="number">0</span>)</span><br><span class="line">    turtle.fd(<span class="number">25</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drawdata</span><span class="params">(data)</span>:</span><span class="comment">#根据日期画出对应数字</span></span><br><span class="line">    turtle.color(<span class="string">"red"</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> i==<span class="string">'+'</span>:</span><br><span class="line">            turtle.write(<span class="string">'年'</span>,font=(<span class="string">"宋体"</span>, <span class="number">24</span>, <span class="string">"normal"</span>))</span><br><span class="line">            turtle.color(<span class="string">"green"</span>)</span><br><span class="line">            turtle.fd(<span class="number">30</span>)</span><br><span class="line">        <span class="keyword">elif</span> i==<span class="string">'-'</span>:</span><br><span class="line">            turtle.write(<span class="string">'月'</span>,font=(<span class="string">"宋体"</span>, <span class="number">24</span>, <span class="string">"normal"</span>))</span><br><span class="line">            turtle.color(<span class="string">"blue"</span>)</span><br><span class="line">            turtle.fd(<span class="number">30</span>)</span><br><span class="line">        <span class="keyword">elif</span> i==<span class="string">'*'</span>:</span><br><span class="line">            turtle.write(<span class="string">'日'</span>,font=(<span class="string">"宋体"</span>, <span class="number">24</span>, <span class="string">"normal"</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            drawdight(eval(i))</span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    turtle.setup(<span class="number">800</span>,<span class="number">500</span>)</span><br><span class="line">    turtle.penup()</span><br><span class="line">    turtle.fd(<span class="number">-350</span>)</span><br><span class="line">    turtle.pendown()</span><br><span class="line">    turtle.hideturtle()</span><br><span class="line">    turtle.pensize(<span class="number">6</span>)</span><br><span class="line">    turtle.speed(<span class="number">9</span>)</span><br><span class="line">    drawdata(datetime.datetime.now().strftime(<span class="string">'%Y+%m-%d*'</span>))</span><br><span class="line">    a=input()</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img data-src="/images/20171205202005054.jpg" alt></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>利用Python画小树和森林（宽度优先绘制+深度优先绘制)</title>
    <url>/15900.html</url>
    <content><![CDATA[<p>在中M上看嵩天老师的<a href="http://www.icourse163.org/learn/BIT-268001" target="_blank" rel="noopener">《Python语言程序设计》</a>时,视频中给出了宽度优先绘制法的代码,仅提了一下还有另外一种画法(深度优先绘制法).联系到最近学的数据结构，摸索出了另一种画法。<br><a id="more"></a></p>
<h2 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on Dec 2, 2017</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: QiZhao</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="comment"># drawtree.py</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> turtle <span class="keyword">import</span> Turtle</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tree</span><span class="params">(plist, l, a, f)</span>:</span></span><br><span class="line">    <span class="comment">#宽度优先绘制法</span></span><br><span class="line">    <span class="string">""" plist is list of pens</span></span><br><span class="line"><span class="string">    l is length of branch</span></span><br><span class="line"><span class="string">    a is half of the angle between 2 branches</span></span><br><span class="line"><span class="string">    f is factor by which branch is shortened</span></span><br><span class="line"><span class="string">    from level to level."""</span></span><br><span class="line">    <span class="keyword">if</span> l &gt; <span class="number">5</span>:</span><br><span class="line">        lst = []</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> plist:</span><br><span class="line">            p.forward(l)<span class="comment">#Move the turtle forward by the specified distance, in the direction the turtle is headed.</span></span><br><span class="line">            q = p.clone()<span class="comment">#Create and return a clone of the turtle with same position, heading and turtle properties.</span></span><br><span class="line">            p.left(a) <span class="comment">#Turn turtle left by angle units</span></span><br><span class="line">            q.right(a)<span class="comment"># turn turtle right by angle units, nits are by default degrees, but can be set via the degrees() and radians() functions.</span></span><br><span class="line">            lst.append(p)</span><br><span class="line">            lst.append(q)</span><br><span class="line">        tree(lst, l*f, a, f)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tree2</span><span class="params">(p,l,a,f)</span>:</span></span><br><span class="line">    <span class="comment">#深度优先绘制法</span></span><br><span class="line">    <span class="keyword">if</span> l&gt;<span class="number">5</span>:</span><br><span class="line">        p.forward(l)</span><br><span class="line">        q=p.clone()</span><br><span class="line">        p.left(a)</span><br><span class="line">        q.right(a)</span><br><span class="line">        tree2(p, l*f, a, f)</span><br><span class="line">        tree2(q, l*f, a, f)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maketree</span><span class="params">(x,y)</span>:</span>     </span><br><span class="line">    p = Turtle()</span><br><span class="line">    p.color(<span class="string">"blue"</span>)</span><br><span class="line">    p.pensize(<span class="number">5</span>)</span><br><span class="line">    p.setundobuffer(<span class="literal">None</span>)</span><br><span class="line">    p.hideturtle() </span><br><span class="line">    <span class="comment">#Make the turtle invisible. It’s a good idea to do this while you’re in the middle of doing some complex drawing,</span></span><br><span class="line">    <span class="comment">#because hiding the turtle speeds up the drawing observably.</span></span><br><span class="line">    <span class="comment">#p.speed(9)</span></span><br><span class="line">    p.getscreen().tracer(<span class="number">1</span>,<span class="number">0</span>)<span class="comment">#Return the TurtleScreen object the turtle is drawing on.</span></span><br><span class="line">    <span class="comment">#TurtleScreen methods can then be called for that object.</span></span><br><span class="line">    p.left(<span class="number">90</span>)<span class="comment"># Turn turtle left by angle units. direction</span></span><br><span class="line"> </span><br><span class="line">    p.penup() <span class="comment">#Pull the pen up – no drawing when moving.</span></span><br><span class="line">    p.goto(x,y)<span class="comment">#Move turtle to an absolute position. If the pen is down, draw line. Do not change the turtle’s orientation.</span></span><br><span class="line">    p.pendown()<span class="comment"># Pull the pen down – drawing when moving. </span></span><br><span class="line">    <span class="comment">#这三条语句是一个组合相当于先把笔收起来再移动到指定位置，再把笔放下开始画.否则turtle一移动就会自动的把线画出来</span></span><br><span class="line"> </span><br><span class="line">    tree([p], <span class="number">100</span>, <span class="number">65</span>, <span class="number">0.6375</span>)</span><br><span class="line">    </span><br><span class="line">    p.penup() </span><br><span class="line">    p.setheading(<span class="number">90</span>)<span class="comment">#Set the orientation of the turtle to to_angle.</span></span><br><span class="line">    p.goto(x,y)</span><br><span class="line">    p.down()</span><br><span class="line">    p.color(<span class="string">"green"</span>)</span><br><span class="line">    </span><br><span class="line">    tree2(p, <span class="number">100</span>, <span class="number">65</span>, <span class="number">0.6375</span>) </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    maketree(<span class="number">-200</span>, <span class="number">-200</span>)</span><br><span class="line">    maketree(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    maketree(<span class="number">200</span>,<span class="number">-200</span>)</span><br><span class="line">    </span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img data-src="/images/20171202204712994.jpg" alt></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>利用Python的turtle库绘制玫瑰</title>
    <url>/17747.html</url>
    <content><![CDATA[<p>turtle的文档：<a href="https://docs.python.org/3/library/turtle.html" target="_blank" rel="noopener"></a><br>用Python的turtle库绘图是很简单的,闲来无事就画了一个玫瑰花,下面奉上源码….<br><a id="more"></a></p>
<h2 id="源码："><a href="#源码：" class="headerlink" title="源码："></a>源码：</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Created on Nov 18, 2017</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@author: QiZhao</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置初始位置</span></span><br><span class="line">turtle.penup()</span><br><span class="line">turtle.left(<span class="number">90</span>)</span><br><span class="line">turtle.fd(<span class="number">200</span>)</span><br><span class="line">turtle.pendown()</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 花蕊</span></span><br><span class="line">turtle.fillcolor(<span class="string">"red"</span>)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.circle(<span class="number">10</span>,<span class="number">180</span>)</span><br><span class="line">turtle.circle(<span class="number">25</span>,<span class="number">110</span>)</span><br><span class="line">turtle.left(<span class="number">50</span>)</span><br><span class="line">turtle.circle(<span class="number">60</span>,<span class="number">45</span>)</span><br><span class="line">turtle.circle(<span class="number">20</span>,<span class="number">170</span>)</span><br><span class="line">turtle.right(<span class="number">24</span>)</span><br><span class="line">turtle.fd(<span class="number">30</span>)</span><br><span class="line">turtle.left(<span class="number">10</span>)</span><br><span class="line">turtle.circle(<span class="number">30</span>,<span class="number">110</span>)</span><br><span class="line">turtle.fd(<span class="number">20</span>)</span><br><span class="line">turtle.left(<span class="number">40</span>)</span><br><span class="line">turtle.circle(<span class="number">90</span>,<span class="number">70</span>)</span><br><span class="line">turtle.circle(<span class="number">30</span>,<span class="number">150</span>)</span><br><span class="line">turtle.right(<span class="number">30</span>)</span><br><span class="line">turtle.fd(<span class="number">15</span>)</span><br><span class="line">turtle.circle(<span class="number">80</span>,<span class="number">90</span>)</span><br><span class="line">turtle.left(<span class="number">15</span>)</span><br><span class="line">turtle.fd(<span class="number">45</span>)</span><br><span class="line">turtle.right(<span class="number">165</span>)</span><br><span class="line">turtle.fd(<span class="number">20</span>)</span><br><span class="line">turtle.left(<span class="number">155</span>)</span><br><span class="line">turtle.circle(<span class="number">150</span>,<span class="number">80</span>)</span><br><span class="line">turtle.left(<span class="number">50</span>)</span><br><span class="line">turtle.circle(<span class="number">150</span>,<span class="number">90</span>)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 花瓣1</span></span><br><span class="line">turtle.left(<span class="number">150</span>)</span><br><span class="line">turtle.circle(<span class="number">-90</span>,<span class="number">70</span>)</span><br><span class="line">turtle.left(<span class="number">20</span>)</span><br><span class="line">turtle.circle(<span class="number">75</span>,<span class="number">105</span>)</span><br><span class="line">turtle.setheading(<span class="number">60</span>)</span><br><span class="line">turtle.circle(<span class="number">80</span>,<span class="number">98</span>)</span><br><span class="line">turtle.circle(<span class="number">-90</span>,<span class="number">40</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 花瓣2</span></span><br><span class="line">turtle.left(<span class="number">180</span>)</span><br><span class="line">turtle.circle(<span class="number">90</span>,<span class="number">40</span>)</span><br><span class="line">turtle.circle(<span class="number">-80</span>,<span class="number">98</span>)</span><br><span class="line">turtle.setheading(<span class="number">-83</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 叶子1</span></span><br><span class="line">turtle.fd(<span class="number">30</span>)</span><br><span class="line">turtle.left(<span class="number">90</span>)</span><br><span class="line">turtle.fd(<span class="number">25</span>)</span><br><span class="line">turtle.left(<span class="number">45</span>)</span><br><span class="line">turtle.fillcolor(<span class="string">"green"</span>)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.circle(<span class="number">-80</span>,<span class="number">90</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.circle(<span class="number">-80</span>,<span class="number">90</span>)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"> </span><br><span class="line">turtle.right(<span class="number">135</span>)</span><br><span class="line">turtle.fd(<span class="number">60</span>)</span><br><span class="line">turtle.left(<span class="number">180</span>)</span><br><span class="line">turtle.fd(<span class="number">85</span>)</span><br><span class="line">turtle.left(<span class="number">90</span>)</span><br><span class="line">turtle.fd(<span class="number">80</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 叶子2</span></span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.right(<span class="number">45</span>)</span><br><span class="line">turtle.fillcolor(<span class="string">"green"</span>)</span><br><span class="line">turtle.begin_fill()</span><br><span class="line">turtle.circle(<span class="number">80</span>,<span class="number">90</span>)</span><br><span class="line">turtle.left(<span class="number">90</span>)</span><br><span class="line">turtle.circle(<span class="number">80</span>,<span class="number">90</span>)</span><br><span class="line">turtle.end_fill()</span><br><span class="line"> </span><br><span class="line">turtle.left(<span class="number">135</span>)</span><br><span class="line">turtle.fd(<span class="number">60</span>)</span><br><span class="line">turtle.left(<span class="number">180</span>)</span><br><span class="line">turtle.fd(<span class="number">60</span>)</span><br><span class="line">turtle.right(<span class="number">90</span>)</span><br><span class="line">turtle.circle(<span class="number">200</span>,<span class="number">60</span>)</span><br></pre></td></tr></table></figure>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img data-src="/images/20171119110410660.jpg" alt></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>Python</category>
      </categories>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>第六周编程题_GPS数据处理</title>
    <url>/48389.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>NMEA-0183协议是为了在不同的GPS（全球定位系统）导航设备中建立统一的BTCM（海事无线电技术委员会）标准，由美国国家海洋电子协会（NMEA-The National Marine Electronics Associa-tion）制定的一套通讯协议。GPS接收机根据NMEA-0183协议的标准规范，将位置、速度等信息通过串口传送到PC机、PDA等设备。</p>
<p>NMEA-0183协议是GPS接收机应当遵守的标准协议，也是目前GPS接收机上使用最广泛的协议，大多数常见的GPS接收机、GPS数据处理软件、导航软件都遵守或者至少兼容这个协议。<br><a id="more"></a></p>
<p>NMEA-0183协议定义的语句非常多，但是常用的或者说兼容性最广的语句只有$GPGGA、$GPGSA、$GPGSV、$GPRMC、$GPVTG、$GPGLL等。</p>
<p>其中$GPRMC语句的格式如下：<br>$GPRMC,024813.640,A,3158.4608,N,11848.3737,E,10.05,324.27,150706,,,A*50</p>
<p>这里整条语句是一个文本行，行中以逗号“,”隔开各个字段，每个字段的大小（长度）不一，这里的示例只是一种可能，并不能认为字段的大小就如上述例句一样。</p>
<p>字段0：$GPRMC，语句ID，表明该语句为Recommended Minimum Specific GPS/TRANSIT Data（RMC）推荐最小定位信息<br>字段1：UTC时间，hhmmss.sss格式<br>字段2：状态，A=定位，V=未定位<br>字段3：纬度ddmm.mmmm，度分格式（前导位数不足则补0）<br>字段4：纬度N（北纬）或S（南纬）<br>字段5：经度dddmm.mmmm，度分格式（前导位数不足则补0）<br>字段6：经度E（东经）或W（西经）<br>字段7：速度，节，Knots<br>字段8：方位角，度<br>字段9：UTC日期，DDMMYY格式<br>字段10：磁偏角，（000 - 180）度（前导位数不足则补0）<br>字段11：磁偏角方向，E=东W=西<br>字段16：校验值</p>
<p>这里，“<em>”为校验和识别符，其后面的两位数为校验和，代表了“$”和“</em>”之间所有字符（不包括这两个字符）的异或值的十六进制值。上面这条例句的校验和是十六进制的50，也就是十进制的80。</p>
<p>提示：^运算符的作用是异或。将$和<em>之间所有的字符做^运算(第一个字符和第二个字符异或，结果再和第三个字符异或，依此类推)之后的值对65536取余后的结果，应该和</em>后面的两个十六进制数字的值相等，否则的话说明这条语句在传输中发生了错误。注意这个十六进制值中是会出现A-F的大写字母的。另外，如果你需要的话，可以用Integer.parseInt(s)从String变量s中得到其所表达的整数数字；而Integer.parseInt(s, 16)从String变量s中得到其所表达的十六进制数字</p>
<p>现在，你的程序要读入一系列GPS输出，其中包含$GPRMC，也包含其他语句。在数据的最后，有一行单独的<br>END<br>表示数据的结束。</p>
<p>你的程序要从中找出$GPRMC语句，计算校验和，找出其中校验正确，并且字段2表示已定位的语句，从中计算出时间，换算成北京时间。一次数据中会包含多条$GPRMC语句，以最后一条语句得到的北京时间作为结果输出。</p>
<p>你的程序一定会读到一条有效的$GPRMC语句。</p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>多条GPS语句，每条均以回车换行结束。最后一行是END三个大写字母。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>6位数时间，表达为：<br>hh:mm:ss<br>其中，hh是两位数的小时，不足两位时前面补0；mm是两位数的分钟，不足两位时前面补0；ss是两位数的秒，不足两位时前面补0。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><div class="note default no-icon"><p>$GPRMC,024813.640,A,3158.4608,N,11848.3737,E,10.05,324.27,150706,,,A*50<br>END<br></p></div>

<h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><div class="note default no-icon"><p>10:48:13<br></p></div>

<p><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">package 零基础学Java语言_翁恺;</span><br><span class="line"></span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class Sixth_Week_2</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args)</span><br><span class="line">	&#123;</span><br><span class="line">		// TODO Auto-generated method stub</span><br><span class="line">		final int mod = 65536;</span><br><span class="line">		Scanner in = new Scanner(System.in);</span><br><span class="line">		String s = null;</span><br><span class="line">		int hh = 0, mm = 0, ss = 0;</span><br><span class="line">		int cnt = 0;</span><br><span class="line">		char state = 0;</span><br><span class="line">		String utc = null;</span><br><span class="line">		int judge = 0;</span><br><span class="line">		int judge_temp = 0;</span><br><span class="line">		String temp = null;</span><br><span class="line">		while (true)</span><br><span class="line">		&#123;</span><br><span class="line">			s = in.nextLine();</span><br><span class="line">			cnt = 0;</span><br><span class="line">			if (s.equals(&quot;END&quot;))			// 读入结束</span><br><span class="line">				break;</span><br><span class="line">			temp = s.substring(0, 6);</span><br><span class="line">			if (temp.equals(&quot;$GPRMC&quot;))			// 判断是否为$GPRMC</span><br><span class="line">			&#123;</span><br><span class="line">				utc = s.substring(7, 13);</span><br><span class="line">				temp = null;</span><br><span class="line">				for (int i = 0; i &lt; s.length(); i++)				// 获取字段2（定位）</span><br><span class="line">				&#123;</span><br><span class="line">					if (s.charAt(i) == &apos;,&apos;)</span><br><span class="line">						cnt++;</span><br><span class="line">					if (cnt == 2)</span><br><span class="line">					&#123;</span><br><span class="line">						state = s.charAt(i + 1);</span><br><span class="line">						cnt = 0;</span><br><span class="line">						break;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				if (state == &apos;A&apos;)				// 判断是否定位</span><br><span class="line">				&#123;</span><br><span class="line">					for (int i = 0; i &lt; s.length(); i++)					// 获取字段16(校验值）</span><br><span class="line">					&#123;</span><br><span class="line">						if (s.charAt(i) == &apos;,&apos;)</span><br><span class="line">							cnt++;</span><br><span class="line">						if (cnt == 12)</span><br><span class="line">						&#123;</span><br><span class="line">							temp = s.substring(i + 3, s.length());</span><br><span class="line">							judge = Integer.parseInt(temp, 16);</span><br><span class="line">							temp = null;</span><br><span class="line">							break;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					judge_temp = (int)s.charAt(1) ^ (int)s.charAt(2);// 计算校验值</span><br><span class="line">					for (int i = 3; s.charAt(i) != &apos;*&apos;; i++)</span><br><span class="line">					&#123;</span><br><span class="line">						if (s.charAt(i) == &apos;,&apos;)</span><br><span class="line">							continue;</span><br><span class="line">						else</span><br><span class="line">							judge_temp = judge_temp ^ (int)s.charAt(i)%mod;</span><br><span class="line">					&#125;</span><br><span class="line">					if (judge == judge_temp)					// 判断校验值是否相等</span><br><span class="line">					&#123;</span><br><span class="line">						// utc时间转换bjt时间</span><br><span class="line">						ss = (utc.charAt(5) - &apos;0&apos;) + (utc.charAt(4) - &apos;0&apos;) * 10;</span><br><span class="line">						mm = (utc.charAt(3) - &apos;0&apos;) + (utc.charAt(2) - &apos;0&apos;) * 10;</span><br><span class="line">						hh = (utc.charAt(1) - &apos;0&apos;) + (utc.charAt(0) - &apos;0&apos;) * 10 + 8;</span><br><span class="line">						hh = hh % 24;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.printf(&quot;%02d:%02d:%02d&quot;, hh, mm, ss);</span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="做法"><a href="#做法" class="headerlink" title="做法:"></a>做法:</h2><p>先判断前6个字符是否为“$GPRMC”，然后判断字段2(定位)是否为A，然后将字段16(校验值)用Integer.parseInt(str,16)方法转换为十进制，对’$’和‘*’之间的所有字符作^运算，并与校验值进行比较，再将UTC时间转换为BJT时间，并输出。<br>注意：对字符进行^运算时，要先使用强制类型转换为int型；<br>　　　输出时间时，不足两位的前面要补0；<br>　　　UTC时间转换为BJT时间时对跨日的处理。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>零基础学Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>第六周编程题_单词长度</title>
    <url>/26108.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>你的程序要读入一行文本，其中以空格分隔为若干个单词，以‘.’结束。你要输出这行文本中每个单词的长度。这里的单词与语言无关，可以包括各种符号，比如“it’s”算一个单词，长度为4。注意，行中可能出现连续的空格。<br><a id="more"></a></p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>输入在一行中给出一行文本，以‘.’结束，结尾的句号不能计算在最后一个单词的长度内。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>在一行中输出这行文本对应的单词的长度，每个长度之间以空格隔开，行末没有最后的空格。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><div class="note default no-icon"><p>It’s great to see you here.<br></p></div>

<h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><div class="note default no-icon"><p>4 5 2 3 3 4<br></p></div>

<p><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 零基础学Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Sixth_Week</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">		String s = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">		s = in.nextLine();</span><br><span class="line">		<span class="keyword">if</span> (s.charAt(<span class="number">0</span>) != <span class="string">'.'</span>)<span class="comment">//处理输入为一个"."时的情况</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length();)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; s.length(); j++)</span><br><span class="line">				&#123;</span><br><span class="line">					i = j;</span><br><span class="line">					<span class="keyword">if</span> (s.charAt(j) == <span class="string">' '</span>)</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">else</span> <span class="keyword">if</span> (s.charAt(j) == <span class="string">'.'</span>)</span><br><span class="line">						<span class="keyword">break</span>;</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">						ans++;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (s.charAt(i) == <span class="string">'.'</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					System.out.print(ans);</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					System.out.print(ans + <span class="string">" "</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				ans = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">while</span> (s.charAt(i) == <span class="string">' '</span>)<span class="comment">// 行中可能出现连续的空格</span></span><br><span class="line">					i++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="坑点"><a href="#坑点" class="headerlink" title="坑点:"></a>坑点:</h2><p>一是行中可能出现连续的空格；<br>二是要处理好输入为”.”时的情况。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>零基础学Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>第五周编程题_多项式加法</title>
    <url>/51603.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>一个多项式可以表达为x的各次幂与系数乘积的和，比如：<br>2x6+3x5+12x3+6x+20<br>现在，你的程序要读入两个多项式，然后输出这两个多项式的和，也就是把对应的幂上的系数相加然后输出。<br>程序要处理的幂最大为100。<br><a id="more"></a></p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>总共要输入两个多项式，每个多项式的输入格式如下：<br>每行输入两个数字，第一个表示幂次，第二个表示该幂次的系数，所有的系数都是整数。第一行一定是最高幂，最后一行一定是0次幂。<br>注意第一行和最后一行之间不一定按照幂次降低顺序排列；如果某个幂次的系数为0，就不出现在输入数据中了；0次幂的系数为0时还是会出现在输入数据中。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>从最高幂开始依次降到0幂，如：<br>2x6+3x5+12x3-6x+20<br>注意其中的x是小写字母x，而且所有的符号之间都没有空格，如果某个幂的系数为0则不需要有那项。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><div class="note default no-icon"><p>6 2<br>5 3<br>3 12<br>1 6<br>0 20<br>6 2<br>5 3<br>2 12<br>1 6<br>0 20<br></p></div>

<h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><div class="note default no-icon"><p>4x6+6x5+12x3+12x2+12x+40<br></p></div>


<p><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 零基础学Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fifth_Week</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">		<span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">101</span>];</span><br><span class="line">		<span class="keyword">int</span> m = <span class="number">0</span>, n = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">			a[i]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> m_max = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 读入第一个多项式</span></span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			m = in.nextInt();</span><br><span class="line">			n = in.nextInt();</span><br><span class="line">			a[m] = n;</span><br><span class="line">			<span class="keyword">if</span> (m &gt; m_max)</span><br><span class="line">				m_max = m;</span><br><span class="line">		&#125;<span class="keyword">while</span>(m!=<span class="number">0</span>);</span><br><span class="line">		<span class="comment">// 读入第二个多项式</span></span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			m = in.nextInt();</span><br><span class="line">			n = in.nextInt();</span><br><span class="line">			a[m] += n;</span><br><span class="line">			<span class="keyword">if</span> (m &gt; m_max)</span><br><span class="line">				m_max = m;</span><br><span class="line">		&#125;<span class="keyword">while</span> (m!=<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = m_max; j &gt;=<span class="number">0</span>; j--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (a[j] != <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span>(a[j]&gt;<span class="number">0</span>&amp;&amp;flag==<span class="keyword">true</span>)</span><br><span class="line">					System.out.print(<span class="string">"+"</span>);</span><br><span class="line">				<span class="keyword">if</span>(a[j]!=<span class="number">1</span>)</span><br><span class="line">					System.out.print(a[j]);</span><br><span class="line">				<span class="keyword">if</span>(j!=<span class="number">1</span>&amp;&amp;j!=<span class="number">0</span>)</span><br><span class="line">					System.out.print(<span class="string">"x"</span>+j);</span><br><span class="line">				<span class="keyword">if</span>(j==<span class="number">1</span>)</span><br><span class="line">					System.out.print(<span class="string">"x"</span>);</span><br><span class="line">				flag=<span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只有一个测试点没过…..不想改了…..</p>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>用一个大小为101的数组来存系数，数组的下标即为幂指数….<br>若系数不为0则输出…<br>需要注意的是：<br>        系数为1或-1时不用输出系数；<br>        系数小于0时，不输出加号；<br>        幂指数为1时,不输出幂指数；<br>        幂指数为0时，只输出系数；<br>开始的思路是对幂指数为0或1时的输出单独处理，但没有考虑到系数为1或-1的情况…导致没有一个测试点通过…</p>
<h2 id="错误代码"><a href="#错误代码" class="headerlink" title="错误代码:"></a>错误代码:</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 零基础学Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Fifth_Week</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Scanner in = <span class="keyword">new</span> Scanner(System.in </span><br><span class="line"></span><br><span class="line">);</span><br><span class="line">		<span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">101</span>];</span><br><span class="line">		<span class="keyword">int</span> m = <span class="number">0</span>, n = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">100</span>;i++)</span><br><span class="line">			a[i]=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> m_max = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">// 读入第一个多项式</span></span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			m = in.nextInt();</span><br><span class="line">			n = in.nextInt();</span><br><span class="line">			a[m] = n;</span><br><span class="line">			<span class="keyword">if</span> (m &gt; m_max)</span><br><span class="line">				m_max = m;</span><br><span class="line">		&#125;<span class="keyword">while</span>(m!=<span class="number">0</span>);</span><br><span class="line">		<span class="comment">// 读入第二个多项式</span></span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			m = in.nextInt();</span><br><span class="line">			n = in.nextInt();</span><br><span class="line">			a[m] += n;</span><br><span class="line">			<span class="keyword">if</span> (m &gt; m_max)</span><br><span class="line">				m_max = m;</span><br><span class="line">		&#125;<span class="keyword">while</span> (m!=<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = m_max; j &gt; <span class="number">1</span>; j--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (a[j] != <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (flag&amp;&amp;a[j]&gt;<span class="number">0</span>)</span><br><span class="line">					System.out.print(<span class="string">"+"</span>);</span><br><span class="line">				<span class="keyword">if</span>(a[j]==-<span class="number">1</span>)</span><br><span class="line">					System.out.print(<span class="string">"-"</span>);</span><br><span class="line">				flag = <span class="keyword">true</span>;</span><br><span class="line">				System.out.print(a[j] + <span class="string">"x"</span> + j);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 处理幂次为1的情况</span></span><br><span class="line">		<span class="keyword">if</span> (a[<span class="number">1</span>] != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (flag&amp;&amp;a[<span class="number">1</span>]&gt;<span class="number">0</span>)</span><br><span class="line">				System.out.print(<span class="string">"+"</span>);</span><br><span class="line">			<span class="keyword">if</span>(a[<span class="number">1</span>]==-<span class="number">1</span>)</span><br><span class="line">				System.out.print(<span class="string">"-"</span>);</span><br><span class="line">			System.out.print(a[<span class="number">1</span>] + <span class="string">"x"</span>);</span><br><span class="line">			flag = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 处理幂次为0的情况</span></span><br><span class="line">		<span class="keyword">if</span> (a[<span class="number">0</span>] != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (flag)</span><br><span class="line">				System.out.print(<span class="string">"+"</span>);</span><br><span class="line">			System.out.print(a[<span class="number">0</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// System.out.println();</span></span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h2><p>&#160;&#160;&#160;&#160;把源码发到了MOOC的讨论区，在热心网友的帮助下，终于找到了有一个测试点没通过的原因…..<br>&#160;&#160;&#160;&#160;对于系数全部为0的情况，程序会无输出…..<br>&#160;&#160;&#160;&#160;例：对于下列这组数据</p>
<p><div class="note default no-icon"><p><br>6 3<br>2 5<br>0 3<br>6 -3<br>2 -5<br>0 -3<br></p></div><br>在<code>in.close()</code>前面加上这一段就好了<br><code>if(!flag)</code><br><code>System.out.print(&quot;0&quot;);</code></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>零基础学Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>01-复杂度2 Maximum Subsequence Sum（25 分）</title>
    <url>/41173.html</url>
    <content><![CDATA[<h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem:"></a>Problem:</h2><p>Given a sequence of KK integers {N1,N2,…,NK}. A continuous subsequence is defined to be {Ni,Ni+1,…,Nj} where 1≤i≤j≤K1≤i≤j≤K. The Maximum Subsequence is the continuous subsequence which has the largest sum of its elements. For example, given sequence { -2, 11, -4, 13, -5, -2 }, its maximum subsequence is { 11, -4, 13 } with the largest sum being 20.<br>Now you are supposed to find the largest sum, together with the first and the last numbers of the maximum subsequence.<br><a id="more"></a></p>
<h2 id="Input-Specification"><a href="#Input-Specification" class="headerlink" title="Input Specification:"></a>Input Specification:</h2><p>Each input file contains one test case. Each case occupies two lines. The first line contains a positive integerK(≤10000). The second line contains K numbers, separated by a space.</p>
<h2 id="Output-Specification"><a href="#Output-Specification" class="headerlink" title="Output Specification:"></a>Output Specification:</h2><p>For each test case, output in one line the largest sum, together with the first and the last numbers of the maximum subsequence. The numbers must be separated by one space, but there must be no extra space at the end of a line. In case that the maximum subsequence is not unique, output the one with the smallest indices i and j (as shown by the sample case). If all the K numbers are negative, then its maximum sum is defined to be 0, and you are supposed to output the first and the last numbers of the whole sequence.<br>output the first and the last numbers of the whole sequence.</p>
<h2 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input:"></a>Sample Input:</h2><div class="note default no-icon"><p>10<br>-10 1 2 3 4 -5 -23 3 7 -21<br></p></div>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output:"></a>Sample Output:</h2><div class="note default no-icon"><p>10 1 4<br></p></div>

<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"></span><br><span class="line">ll Start, End;</span><br><span class="line"><span class="keyword">int</span> a[<span class="number">1000006</span>];</span><br><span class="line">ll n;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">MaxSubseqSum2</span><span class="params">( <span class="keyword">int</span> A[], <span class="keyword">int</span> N )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ThisSum, MaxSum = <span class="number">-0xffff</span>;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span>( i = <span class="number">0</span>; i &lt; N; i++ )   <span class="comment">/* i是子列左端位置 */</span></span><br><span class="line">    &#123;</span><br><span class="line">        ThisSum = <span class="number">0</span>;  <span class="comment">/* ThisSum是从A[i]到A[j]的子列和 */</span></span><br><span class="line">        <span class="keyword">for</span>( j = i; j &lt; N; j++ )   <span class="comment">/* j是子列右端位置 */</span></span><br><span class="line">        &#123;</span><br><span class="line">            ThisSum += A[j];        <span class="comment">/*对于相同的i，不同的j，只要在j-1次循环的基础上累加1项即可*/</span></span><br><span class="line">            <span class="keyword">if</span>( ThisSum &gt; MaxSum ) <span class="comment">/* 如果刚得到的这个子列和更大 */</span></span><br><span class="line">            &#123;</span><br><span class="line">                MaxSum = ThisSum;    <span class="comment">/* 则更新结果 */</span></span><br><span class="line">                Start = A[i];</span><br><span class="line">                End = A[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">/* j循环结束 */</span></span><br><span class="line">    &#125; <span class="comment">/* i循环结束 */</span></span><br><span class="line">    <span class="keyword">return</span> MaxSum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span>(ll i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = MaxSubseqSum2(a, n);</span><br><span class="line">    <span class="keyword">if</span>(temp &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">" "</span> &lt;&lt; a[<span class="number">0</span>] &lt;&lt; <span class="string">" "</span> &lt;&lt; a[n - <span class="number">1</span>] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; MaxSubseqSum2(a, n) &lt;&lt; <span class="string">" "</span> &lt;&lt; Start &lt;&lt; <span class="string">" "</span> &lt;&lt; End &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span>.sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    input();</span><br><span class="line">    output();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>两重循环遍历，算法复杂度为O（N^2）；<br>第一次提交有部分测试点没通过，其原因是对最大和小于0时的情况没处理好。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>数据结构_陈越、何钦铭</category>
      </categories>
      <tags>
        <tag>数据结构</tag>
      </tags>
  </entry>
  <entry>
    <title>第四周编程题_实现一个表达MP3的媒体类型</title>
    <url>/46392.html</url>
    <content><![CDATA[<h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>本周我们介绍了以继承方式实现的媒体资料库，在课程代码实现的基础上，请实现一个表达MP3的媒体类型，能和CD、DVD一样存放进这个Database。请提交这个MP3类的代码。如果你认为为了能存放MP3，需要修改Item和Database，也请一并提交Item和Database的代码。<br><a id="more"></a></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 面向对象程序设计_Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> playTime;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> gotIt = <span class="keyword">false</span>;</span><br><span class="line">	<span class="keyword">private</span> String comment;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(String title, <span class="keyword">int</span> playTime, <span class="keyword">boolean</span> gotIt, String comment)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.title = title;</span><br><span class="line">		<span class="keyword">this</span>.playTime = playTime;</span><br><span class="line">		<span class="keyword">this</span>.gotIt = gotIt;</span><br><span class="line">		<span class="keyword">this</span>.comment = comment;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.print(<span class="string">"title:"</span>+title+<span class="string">";"</span>+<span class="string">"playTime:"</span>+playTime+<span class="string">";"</span>+<span class="string">"gotIt:"</span>+gotIt+<span class="string">";"</span>+<span class="string">"comment:"</span>+comment+<span class="string">";"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mp3</span> <span class="keyword">extends</span> <span class="title">Item</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String artist;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> numofTracks;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Mp3</span><span class="params">(String title, <span class="keyword">int</span> playTime, <span class="keyword">boolean</span> gotIt, String comment,String artist,<span class="keyword">int</span> numofTracks)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(title, playTime, gotIt, comment);</span><br><span class="line">		<span class="keyword">this</span>.artist=artist;</span><br><span class="line">		<span class="keyword">this</span>.numofTracks=numofTracks;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		System.out.print(<span class="string">"Mp3:&#123;"</span>);</span><br><span class="line">		<span class="keyword">super</span>.print();</span><br><span class="line">		System.out.println(<span class="string">"artist:"</span>+artist+<span class="string">";"</span>+<span class="string">"numofTracks:"</span>+numofTracks+<span class="string">"&#125;"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Database</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ArrayList&lt;Item&gt; list=<span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Item item)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		list.add(item);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">list</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(Item item:list)</span><br><span class="line">			item.print();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		Database db=<span class="keyword">new</span> Database();</span><br><span class="line">		db.add(<span class="keyword">new</span> Mp3(<span class="string">"A"</span>, <span class="number">60</span>, <span class="keyword">true</span>, <span class="string">"good"</span>, <span class="string">"John"</span>, <span class="number">20</span>));</span><br><span class="line">		db.add(<span class="keyword">new</span> Mp3(<span class="string">"B"</span>, <span class="number">80</span>, <span class="keyword">true</span>, <span class="string">"vrey good"</span>, <span class="string">"Tom"</span>, <span class="number">10</span>));</span><br><span class="line">		db.list();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h2><p><img data-src="/images/20170823002504047.jpg" alt></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>面向对象程序设计_Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>第三周编程题_查找里程</title>
    <url>/25475.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>下图为国内主要城市之间的公路里程：</p>
<p><img data-src="/images/6630868754095812824.jpg" alt></p>
<p>你的程序要读入这样的一张表，然后，根据输入的两个城市的名称，给出这两个城市之间的里程。</p>
<p>注意：任何两个城市之间的里程都已经给出，不需要计算经第三地中转。<br>注意：你并不需要去录入上图的数据，数据是在程序输入中给的。<br><a id="more"></a></p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>首先，你会读到若干个城市的名字。每个名字都只是一个英文单词，中间不含空格或其他符号。当读到名字为“###”（三个#号）时，表示城市名字输入结束，###并不是一个城市的名字。如果记读到的城市名字的数量为n。<br>然后，你会读到nxn的一个整数矩阵。第一行的每一个数字，表示上述城市名单中第一个城市依次到另一个城市之间的里程。表中同一个城市之间的里程为0。<br>最后，你会读到两个城市的名字。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>输出这两个城市之间的距离。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><div class="note default no-icon"><p>Hagzou Hugzou Jigxng ###<br>0 1108 708<br>1108 0 994<br>708 994 0<br>Hagzou Jigxng<br></p></div>

<h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><div class="note default no-icon"><p>708<br></p></div>

<p><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 面向对象程序设计_Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Third_Week</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> ArrayList&lt;String&gt; city = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">	<span class="keyword">private</span> HashMap&lt;String, HashMap&lt;String, Integer&gt;&gt; distince = <span class="keyword">new</span> HashMap&lt;String, HashMap&lt;String, Integer&gt;&gt;();</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 输入城市名及距离</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">input</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"><span class="comment">//		Scanner in = new Scanner(System.in);</span></span><br><span class="line">		String temp;</span><br><span class="line">		<span class="comment">// 读入城市名</span></span><br><span class="line">		<span class="keyword">while</span> (<span class="keyword">true</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			temp = in.next();</span><br><span class="line">			<span class="keyword">if</span> (temp.equals(<span class="string">"###"</span>) == <span class="keyword">true</span>)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			city.add(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 读入距离</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; city.size(); i++)</span><br><span class="line">		&#123;</span><br><span class="line">			HashMap&lt;String, Integer&gt; temp_hashmap = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; city.size(); j++)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">int</span> dis = in.nextInt();</span><br><span class="line">				temp_hashmap.put(city.get(j), dis);</span><br><span class="line">			&#125;</span><br><span class="line">			distince.put(city.get(i), temp_hashmap);</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">//		in.close();</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 查找两个城市间的距离</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">search</span><span class="params">(String start, String end)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> dis = <span class="number">0</span>;</span><br><span class="line">		dis = distince.get(start).get(end);</span><br><span class="line">		<span class="keyword">return</span> dis;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Third_Week dis = <span class="keyword">new</span> Third_Week();</span><br><span class="line"><span class="comment">//		Scanner in = new Scanner(System.in);</span></span><br><span class="line">		dis.input();</span><br><span class="line">		String start = in.next();</span><br><span class="line">		String end = in.next();</span><br><span class="line">		System.out.println(dis.search(start, end));</span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><p>题目中给的样例有问题，有的地方多了几个空格，导致在本机测样例的时候，一直无输出，调试了半天。<br>手打了样例之后，发现要查询的两个城市的名字无法读入，怀疑是scanner关闭了两次的问题，注释掉input()方法中的<code>in.close()</code>，果然。。。<br>但是又有个warning，提示<code>input()</code>方法中的in没有关闭。强迫症，把scanner写成全局的，完美解决。<br>开始没读清题意，以为要查询多组城市间的距离，查了下Java中读到末尾的方法，学会了<code>hasnext()</code>等方法。<br>链接：<a href="http://blog.csdn.net/kejizuiqianfang/article/details/55253698" target="_blank" rel="noopener">java中关于判断文本文件读到文件尾</a><br>链接：<a href="http://blog.csdn.net/wn1017888485/article/details/46039361" target="_blank" rel="noopener">java使用两个scanner，关闭输入流</a></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>面向对象程序设计_Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>第三周讨论区_学生成绩的数据结构</title>
    <url>/13223.html</url>
    <content><![CDATA[<h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>如果要写程序表达一个班级的很多个学生的很多门课的成绩，应该如何表达这些数据？</p>
<p>如果我们希望通过学生的姓名，可以找到他的所有的成绩，而每一门课的成绩，是由课程名称和分数构成的。</p>
<p>而如果我们还希望这个程序能找出某一门课的全部学生的成绩应该怎样做呢？</p>
<p>注意，并非所有的学生都参加了所有的课程。<br><a id="more"></a></p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student_Grade</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> HashMap&lt;String, HashMap&lt;String, Double&gt;&gt; studentInfo = <span class="keyword">new</span> HashMap&lt;String, HashMap&lt;String, Double&gt;&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过姓名添加成绩</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String name, String course, <span class="keyword">double</span> grade)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (studentInfo.containsKey(name))</span><br><span class="line">		&#123;</span><br><span class="line">			studentInfo.get(name).put(course, grade);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			HashMap&lt;String, Double&gt; temp = <span class="keyword">new</span> HashMap&lt;String, Double&gt;();</span><br><span class="line">			temp.put(course, grade);</span><br><span class="line">			studentInfo.put(name, temp);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过姓名找到这名学生的所有成绩</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getScore_name</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HashMap&lt;String, Double&gt; temp = <span class="keyword">new</span> HashMap&lt;String, Double&gt;();</span><br><span class="line">		<span class="keyword">for</span> (String k : studentInfo.keySet())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (k == name)</span><br><span class="line">			&#123;</span><br><span class="line">				temp = studentInfo.get(name);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> name+<span class="string">" "</span>+temp.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 通过课程名找到这一门课的全部学生的成绩</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getScore_subject</span><span class="params">(String subject)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		HashMap&lt;String, Double&gt; temp = <span class="keyword">new</span> HashMap&lt;String, Double&gt;();</span><br><span class="line">		<span class="keyword">for</span> (String k : studentInfo.keySet())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (studentInfo.get(k).containsKey(subject))</span><br><span class="line">			&#123;</span><br><span class="line">				temp.put(k, studentInfo.get(k).get(subject));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> subject+<span class="string">":"</span>+temp.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 重载toString()方法</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		String temp=<span class="string">""</span>;</span><br><span class="line">		<span class="keyword">for</span>(String k:studentInfo.keySet())</span><br><span class="line">			temp+=(k+<span class="string">":"</span>+studentInfo.get(k).toString()+<span class="string">"\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Student_Grade student = <span class="keyword">new</span> Student_Grade();</span><br><span class="line">		student.add(<span class="string">"张三"</span>, <span class="string">"Java"</span>, <span class="number">60.0</span>);</span><br><span class="line">		student.add(<span class="string">"张三"</span>, <span class="string">"C++"</span>, <span class="number">70.0</span>);</span><br><span class="line">		student.add(<span class="string">"李四"</span>, <span class="string">"C++"</span>, <span class="number">80.0</span>);</span><br><span class="line">		student.add(<span class="string">"王五"</span>, <span class="string">"C++"</span>, <span class="number">90.2</span>);</span><br><span class="line">		System.out.println(student.getScore_name(<span class="string">"张三"</span>));</span><br><span class="line">		System.out.println(student.getScore_subject(<span class="string">"C++"</span>));</span><br><span class="line">		System.out.println(student);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果:"></a>运行结果:</h2><p><img data-src="/images/20170821012136233.jpg" alt></p>
<h2 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h2><p>起初，两个查询的方法如下所示，返回值是一个Hasmap&lt;String,Doubole&gt;。</p>
<p>后来在为Student_Grade写<code>toString（）</code>方法以便输出所有学生的所有成绩时，想到可以在两个查询的方法中临时建立一个String，调用<code>toString()</code>方法，赋值给它，并对该字符串进行处理，返回一个字符串。使得输出有”姓名“和”课程名“，信息更完整。（强迫症）<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过姓名找到这名学生的所有成绩</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HashMap&lt;String, Double&gt; <span class="title">getScore_name</span><span class="params">(String name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HashMap&lt;String, Double&gt; temp = <span class="keyword">new</span> HashMap&lt;String, Double&gt;();</span><br><span class="line">	<span class="keyword">for</span> (String k : studentInfo.keySet())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (k == name)</span><br><span class="line">		&#123;</span><br><span class="line">			temp = studentInfo.get(name);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过课程名找到这一门课的全部学生的成绩</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HashMap&lt;String, Double&gt; <span class="title">getScore_subject</span><span class="params">(String subject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	HashMap&lt;String, Double&gt; temp = <span class="keyword">new</span> HashMap&lt;String, Double&gt;();</span><br><span class="line">	<span class="keyword">for</span> (String k : studentInfo.keySet())</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (studentInfo.get(k).containsKey(subject))</span><br><span class="line">		&#123;</span><br><span class="line">			temp.put(k, studentInfo.get(k).get(subject));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>面向对象程序设计_Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>第二周编程题_有秒计时的数字时钟</title>
    <url>/2173.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>&#160; &#160; &#160; &#160;这一周的编程题是需要你在课程所给的时钟程序的基础上修改而成。但是我们并不直接给你时钟程序的代码，请根据视频自己输入时钟程序的Display和Clock类的代码，然后来做这个题目。<br>&#160; &#160; &#160; &#160;我们需要给时钟程序加上一个表示秒的Display，然后为Clock增加以下public的成员函数：<br><a id="more"></a></p>
<p>public Clock(int hour, int minute, int second);<br>&#160; &#160; &#160; &#160;用hour, minute和second初始化时间。<br>public void tick();<br>&#160; &#160; &#160; &#160;“嘀嗒”一下，时间走1秒。<br>public String toString();<br>&#160; &#160; &#160; &#160;返回一个String的值，以“hh:mm:ss“的形式表示当前时间。这里每个数值都占据两位，不足两位时补0。如“00:01:22”。注意其中的冒号是西文的，不是中文的。</p>
<p>提示：<code>String.format()</code>可以用和printf一样的方式来格式化一个字符串。</p>
<p>另外写一个Main类，它的main函数为下面的样子，注意，必须原封不动地作为Main的main函数：</p>
<p><div class="note default no-icon"><p><br>public static void main(String[] args) {<br>java.util.Scanner in = new java.util.Scanner(System.in);<br>Clock clock = new Clock(in.nextInt(), in.nextInt(), in.nextInt());<br>clock.tick();<br>System.out.println(clock);<br>in.close();<br>}<br></p></div></p>
<p><div class="note warning"><p><br>注意！在提交的时候，把Main、Clock和Display三个类的代码合并在一起，其中Main类是public的，而Clock和Display类是没有修饰符的。另外，千万注意第一行不能有package语句。<br></p></div></p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>采用给定的main函数无需考虑输入输出。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>采用给定的main函数无需考虑输入输出。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><p>采用给定的main函数无需考虑输入输出。</p>
<h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><p>采用给定的main函数无需考虑输入输出。<br><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 面向对象程序设计_Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Second_Week</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		java.util.Scanner in = <span class="keyword">new</span> java.util.Scanner(System.in);</span><br><span class="line">		Clock clock = <span class="keyword">new</span> Clock(in.nextInt(), in.nextInt(), in.nextInt());</span><br><span class="line">		clock.tick();</span><br><span class="line">		System.out.println(clock);</span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Display</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> limit = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> value = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Display</span><span class="params">(<span class="keyword">int</span> limit)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">		<span class="keyword">this</span>.limit = limit;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setvalue</span><span class="params">(<span class="keyword">int</span> value)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.value = value;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">increase</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">boolean</span> temp = <span class="keyword">false</span>;</span><br><span class="line">		value++;</span><br><span class="line">		<span class="keyword">if</span> (value == limit)</span><br><span class="line">		&#123;</span><br><span class="line">			value = <span class="number">0</span>;</span><br><span class="line">			temp = <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getvalue</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> value;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clock</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Display hour = <span class="keyword">new</span> Display(<span class="number">24</span>);</span><br><span class="line">	<span class="keyword">private</span> Display minute = <span class="keyword">new</span> Display(<span class="number">60</span>);</span><br><span class="line">	<span class="keyword">private</span> Display second = <span class="keyword">new</span> Display(<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Clock</span><span class="params">(<span class="keyword">int</span> hour, <span class="keyword">int</span> minute, <span class="keyword">int</span> second)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.hour.setvalue(hour);</span><br><span class="line">		<span class="keyword">this</span>.minute.setvalue(minute);</span><br><span class="line">		<span class="keyword">this</span>.second.setvalue(second);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> String.format(<span class="string">"%02d:%02d:%02d"</span>, hour.getvalue(), minute.getvalue(), second.getvalue());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">this</span>.second.increase() == <span class="keyword">true</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">this</span>.minute.increase() == <span class="keyword">true</span>)</span><br><span class="line">				<span class="keyword">this</span>.hour.increase();</span><br><span class="line">		&#125;</span><br><span class="line"><span class="comment">//		System.out.println(toString());</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没写toString()方法时，输出为：<br>面向对象程序设计<em>Java语言</em>翁恺.Clock@7d4991ad</p>
<h2 id="学习心得："><a href="#学习心得：" class="headerlink" title="学习心得："></a>学习心得：</h2><p>toString（）方法是Object类的一个实例方法，所有的Java类都是Object类的子类，故所有的Java类都有toString（）方法。<br>除此外，所有的Java类的对象都可以和字符串进行连接运算，当Java类对象和字符串进行连接运算时，系统自动调用Java对象toString（）方法的返回值和字符串进行连接操作，如：<br>&#160; &#160; &#160; &#160;String str=p+“123”；<br>&#160; &#160; &#160; &#160;String str=p.toString()+”123”;<br>toString()方法是一个非常特殊的方法，是一个“自我描述”方法，该方法通常用于实现当程序员直接打印该对象时，系统将会输出该对象的“自我描述”信息，用以告诉外界该对象具有的状态信息。<br>Object类提供的toString()方法总是返回该对象实现类的”类名+@+hashCode”值，这个返回值不能真正实现“自我描述”功能，因此我们可以重写object的toString()方法。</p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>面向对象程序设计_Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>第一周编程题_分数</title>
    <url>/47907.html</url>
    <content><![CDATA[<h2 id="题目内容："><a href="#题目内容：" class="headerlink" title="题目内容："></a>题目内容：</h2><p>设计一个表示分数的类Fraction。这个类用两个int类型的变量分别表示分子和分母。</p>
<p>这个类的构造函数是：<br>Fraction(int a, int b)<br>&#160; &#160; &#160; &#160;构造一个a/b的分数。<br><a id="more"></a></p>
<p>这个类要提供以下的功能：<br>double toDouble();<br>&#160; &#160; &#160; &#160;将分数转换double<br>Fraction plus(Fraction r);<br>&#160; &#160; &#160; &#160;将自己的分数和r的分数相加，产生一个新的Fraction的对象。注意小学四年级学过两个分数如何相加的哈。<br>Fraction multiply(Fraction r);<br>&#160; &#160; &#160; &#160;将自己的分数和r的分数相乘，产生一个新的Fraction的对象。<br>void print();<br>&#160; &#160; &#160; &#160;将自己以“分子/分母”的形式输出到标准输出，并带有回车换行。如果分数是1/1，应该输出1。当分子大于分母时，不需要提出整数部分，即31/30是一个正确的输出。</p>
<p>注意，在创建和做完运算后应该化简分数为最简形式。如2/4应该被化简为1/2。</p>
<p>你写的类要和以下的代码放在一起，并请勿修改这个代码：</p>
<div class="note warnging"><p><br>import java.util.Scanner;<br><br>public class Main {<br><br>public static void main(String[] args) {<br>Scanner in = new Scanner(System.in);<br>Fraction a = new Fraction(in.nextInt(), in.nextInt());<br>Fraction b = new Fraction(in.nextInt(),in.nextInt());<br>a.print();<br>b.print();<br>a.plus(b).print();<br>a.multiply(b).plus(new Fraction(5,6)).print();<br>a.print();<br>b.print();<br>in.close();<br>}<br>}<br></p></div>

<p>注意，你的类的定义应该这样开始：</p>
<p><code>class Fraction {</code></p>
<p>也就是说，在你的类的class前面不要有public。</p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式:"></a>输入格式:</h2><p>程序运行时会得到四个数字，分别构成两个分数，依次是分子和分母。</p>
<h2 id="输出格式："><a href="#输出格式：" class="headerlink" title="输出格式："></a>输出格式：</h2><p>输出一些算式。这些输入和输出都是由Main类的代码完成的，你的代码不要做输入和输出。</p>
<h2 id="输入样例："><a href="#输入样例：" class="headerlink" title="输入样例："></a>输入样例：</h2><div class="note default no-icon"><p>2 4 1 3<br></p></div>

<h2 id="输出样例："><a href="#输出样例：" class="headerlink" title="输出样例："></a>输出样例：</h2><div class="note default no-icon"><p>1/2<br>1/3<br>5/6<br>1<br>1/2<br>1/3<br></p></div>

<p><strong>时间限制：500ms内存限制：32000kb</strong></p>
<h2 id="代码如下："><a href="#代码如下：" class="headerlink" title="代码如下："></a>代码如下：</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> 面向对象程序设计_Java语言_翁恺;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">First_Week</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		Scanner in = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">		Fraction a = <span class="keyword">new</span> Fraction(in.nextInt(), in.nextInt());</span><br><span class="line">		Fraction b = <span class="keyword">new</span> Fraction(in.nextInt(), in.nextInt());</span><br><span class="line">		a.print();</span><br><span class="line">		b.print();</span><br><span class="line">		a.plus(b).print();</span><br><span class="line">		a.multiply(b).plus(<span class="keyword">new</span> Fraction(<span class="number">5</span>, <span class="number">6</span>)).print();</span><br><span class="line">		a.print();</span><br><span class="line">		b.print();</span><br><span class="line">		in.close();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fraction</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Fraction</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated constructor stub</span></span><br><span class="line">		<span class="keyword">this</span>.a = a;</span><br><span class="line">		<span class="keyword">this</span>.b = b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Fraction <span class="title">plus</span><span class="params">(Fraction r)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> aa = a * r.b + r.a * b;</span><br><span class="line">		<span class="keyword">int</span> bb = b * r.b;</span><br><span class="line">		Fraction temp = <span class="keyword">new</span> Fraction(aa, bb);</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Fraction <span class="title">multiply</span><span class="params">(Fraction r)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> aa = a * r.a;</span><br><span class="line">		<span class="keyword">int</span> bb = b * r.b;</span><br><span class="line">		Fraction temp = <span class="keyword">new</span> Fraction(aa, bb);</span><br><span class="line">		<span class="keyword">return</span> temp;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">toDouble</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a * <span class="number">1.0</span> / b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> x = a, y = b, r = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (y != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			r = x % y;</span><br><span class="line">			x = y;</span><br><span class="line">			y = r;</span><br><span class="line">		&#125;</span><br><span class="line">		a /= x;</span><br><span class="line">		b /= x;</span><br><span class="line">		<span class="keyword">if</span> (a == b)</span><br><span class="line">			System.out.println(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			System.out.println(a + <span class="string">"/"</span> + b);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>初学Java，按照C++中的习惯，开始的时候果断写成了下图这样/捂脸~<br>好菜~~<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Fraction <span class="title">plus</span><span class="params">(Fraction r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> aa = a * r.b + r.a * b;</span><br><span class="line">	<span class="keyword">int</span> bb = b * r.b;</span><br><span class="line">	<span class="function">Fraction <span class="title">temp</span><span class="params">(aa, bb)</span></span>;</span><br><span class="line">	<span class="keyword">return</span> temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>面向对象程序设计_Java语言_翁恺</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>2017百度之星资格赛 1003 度度熊与邪恶大魔王（完全背包）</title>
    <url>/53776.html</url>
    <content><![CDATA[<h2 id="度度熊与邪恶大魔王"><a href="#度度熊与邪恶大魔王" class="headerlink" title="度度熊与邪恶大魔王"></a>度度熊与邪恶大魔王</h2><p>Accepts: 2016<br>Submissions: 12307<br>Time Limit: 2000/1000 MS (Java/Others)<br>Memory Limit: 32768/32768 K (Java/Others)<br>传送门: <a href="http://bestcoder.hdu.edu.cn/contests/contest_showproblem.php?cid=774&amp;pid=1003" target="_blank" rel="noopener">bestcoder</a><br><a id="more"></a></p>
<h2 id="Problem-Description"><a href="#Problem-Description" class="headerlink" title="Problem Description"></a>Problem Description</h2><p>度度熊为了拯救可爱的公主，于是与邪恶大魔王战斗起来。<br>邪恶大魔王的麾下有n个怪兽，每个怪兽有a[i]的生命值，以及b[i]的防御力。<br>度度熊一共拥有m种攻击方式，第i种攻击方式，需要消耗k[i]的晶石，造成p[i]点伤害。<br>当然，如果度度熊使用第i个技能打在第j个怪兽上面的话，会使得第j个怪兽的生命值减少p[i]-b[j]，当然如果伤害小于防御，那么攻击就不会奏效。<br>如果怪兽的生命值降为0或以下，那么怪兽就会被消灭。<br>当然每个技能都可以使用无限次。<br>请问度度熊最少携带多少晶石，就可以消灭所有的怪兽。</p>
<h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><p>本题包含若干组测试数据。<br>第一行两个整数n，m,表示有n个怪兽，m种技能。<br>接下来n行，每行两个整数，a[i],b[i]，分别表示怪兽的生命值和防御力。<br>再接下来m行，每行两个整数k[i]和p[i]，分别表示技能的消耗晶石数目和技能的伤害值。<br>数据范围:</p>
<div class="note default no-icon"><p>1&lt;=n&lt;=100000<br>1&lt;=m&lt;=1000<br>1&lt;=a[i]&lt;=1000<br>0&lt;=b[i]&lt;=10<br>0&lt;=k[i]&lt;=100000<br>0&lt;=p[i]&lt;=1000<br></p></div><br>## Output<br>对于每组测试数据，输出最小的晶石消耗数量，如果不能击败所有的怪兽，输出-1<br>## Sample Input<br><div class="note default no-icon"><p>1 2<br>3 5<br>7 10<br>6 8<br>1 2<br>3 5<br>10 7<br>8<br></p></div>

<h2 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h2><div class="note default no-icon"><p>8<br>16<br></p></div>

<h2 id="Aceppted代码"><a href="#Aceppted代码" class="headerlink" title="Aceppted代码"></a>Aceppted代码</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Problem:度度熊与邪恶大魔王</span></span><br><span class="line"><span class="comment">Author:QiZhao</span></span><br><span class="line"><span class="comment">Data:2017-08-05</span></span><br><span class="line"><span class="comment">Description:DP，完全背包</span></span><br><span class="line"><span class="comment">Copyright  2017 QiZhao. All rights reserved.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn = <span class="number">1020</span>;</span><br><span class="line"><span class="keyword">const</span> ll INF=<span class="number">0x3f3f3f3f</span>;</span><br><span class="line"></span><br><span class="line">ll num[maxn][<span class="number">12</span>];<span class="comment">//防御值为j，生命值为i的怪物的个数</span></span><br><span class="line">ll dp[<span class="number">1020</span>][<span class="number">15</span>];<span class="comment">//对于生命值为i，防御值为j的怪物所消耗的最小水晶数</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">skill</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ll hit;</span><br><span class="line">    ll price;</span><br><span class="line">&#125; a[maxn];</span><br><span class="line">ll best[maxn];<span class="comment">//攻击力为i时，消耗的最少水晶数。</span></span><br><span class="line"></span><br><span class="line"><span class="function">ll <span class="title">min</span><span class="params">(ll a,ll b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a&gt;b)</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">complete_packet</span><span class="params">(<span class="keyword">int</span> k, <span class="keyword">int</span> p)</span><span class="comment">//p为攻击力，k为消耗水晶数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> b = <span class="number">0</span>; b &lt;= <span class="number">10</span>; ++b)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &gt;= p)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> d = p - b;</span><br><span class="line">            <span class="comment">//血量小于攻击</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a = <span class="number">1</span>; a &lt;= d; ++a)</span><br><span class="line">            &#123;</span><br><span class="line">                dp[a][b] = min(dp[a][b], k);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//血量大于攻击</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> a = d + <span class="number">1</span>; a &lt;= <span class="number">1000</span>; ++a)</span><br><span class="line">            &#123;</span><br><span class="line">                dp[a][b] = min(dp[a][b], dp[a - d][b] + k);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span>.sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    ll n, m;</span><br><span class="line">    ll x, y;</span><br><span class="line">    ll <span class="comment">/*max_hp = -0xffff,*/</span> max_def = -INF, max_hit = -INF;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m)</span><br><span class="line">    &#123;</span><br><span class="line">        max_def = -INF, max_hit = -INF;</span><br><span class="line">        <span class="built_in">memset</span>(num, <span class="number">0</span>, <span class="keyword">sizeof</span>(num));</span><br><span class="line">        <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="keyword">sizeof</span>(a));</span><br><span class="line">        <span class="built_in">memset</span>(best, <span class="number">-1</span>, <span class="keyword">sizeof</span>(best));</span><br><span class="line">        <span class="built_in">memset</span>(dp, <span class="number">0</span>, <span class="keyword">sizeof</span>(dp));</span><br><span class="line">        <span class="keyword">for</span>(ll i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y;</span><br><span class="line">            num[x][y]++;</span><br><span class="line">            <span class="comment">//if(x &gt;= max_hp)</span></span><br><span class="line">            <span class="comment">//max_hp = x;</span></span><br><span class="line">            <span class="keyword">if</span>(y &gt;= max_def)</span><br><span class="line">                max_def = y;</span><br><span class="line">        &#125;</span><br><span class="line">        ll flag = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(ll i = <span class="number">0</span>; i &lt; m; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x &gt;&gt; y;</span><br><span class="line">            <span class="keyword">if</span>(best[y] == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                a[flag].hit = y;</span><br><span class="line">                a[flag].price = x;</span><br><span class="line">                best[y] = x;</span><br><span class="line">                <span class="keyword">if</span>(a[flag].hit &gt; max_hit)</span><br><span class="line">                    max_hit = a[flag].hit;</span><br><span class="line">                flag++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(x &lt; best[y])</span><br><span class="line">                    best[y] = x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ll ans = <span class="number">0</span>;</span><br><span class="line">        ll temp = <span class="number">0</span>; <span class="comment">//记录已处理怪物个数，优化时间</span></span><br><span class="line">        <span class="keyword">if</span>(max_def &gt;= max_hit)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; <span class="string">"-1"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">1010</span>; ++i)<span class="comment">//初始化DP</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">10</span>; ++j)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        dp[i][j] = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        dp[i][j] = INF;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;flag;i++)</span><br><span class="line">                complete_packet(best[a[i].hit],a[i].hit);</span><br><span class="line">            <span class="keyword">for</span>(ll i = <span class="number">0</span>; i &lt; <span class="number">1002</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(temp == n)<span class="comment">//优化时间</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">for</span>(ll j = <span class="number">0</span>; j &lt; <span class="number">12</span>; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(num[i][j] != <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        temp += num[i][j];</span><br><span class="line">                        ans += dp[i][j]*num[i][j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><link rel="stylesheet" href="/css/spoiler.css" type="text/css"><script src="/js/spoiler.js" type="text/javascript" async></script>]]></content>
      <categories>
        <category>ACM</category>
      </categories>
      <tags>
        <tag>百度之星</tag>
        <tag>完全背包</tag>
      </tags>
  </entry>
</search>
